# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile $

PortSystem          1.0
PortGroup           github 1.0
PortGroup           php 1.1

name                arcanist
subport             libphutil {}

# github.set will override name, so do not count on ${name} as a
# way to determine which subport we're installing, nowhere.

if {${subport} eq "arcanist"} {
    github.setup    phacility ${subport} c243cbbd9fc701ca9555672ea5c1666ea154898f
    version         20161228
    depends_run-append \
                    port:libphutil
    description     Phabricator command-line tool
    long_description \
                    Arcanist is the command-line tool for Phabricator (http://phabricator.org). \
                    It allows you to interact with Phabricator installs to send code for review, \
                    download patches, transfer files, view status, make API calls, and various other \
                    things.
    checksums       rmd160  dc61122f29ce7fbecc85280e1957f4c269e1a621 \
                    sha256  9aa67b21d5922cc6402eb0df0fb3c19cded36844bdbe93e47cbd2f135f6975ec
} else {
    github.setup    phacility ${subport} 5ac2ca1214890d865bc57fab2715a322fdf02ab6
    version         20161206
    description     A collection of utility classes and functions for PHP
    long_description \
                    ${description}.
    checksums       rmd160  fd633692541022b5df7f8b0a663f90fc3f5d5058 \
                    sha256  421985c4a58f0e492541c652f010bcb8b5af51e7a4070d9ebdcd1162cc4e57e0
}

categories          devel
license             Apache-2
maintainers         gmail.com:rjvbertin
supported_archs     noarch
installs_libs       no

platform darwin {
    depends_run-append \
                    port:php[php.suffix_from_branch ${php.latest_stable_branch}] \
                    port:php[php.suffix_from_branch ${php.latest_stable_branch}]-curl
}

use_configure       no

build               {}

destroot {
    xinstall -m 755 -d ${destroot}${prefix}/libexec
    system "cp -pR ${worksrcpath} ${destroot}${prefix}/libexec/${subport}"
    if {${subport} eq "arcanist"} {
        ln -s ${prefix}/libexec/${subport}/bin/arc ${destroot}${prefix}/bin/arc
    }
}
