# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile $

PortSystem          1.0
PortGroup           github 1.0
PortGroup           php 1.1

name                arcanist
subport             libphutil {}

# github.set will override name, so do not count on ${name} as a
# way to determine which subport we're installing, nowhere.

if {${subport} eq "arcanist"} {
    github.setup    phacility ${subport} ade25facfdf22aed1c1e20fed3e58e60c0be3c2b
    version         20170105
    depends_run-append \
                    port:libphutil
    description     Phabricator command-line tool
    long_description \
                    Arcanist is the command-line tool for Phabricator (http://phabricator.org). \
                    It allows you to interact with Phabricator installs to send code for review, \
                    download patches, transfer files, view status, make API calls, and various other \
                    things.
    checksums       rmd160  b5bbae5db12606f8774aa94fddb58d42ebe78e7a \
                    sha256  0f399baec7f1b736af56cb839f82a9a82160c16ebf8dc737b1d54cc7a23e50ee
} else {
    github.setup    phacility ${subport} 9d85dfab0f532d50c2343719e92d574a4827341b
    version         20170113
    description     A collection of utility classes and functions for PHP
    long_description \
                    ${description}.
    checksums       rmd160  b1ee4674d937e2269e098588ddc21a6bd23cc8f7 \
                    sha256  a085b0264b363558bbd8ec8e8e7f31bbbb3d6aec901cc8920ebf38bd523e33f6
}

categories          devel
license             Apache-2
maintainers         gmail.com:rjvbertin
supported_archs     noarch
installs_libs       no

platform darwin {
    depends_run-append \
                    port:php[php.suffix_from_branch ${php.latest_stable_branch}] \
                    port:php[php.suffix_from_branch ${php.latest_stable_branch}]-curl
}

use_configure       no

build               {}

destroot {
    xinstall -m 755 -d ${destroot}${prefix}/libexec
    system "cp -pR ${worksrcpath} ${destroot}${prefix}/libexec/${subport}"
    if {${subport} eq "arcanist"} {
        ln -s ${prefix}/libexec/${subport}/bin/arc ${destroot}${prefix}/bin/arc
    }
}
