diff --git CMakeLists.txt CMakeLists.txt
index e5b7482..136476b 100644
--- CMakeLists.txt
+++ CMakeLists.txt
@@ -3,6 +3,7 @@ project (ClangLazy)
 
 set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_SOURCE_DIR}/cmake)
 find_package(Clang 3.6 MODULE REQUIRED)
+# message(STATUS "Found Clang version ${LLVM_VERSION}")
 
 set( CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin )
 set( CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib )
@@ -12,7 +13,7 @@ add_definitions (-D__STDC_LIMIT_MACROS -D__STDC_CONSTANT_MACROS)
 add_definitions (-D_GNU_SOURCE -DHAVE_CLANG_CONFIG_H)
 
 set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -fno-common -Woverloaded-virtual -Wcast-qual -fno-strict-aliasing -pedantic -Wno-long-long -Wall -W -Wno-unused-parameter -Wwrite-strings -fno-exceptions -fno-rtti")
-set (CMAKE_MODULE_LINKER_FLAGS "${CMAKE_MODULE_LINKER_FLAGS} -Wl,-flat_namespace -Wl,-undefined -Wl,suppress")
+# set (CMAKE_MODULE_LINKER_FLAGS "${CMAKE_MODULE_LINKER_FLAGS} -Wl,-flat_namespace -Wl,-undefined -Wl,suppress")
 if(NOT WIN32)
     set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")
 endif()
@@ -34,6 +35,8 @@ LIST(REMOVE_ITEM LLVM_LIBS_LIST "-lLLVMSupport")    # Remove element
 macro(add_clang_plugin name)
     set (srcs ${ARGN})
 
+    add_definitions(${LLVM_CFLAGS})
+
     include_directories(${CLANG_INCLUDE_DIRS} ${CMAKE_SOURCE_DIR})
     link_directories("${LLVM_INSTALL_PREFIX}/lib" ${LLVM_LIBRARY_DIRS})
 
@@ -51,6 +54,7 @@ macro(add_clang_plugin name)
     foreach (llvm_lib ${LLVM_LIBS_LIST})
         target_link_libraries( ${name} ${llvm_lib} )
     endforeach()
+    target_link_libraries( ${name} "-lLLVM-${LLVM_VERSION}" )
 
     foreach (user_lib ${USER_LIBS})
         target_link_libraries( ${name} ${user_lib} )
@@ -129,7 +133,7 @@ set_target_properties(ClangLazy PROPERTIES
 
 include("GNUInstallDirs")
 install(TARGETS ClangLazy     RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
-                              LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
+                              LIBRARY DESTINATION @LLVM_INSTALL_PREFIX@/lib
                               ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR})
 if(NOT WIN32)
     install(FILES ${CMAKE_SOURCE_DIR}/clazy DESTINATION bin PERMISSIONS OWNER_WRITE OWNER_EXECUTE OWNER_READ GROUP_EXECUTE GROUP_READ WORLD_READ WORLD_EXECUTE)
