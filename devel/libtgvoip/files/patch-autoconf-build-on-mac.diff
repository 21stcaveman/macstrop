--- libtgvoip-debian-2.4.4-4/orig.Makefile.am	2020-10-19 17:16:48.000000000 +0200
+++ libtgvoip-debian-2.4.4-4/Makefile.am	2020-10-19 21:02:18.000000000 +0200
@@ -83,7 +83,7 @@
 os/darwin/TGVVideoSource.h \
 os/darwin/VideoToolboxEncoderSource.h
 
-LDFLAGS += -framework Foundation -framework CoreFoundation -framework CoreAudio -framework AudioToolbox -framework VideoToolbox -framework CoreMedia -framework CoreVideo
+LDFLAGS += -framework Foundation -framework CoreFoundation -framework CoreAudio -framework AudioToolbox -framework VideoToolbox -framework CoreMedia -framework CoreVideo -framework AVFoundation
 
 else
 # Linux-specific
@@ -757,8 +757,10 @@
 
 pkgconfig_DATA = tgvoip.pc
 
-CXXFLAGS += -std=gnu++17 $(CFLAGS)
 if TARGET_OS_OSX
+CXXFLAGS += -std=gnu++14 $(CFLAGS)
 OBJCFLAGS = $(CFLAGS)
 OBJCXXFLAGS += -std=gnu++0x $(CFLAGS)
-endif
\ No newline at end of file
+else
+CXXFLAGS += -std=gnu++17 $(CFLAGS)
+endif
--- libtgvoip-debian-2.4.4-4/orig.Makefile.in	2020-10-19 17:17:07.000000000 +0200
+++ libtgvoip-debian-2.4.4-4/Makefile.in	2020-10-19 21:03:24.000000000 +0200
@@ -114,7 +114,7 @@
 @TARGET_OS_OSX_TRUE@os/darwin/TGVVideoSource.h \
 @TARGET_OS_OSX_TRUE@os/darwin/VideoToolboxEncoderSource.h
 
-@TARGET_OS_OSX_TRUE@am__append_3 = -framework Foundation -framework CoreFoundation -framework CoreAudio -framework AudioToolbox -framework VideoToolbox -framework CoreMedia -framework CoreVideo
+@TARGET_OS_OSX_TRUE@am__append_3 = -framework Foundation -framework CoreFoundation -framework CoreAudio -framework AudioToolbox -framework VideoToolbox -framework CoreMedia -framework CoreVideo -framework AVFoundation
 
 # Linux-specific
 @TARGET_OS_OSX_FALSE@@WITH_ALSA_TRUE@am__append_4 = \
@@ -763,7 +763,9 @@
 @ENABLE_DSP_TRUE@webrtc_dsp/common_audio/vad/vad_filterbank.h
 
 @ENABLE_DSP_FALSE@am__append_24 = -DTGVOIP_NO_DSP
-@TARGET_OS_OSX_TRUE@am__append_25 = -std=gnu++0x $(CFLAGS)
+@TARGET_OS_OSX_TRUE@am__append_25 = -std=gnu++14 $(CFLAGS)
+@TARGET_OS_OSX_TRUE@am__append_26 = -std=gnu++0x $(CFLAGS)
+@TARGET_OS_OSX_FALSE@am__append_27 = -std=gnu++17 $(CFLAGS)
 subdir = .
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/configure.ac
@@ -1933,7 +1935,7 @@
 CXX = @CXX@
 CXXCPP = @CXXCPP@
 CXXDEPMODE = @CXXDEPMODE@
-CXXFLAGS = @CXXFLAGS@ -std=gnu++17 $(CFLAGS)
+CXXFLAGS = @CXXFLAGS@ $(am__append_25) $(am__append_27)
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
@@ -1971,7 +1973,7 @@
 NMEDIT = @NMEDIT@
 OBJCXX = @OBJCXX@
 OBJCXXDEPMODE = @OBJCXXDEPMODE@
-OBJCXXFLAGS = @OBJCXXFLAGS@ $(am__append_25)
+OBJCXXFLAGS = @OBJCXXFLAGS@ $(am__append_26)
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 OTOOL = @OTOOL@
--- libtgvoip-debian-2.4.4-4//os/darwin/orig.DarwinSpecific.mm	2020-07-25 10:00:38.000000000 +0200
+++ libtgvoip-debian-2.4.4-4//os/darwin/DarwinSpecific.mm	2020-10-19 17:41:31.000000000 +0200
@@ -26,6 +26,7 @@
 void DarwinSpecific::SetCurrentThreadPriority(int priority){
 	NSThread* thread=[NSThread currentThread];
 	if([thread respondsToSelector:@selector(setQualityOfService:)]){
+#if __MAC_OS_X_VERSION_MAX_ALLOWED >= 101000
 		NSQualityOfService qos;
 		switch(priority){
 			case THREAD_PRIO_USER_INTERACTIVE:
@@ -46,6 +47,7 @@
 				break;
 		}
 		[thread setQualityOfService:qos];
+#endif
 	}else{
 		double p;
 		switch(priority){
--- libtgvoip-debian-2.4.4-4//os/darwin/orig.SampleBufferDisplayLayerRenderer.mm	2020-07-25 10:00:38.000000000 +0200
+++ libtgvoip-debian-2.4.4-4//os/darwin/SampleBufferDisplayLayerRenderer.mm	2020-10-19 19:12:48.000000000 +0200
@@ -44,6 +44,7 @@
 		CGRect rect=CMVideoFormatDescriptionGetCleanAperture(formatDesc, true);
 		LOGI("size from formatDesc: %f x %f", rect.size.width, rect.size.height);
 	}else if(codec==CODEC_HEVC){
+#if __MAC_OS_X_VERSION_MAX_ALLOWED >= 101300
 		if(@available(iOS 11.0, *)){
     		if(csd.size()!=1){
     			LOGE("HEVC requires exactly 1 CSD buffer");
@@ -72,7 +73,9 @@
 			}
     		CGRect rect=CMVideoFormatDescriptionGetCleanAperture(formatDesc, true);
     		LOGI("size from formatDesc: %f x %f", rect.size.width, rect.size.height);
-		}else{
+		}else
+#endif
+		{
 			LOGE("HEVC not available on this OS");
 		}
 	}
@@ -135,10 +138,12 @@
 std::vector<uint32_t> SampleBufferDisplayLayerRenderer::GetAvailableDecoders(){
 	std::vector<uint32_t> res;
 	res.push_back(CODEC_AVC);
+#if __MAC_OS_X_VERSION_MAX_ALLOWED >= 101300
 	if(@available(iOS 11.0, *)){
 		if(VTIsHardwareDecodeSupported(kCMVideoCodecType_HEVC)){
 			res.push_back(CODEC_HEVC);
 		}
 	}
+#endif
 	return res;
 }
--- libtgvoip-debian-2.4.4-4//os/darwin/orig.TGVVideoRenderer.mm	2020-07-25 10:00:38.000000000 +0200
+++ libtgvoip-debian-2.4.4-4//os/darwin/TGVVideoRenderer.mm	2020-10-19 20:28:48.000000000 +0200
@@ -4,6 +4,7 @@
 // you should have received with this source code distribution.
 //
 
+#import <AVFoundation/AVAnimation.h>
 #import "TGVVideoRenderer.h"
 #include "SampleBufferDisplayLayerRenderer.h"
 #include "../../logging.h"
--- libtgvoip-debian-2.4.4-4//os/darwin/orig.VideoToolboxEncoderSource.mm	2020-07-25 10:00:38.000000000 +0200
+++ libtgvoip-debian-2.4.4-4//os/darwin/VideoToolboxEncoderSource.mm	2020-10-19 20:24:37.000000000 +0200
@@ -5,6 +5,7 @@
 //
 
 #import <Foundation/Foundation.h>
+#import <VideoToolbox/VTVideoEncoderList.h>
 #include "VideoToolboxEncoderSource.h"
 #include "../../PrivateDefines.h"
 #include "../../logging.h"
@@ -47,9 +48,11 @@
 	case CODEC_AVC:
 		codecType=kCMVideoCodecType_H264;
 		break;
+#if __MAC_OS_X_VERSION_MAX_ALLOWED >= 101300
 	case CODEC_HEVC:
 		codecType=kCMVideoCodecType_HEVC;
 		break;
+#endif
 	default:
 		LOGE("VideoToolboxEncoder: Unsupported codec");
 		return;
@@ -172,7 +175,9 @@
 				b.CopyFrom(startCode, 0, 4);
 				csd.push_back(std::move(b));
 			}
-		}else if(codec==CODEC_HEVC){
+		}
+#if __MAC_OS_X_VERSION_MAX_ALLOWED >= 101300
+		else if(codec==CODEC_HEVC){
 			LOGD("here1");
 			BufferOutputStream csdBuf(1024);
 			for(size_t i=0;i<3;i++){
@@ -185,6 +190,7 @@
 			}
 			csd.push_back(std::move(csdBuf));
 		}
+#endif
 		needUpdateStreamParams=false;
 	}
 	CMBlockBufferRef blockBuffer=CMSampleBufferGetDataBuffer(buffer);
@@ -245,10 +251,12 @@
 		//NSString* name=(NSString*)CFDictionaryGetValue(v, kVTVideoEncoderList_EncoderName);
 		uint32_t codecType=[(NSNumber*)encoder[(NSString*)kVTVideoEncoderList_CodecType] intValue];
 		//LOGV("Encoders[%u]: %s, %c%c%c%c", i, [(NSString*)encoder[(NSString*)kVTVideoEncoderList_EncoderName] cStringUsingEncoding:NSUTF8StringEncoding], PRINT_FOURCC(codecType));
+#if __MAC_OS_X_VERSION_MAX_ALLOWED >= 101300
 		if(codecType==kCMVideoCodecType_HEVC){
 			res.push_back(CODEC_HEVC);
 			break;
 		}
+#endif
 	}
 	CFRelease(encoders);
 	return res;
--- libtgvoip-debian-2.4.4-4//os/posix/orig.NetworkSocketPosix.cpp	2020-07-25 10:00:38.000000000 +0200
+++ libtgvoip-debian-2.4.4-4//os/posix/NetworkSocketPosix.cpp	2020-10-19 17:29:49.000000000 +0200
@@ -58,7 +58,7 @@
 }
 
 void NetworkSocketPosix::SetMaxPriority(){
-#ifdef __APPLE__
+#if defined(__APPLE__) && defined(SO_NET_SERVICE_TYPE)
 	int prio=NET_SERVICE_TYPE_VO;
 	int res=setsockopt(fd, SOL_SOCKET, SO_NET_SERVICE_TYPE, &prio, sizeof(prio));
 	if(res<0){
