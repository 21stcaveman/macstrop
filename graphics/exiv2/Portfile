# $Id: Portfile 124584 2014-08-26 05:15:01Z devans@macports.org $

PortSystem 1.0
PortGroup  cmake 1.0

name             exiv2
# version          0.24.3839
version          0.25
# fetch.type       svn

homepage         http://www.exiv2.org/
description      EXIF and IPTC metadata manipulation library and tools
categories       graphics
platforms        darwin
license          GPL-2+
maintainers      vafer.org:tcurdt openmaintainer

master_sites     http://www.exiv2.org/

if {${fetch.type} eq "svn"} {
    depends_fetch-append    port:subversion
    svn.cmd             ${prefix}/bin/svn
    if {[file exists ${filespath}/${name}-svn/.svn]} {
        svn.url         ${filespath}/${name}-svn
        distname        ${name}-svn
    } else {
        svn.url         svn://dev.exiv2.org/svn/trunk
        distname        trunk
    }
    svn.revision        3839
} else {
    checksums           rmd160  2f43f8737dad9ffd7d5759ef4dd9688658125794 \
                        sha256  c80bfc778a15fdb06f71265db2c3d49d8493c382e516cb99b8c9f9cbde36efa4
}

long_description Exiv2 comprises of a C++ library and a command line utility \
                 which allows you to manipulate EXIF and IPTC image metadata.

depends_lib     port:expat \
                port:gettext \
                port:libiconv \
                port:libssh \
                port:curl \
                port:zlib

cmake.out_of_source     yes
configure.args-append   -DEXIV2_ENABLE_WEBREADY:BOOL=ON

variant video description {include support for reading video file metadata} {
    patchfiles-append       patch-deactivate-QT-userdata.diff
    configure.args-append   -DEXIV2_ENABLE_VIDEO:BOOL=ON
}
default_variants +video

notes-append    "Install ${name} without the +video variant (\"-video\") if you observe crashes when parsing video files\
    and please report on trac.macports.org"

post-destroot {
    file mkdir ${destroot}${prefix}/share/man
    system "ditto ${destroot}${prefix}/man ${destroot}${prefix}/share/man"
    file delete -force ${destroot}${prefix}/man
}

livecheck.type  regex
livecheck.url   ${homepage}/download.html
livecheck.regex "${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
