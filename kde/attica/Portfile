# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 140960 2015-10-06 20:13:45Z michaelld@macports.org $

PortSystem          1.0

name                attica
version             0.4.2
revision            2
categories          kde kde4
maintainers         nicos
license             LGPL-2.1
description         Qt library for Open Collaboration Services API 1.4
long_description    ${name} is a ${description}
platforms           darwin
homepage            http://www.kde.org
master_sites        kde:stable/${name}
use_bzip2           yes
worksrcdir          ${name}-${version}
checksums           rmd160  fae94a0a9b9064b3e25a00a759e2ef450bffe7d8 \
                    sha256  3b9c53770862c0b21b7af7ea15951c35831126022bb8d052760d9cf8bd7ee4f8

if {${subport} eq "${name}"} {
    conflicts       "${name}-qt5"
    PortGroup       kde4 1.1
    depends_lib-delete \
                    port:phonon
    configure.args-append \
                    -DQT4_BUILD:BOOL=On
    post-destroot {
        ln -s libattica.0.4.dylib ${destroot}${prefix}/lib/libattica.0.dylib
    }
} else {
    conflicts       ${name}
    # for the time being...
    PortGroup       qt5 1.0
    PortGroup       cmake 1.0
    cmake.out_of_source yes
    patch.pre_args  -Np1
    patchfiles      qt5/patch-CMakeLists.diff \
                    qt5/patch-fix-qmap-include.diff
    post-extract {
        # install local copies of CMake files that used to be part of the ECM
        # but are now apparently part of kdelibs4support. When KF5 ports become
        # available there may be a more elegant way to build attica-qt5
        file copy ${filespath}/qt5/cmake/ ${worksrcpath}
    }
}

platform darwin 8 {
    configure.ldflags-append    -lz -lssl -lcrypto
}

subport ${name}-qt5 {
    description-append \
                    Qt5 version
    long_description-append \
                    Qt5 version
}


livecheck.url       http://kde.mirrors.hoobly.com/stable/${name}
livecheck.regex     attica-(\\d+\\.\\d+\\.\\d+)
