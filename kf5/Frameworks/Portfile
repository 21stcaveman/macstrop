# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
set kf5.framework   yes
PortGroup           kf5 1.1

name                KF5-Frameworks
version             ${kf5_version}
description         meta-port for the KF5 Frameworks
long_description    ${description}
maintainers         gmail.com:rjvbertin mk openmaintainer

installs_libs       yes
use_xz              yes

if {${subport} eq ${name}} {
    depends_build-append    port:kf5-frameworkintegration
    distname        frameworkintegration-${kf5_version}.tar.xz
    fetch {}
    checksum {}
    extract {}
    build {}
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-packages
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-packages/${name}"
    }
}

patch.pre_args      -Np1

subport kf5-attica {
    set kf5.framework \
                    attica
    checksums       rmd160  31c8e1deedfcf6465a614690e3c14cfa420edc54 \
                    sha256  94c928b84a82c44c1331a1b4d585e894524c4a023f90e1906eaf5441d955ad3d
}

subport kf5-karchive {
    set kf5.framework \
                    karchive
    checksums       rmd160  2f7c73a9ea1cedd76db61b34a2723e0844e31819 \
                    sha256  d0b5dfaf6a98ad40e499c67ec6788247c285c97564e2840a4faff90de27bb5e8
    patchfiles-append \
                    patch-karchive-add-qspxdg.diff
}

post-patch {
    # patch the find_package(Qt5) command to add the activator of the QSP patch (which selects XDG behaviour).
    # careful with the backslashes: it's a regular expression that must be passed on to sed(1) correctly!
    reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/CMakeLists.txt
    reinplace "s|\\(target_link_libraries(KF5\.\*\\)|\\1 PUBLIC Qt5::QspXDG|g" ${worksrcpath}/src/CMakeLists.txt
}

homepage            http://projects.kde.org/projects/${kf5.virtualPath}/${kf5.framework}
master_sites        http://download.kde.org/stable/${kf5.folder}
distname            ${kf5.framework}-${version}

livecheck.type          regex
livecheck.url           http://download.kde.org/stable/frameworks/${kf5_branch}
livecheck.regex         (5+(\\.\\d+)+)
