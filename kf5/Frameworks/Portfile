# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
set kf5.framework   yes
PortGroup           kf5 1.1

name                KF5-Frameworks
version             ${kf5.version}
description         meta-port for the KDE Frameworks Version 5
long_description    ${description}
maintainers         gmail.com:rjvbertin mk openmaintainer

installs_libs       yes
use_xz              yes
if {${os.platform} eq "darwin"} {
    test.run        no
} else {
    test.run        yes
}

variant qspXDG description {Configure Qt5's QStandardPaths to return XDG/Linuxy paths for shared locations} {
# The Qt5 QStandardPaths (QSP) patch allows QSP to return XDG/linuxy locations (paths) that are more suitable
# for a shared use of Qt5 in the MacPorts universe than the default values QSP returns that follow Apple's
# sandboxing dogmas. It must however be activated so that individual ports have the choice which "flavour" they
# use. KF5 applications should (probably) by using the XDG/Linuxy flavour unless they are to be built into
# individual, autonomous app bundles that each contain all required dependencies.
# Activation of the QSP patch is done by linking an additional, dedicated Qt component: Qt5::QspXDG .
# The approach philosophy used here is to link that component with all KF5 frameworks and helper applications
# built as part of those frameworks, even if they do not use the QSP class themselves. This redundancy comes
# with an overhead that should be negligible, and serves to lower the maintenance burden (monitoring the
# appearance of QSP usage).
#
# KF5 autotests were conceived to run with XDG-compliant QSP locations, and wreak havock when they are not.
    test.run        yes
}

platform "darwin" {
    if {[file exists ${qt_cmake_module_dir}/Qt5QspXDG/Qt5QspXDGConfig.cmake]} {
        default_variants \
                    +qspXDG
    } else {
        ui_debug "We appear to be building against a Qt5 port that doesn't have the QSP patch from port:qt5-kde. Don't fight it, just warn."
        notes-append "You will be running KF5 applications with the stock/native Qt5::QStandardPaths behaviour.\
                     That is not the recommended configuration for this port."
    }
}
if {(${os.platform} eq "darwin") && ![variant_isset qspXDG]} {
    # NOTE: Many kf5 ports violate MacPorts' ports file systems,
    #       but it is a must due to Qt5's QStandardPaths logic,
    #       so we'll quieten the warning this causes.
    destroot.violate_mtree  yes
}

patch.pre_args      -Np0

pre-patch {
    if {[variant_isset qspXDG] && ${subport} ne "kf5-tier1-frameworks" \
        && ${subport} ne "kf5-tier2-frameworks" && ${subport} ne "kf5-tier3-frameworks"} {
        # patch the find_package(Qt5) command to add the activator of the QSP patch (which selects XDG behaviour).
        # careful with the backslashes: it's a regular expression that must be passed on to sed(1) correctly!
        reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/CMakeLists.txt
        if {[file exists ${worksrcpath}/src/CMakeLists.txt]} {
            reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/src/CMakeLists.txt
            reinplace "s|\\(target_link_libraries(KF5\[\^ \$\]\*\\)|\\1 PRIVATE Qt5::QspXDG|g" ${worksrcpath}/src/CMakeLists.txt
        }
    }
}

post-destroot {
    if {[variant_exists examples] && [variant_isset examples] && [file exists ${build.dir}/examples]} {
        ui_debug "Installing examples"
        xinstall -m 755 -d ${destroot}${kf5.applications_dir}/examples
        foreach app [glob -nocomplain ${build.dir}/examples/*.app ${build.dir}/examples/*/*.app] {
            file copy ${app} ${destroot}${kf5.applications_dir}/examples/
        }
    }
}

### === Tier 1 ===

subport kf5-attica {
    description     Open Collaboration Service client library
    long_description \
                    Attica is a Qt library that implements the Open Collaboration Services API version 1.6 .
    set kf5.framework \
                    attica
    checksums       rmd160  ab50872d74de9e8c473bb37ae2c07efe75c9ad39 \
                    sha256  bc24370e43061d6fb555a030f82c51cc907113b8420c4207a0fb6d9190bb699c
    conflicts       attica-qt5
}

subport kf5-kapidox {
    description     KDE Doxygen Tools
    long_description \
                    This framework contains scripts and data for building API documentation (dox) in \
                    a standard format and style. \
                    The Doxygen tool is used to do the actual documentation extraction and \
                    formatting, but this framework provides a wrapper script to make generating the \
                    documentation more convenient (including reading settings from the target \
                    framework or other module) and a standard template for the generated \
                    documentation.
    set kf5.framework \
                    kapidox
    checksums       rmd160  0b35d258390e92e699f4e0888b1f323680f01178 \
                    sha256  4405e8b2e8df3cce10a25b864067f7a7fec1452bde94a426b36eb6b9b4b6dd3d
    installs_libs   no
    supported_archs noarch
    depends_build-append \
                    ${kf5.pythondep}
    depends_run-append \
                    ${kf5.pythondep} \
                    port:py${kf5.pybranch}-yaml \
                    port:py${kf5.pybranch}-jinja2
    platform "darwin" {
        # doxygen has a *lot* of dependencies all the way to Xorg, which are
        # complete overkill for a *runtime* dependency on Linux. Get it from
        # the host there.
        # doxyqml supports only Python 2.7
        depends_run-append \
                    port:doxygen \
                    port:py27-doxyqml
    }
    patchfiles-append \
                    patch-kapidox-include-objc++.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    post-destroot {
        if {${os.platform} eq "darwin"} {
            xinstall -m 755 -d ${destroot}/${kf5.pylibdir}
            file rename ${destroot}${prefix}/lib/python${kf5.pyversion}/site-packages ${destroot}/${kf5.pylibdir}
        } elseif {${os.platform} eq "linux"} {
            foreach b [glob -nocomplain ${destroot}${prefix}/bin/*] {
                reinplace "s|/usr/bin/python|${prefix}/bin/python|g" ${b}
                reinplace "s|'/usr/share/doc/qt'|'${prefix}/libexec/qt5/doc'|g" ${b}
                reinplace "s|/usr/share|${prefix}/share|g" ${b}
            }
        }
    }
    test.cmd        echo
    test.target     no tests for this framework
    notes-append    "It is recommended to install the Roboto fonts for optimal displaying of documentation generated \
                    through kf5-kapidox and doxygen. See http://www.google.com/fonts/specimen/Roboto ."
}

subport kf5-karchive {
    description     Reading, creating, and manipulating file archives
    long_description \
                    KArchive provides classes for easy reading, creation and manipulation of \
                    "archive" formats like ZIP and TAR. \
                    It also provides transparent compression and decompression of data, like the \
                    GZip format, via a subclass of QIODevice.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    karchive
    checksums       rmd160  cae84cbe7bc2333ef132e8e0c66de4096d7d9a1f \
                    sha256  ec3206e8249180e9661b4303a94dfb120d47642abe31d102cde7276ee9b1c866
    depends_lib-append \
                    port:zlib
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kcodecs {
    description     String encoding library
    long_description \
                    KCodecs provide a collection of methods to manipulate strings using various \
                    encodings. It can automatically determine the charset of a string, translate XML entities, \
                    validate email addresses, and find encodings by name in a more tolerant way than QTextCodec \
                    (useful e.g. for data coming from the Internet).
    set kf5.framework \
                    kcodecs
    checksums       rmd160  a9db624f5d27db4b91abedbe81360ee9fa2319d2 \
                    sha256  97d10cc6166b75da514c1d62f42226edccdcdae50fb65e76a2f02c7cab919e98
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kconfig {
    description     Persistent platform-independent application settings.
    long_description \
                    KConfig provides an advanced configuration system. It is made of two parts with the evocative names \
                    KConfigCore and KConfigGui.
    set kf5.framework \
                    kconfig
    checksums       rmd160  40cb8008fc1668885e01072e1a8e2c80443619fa \
                    sha256  aefe6845bf70d4cff938e0ad7878049ffbba2251cbd3afad938a7c326b8fe1a0
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kconfig-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kconfig-prefix-etc.diff
    post-patch {
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/core/kconfig.cpp
    }
}

subport kf5-kcoreaddons {
    description     Qt addon library with a collection of non-GUI utilities
    long_description \
                    KCoreAddons provides classes built on top of QtCore to perform various tasks \
                    such as manipulating mime types, autosaving files, creating backup files, \
                    generating random sequences, performing text manipulations such as macro \
                    replacement, accessing user information and many more.
    set kf5.framework \
                    kcoreaddons
    checksums       rmd160  241d32e1727675509a76c4858be7d432b2efe9fe \
                    sha256  d511728e7abff74ebbde6efe06ef10bab110bf95d1999aaf50826050a66684a4
    depends_lib-append \
                    port:shared-mime-info
    if {[variant_isset qspXDG]} {
        # desktoptojson doesn't currently use QSP so doesn't require the activator
        patchfiles-append \
                    patch-kcoreaddons-add-qspxdg.diff
    }
    platform "darwin" {
        configure.args-append \
                    -DKDE4_DEFAULT_HOME=Library/Preferences/KDE
    }
}

subport kf5-kdbusaddons {
    description     Convenience classes for DBus
    long_description \
                    KDBusAddons provides convenience classes on top of QtDBus, as well as an API to \
                    create KDED modules.
    set kf5.framework \
                    kdbusaddons
    checksums       rmd160  1d99a93ab64471003576fbc11648166f3a2d5f2f \
                    sha256  ea9b6c4059c0e4205347c6e72f2fe3f175eb1aebe32c1d6d822a7a1d617d6e7a
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdbusaddons-add-qspxdg.diff
    }
}

subport kf5-kdnssd {
    description     Network service discovery using Zeroconf
    long_description \
                    KDNSSD is a library for handling the DNS-based Service Discovery Protocol \
                    (DNS-SD), the layer of Zeroconf(TM) that allows network \
                    services, such as printers, to be discovered without any user intervention or \
                    centralised infrastructure.
    set kf5.framework \
                    kdnssd
    checksums       rmd160  25c6c5478d06d1e2d85b1620629d2445f1a1c501 \
                    sha256  83ede535d2d01dae9dea489fe2cbd1517b4e3508fef96cadf8bb9c7df8ee41b7
    platform "darwin" {
        # Avahi is required but apparently only at runtime
        depends_run-append \
                    port:avahi
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kguiaddons {
    description     Utilities for graphical user interfaces
    long_description \
                    The KDE GUI addons provide utilities for graphical user interfaces in the areas \
                    of colours, fonts, text, images, keyboard input.
    set kf5.framework \
                    kguiaddons
    checksums       rmd160  f5baf84c4dd176819d63b1d6fa31a7d977c2015e \
                    sha256  64a176acbb0918d1c7dd41efb54449b96ec39624cc0679039fef770332cc60bf
    if {[variant_isset qspXDG]} {
        # this is a probable case of currently unneeded QSP patch activation
        patchfiles-append \
                    patch-kguiaddons-add-qspxdg.diff
    }
}

subport kf5-ki18n {
    description     KDE Gettext-based UI text internationalisation
    long_description \
        KI18n provides functionality for internationalising user interface text \
        in applications, based on the GNU Gettext translation system. \
        It wraps the standard Gettext functionality, so that the programmers \
        and translators can use the familiar Gettext tools and workflows. \
        KI18n provides additional functionality as well, for both programmers \
        and translators, which can help to achieve a higher overall quality \
        of source and translated text. This includes argument capturing, \
        customisable markup, and translation scripting.
    set kf5.framework \
                    ki18n
    checksums       rmd160  c401af6263b4d8d914a023a23dd5722f895b0551 \
                    sha256  fc0adac69568672e26fd4daa201a33a2e9c4e854460dd1f3bd64a10eba8d1d22
    depends_build-append \
                    port:gettext
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-ki18n-add-qspxdg.diff
    }
}

subport kf5-kidletime {
    description     Reporting of idle time of user and system
    long_description \
                    KIdleTime is a singleton reporting information on idle time. It is useful not \
                    only for finding out about the current idle time of the host, but also for getting \
                    notified upon idle time events, such as custom timeouts, or user activity.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kidletime
    checksums       rmd160  8ddacad270e4f98cb32eaeb9822a3a3339e88122 \
                    sha256  a7e4d9ea87e315419c1958450a567ffb17ff44c22add436f3b0d9428eceaa1e8
    patchfiles-append \
                    patch-kidletime-use-iokit.diff \
                    patch-kidletime-xsync.diff
    if {[variant_isset docs]} {
        patchfiles-append \
                    patch-kidletime-documentation.diff
    }
    # RJVB: kidletime currently seems to use a Carbon-based poller ; check if I haven't already implemented
    # something more native for KDE4.
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kimageformats {
    description     Plugins to allow QImage to support extra file formats.
    long_description \
                    This framework provides additional image format plugins for QtGui. \
                    As such it is not required for the compilation of any other software, \
                    but may be a runtime requirement for Qt-based software to support \
                    certain image formats.
    set kf5.framework \
                    kimageformats
    checksums       rmd160  a474a38dbc0bfe695cc7b17d58a499dce96f8170 \
                    sha256  faa4f381260a00b33ad620bfc57b6ae45dabb65e0cf9b353e3be35edc7af5a0a
    platform "darwin" {
        depends_lib-append \
                    port:openexr
    }
    if {[variant_isset qspXDG]} {
        # adding the QSP activator to the plugins too for now; should be unnecessary.
        patchfiles-append \
                    patch-kimageformats-add-qspxdg.diff
    }
}

subport kf5-kitemmodels {
    description     Set of item models extending the Qt model-view framework
    long_description \
                    Set of item models extending the Qt model-view framework
    set kf5.framework \
                    kitemmodels
    checksums       rmd160  cc465f599d6dfde5798f5479f9a607bc33a616cd \
                    sha256  e2b527bd13bbdbe7ccda38ec0b31efb7b2047ec72b3c8e92c117c3df1422a9ae
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
    kf5.add_test_library_path \
                    ${build.dir}/autotests/proxymodeltestsuite
}

subport kf5-kitemviews {
    description     Set of item views extending the Qt model-view framework
    long_description \
                    KItemViews includes a set of views, which can be used with item models. It \
                    includes views for categorising lists and to add search filters to flat and \
                    hierarchical lists.
    set kf5.framework \
                    kitemviews
    checksums       rmd160  d6a53edbb72073a8fd8f04055d5364da58dced43 \
                    sha256  caf4db11b25e8a0d61be476318a877ce97df354057f2c97913d00f27230d64af
}

subport kf5-kplotting {
    description     A lightweight plotting framework
    long_description \
                    KPlotWidget is a QWidget-derived class that provides a virtual base class \
                    for easy data-plotting. The idea behind KPlotWidget is that you only have \
                    to specify information in \"data units\"\; i.e., the natural units of the \
                    data being plotted.  KPlotWidget automatically converts everything \
                    to screen pixel units.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kplotting
    checksums       rmd160  b73994a054bbf58db894fc7f334920398ff223f6 \
                    sha256  e747f6886c4aa2ffc0bc6df3b61b3ef04287772959c42ff4b6c851511c2284b9
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kplotting-add-qspxdg.diff
    }
}

subport kf5-kwidgetsaddons {
    description     A large set of desktop widgets
    long_description \
                    This repository contains add-on widgets and classes for applications \
                    that use the Qt Widgets module. If you are porting applications from \
                    KDE Platform 4 "kdeui" library, you will find many of its classes here. \
                    Provided are action classes that can be added to toolbars or menus, \
                    a wide range of widgets for selecting characters, fonts, colours, \
                    actions, dates and times, or MIME types, as well as platform-aware \
                    dialogs for configuration pages, message boxes, and password requests. \
                    Further widgets and classes can be found in other KDE frameworks.
    set kf5.framework \
                    kwidgetsaddons
    checksums       rmd160  5069f230c0e6de4aa45796e67c4182a7da1c5baa \
                    sha256  4385540afdf74f696271dbf78a34a1c5e9509094a6a201b96f3a9471f98cfe6f
}

subport kf5-kwindowsystem {
    description     Access to the windowing system
    long_description \
                    Convenience access to certain properties and features of the windowing system. \
                    KWindowSystem provides information about the windowing system and allows interaction with \
                    the windowing system. It provides a high level API which is windowing system independent and \
                    has platform specific implementations. This API is inspired by X11 and thus not all functionality \
                    is available on all windowing systems. On Mac OS X, X11 support is not included though that \
                    would be possible theoretically.
    set kf5.framework \
                    kwindowsystem
    checksums       rmd160  fc0c7acb169d137bc8595a03cc6a01e438b682e1 \
                    sha256  2f8aac7a1c9002b8647f26ad556e3265a004cbd1055eff5be3769c02bc06141e
    platform "darwin" {
        test.cmd    echo
        test.target no tests for this framework
    }
}

subport kf5-solid {
    description     Desktop hardware abstraction
    long_description \
                    Solid is a device integration framework.  It provides a way of querying and \
                    interacting with hardware independently of the underlying operating system.
    set kf5.framework \
                    solid
    checksums       rmd160  9c30ecdeaba7f6464d2ed52b1f739f3bf72bc38a \
                    sha256  540350b1ad1438b15c1b4d40b868d26653647391b2e6c72f154fe1cad0b2a4ce
    if {${os.platform} eq "darwin"} {
        depends_build-append \
                    port:flex \
                    port:bison
    } else {
        # apparently not needed after all:
        #            patch-solid-findudev.diff
        patchfiles-append \
                    patch-solid-xdgdatadirs.diff
        post-patch {
            reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/cmake/FindMediaPlayerInfo.cmake
        }
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-solid-add-qspxdg.diff
    }
    configure.args-append \
                    -DWITH_NEW_SOLID_JOB=ON
}

subport kf5-sonnet {
    description     Multi-language spell checker
    long_description \
                    Sonnet is a plugin-based spell checking library for Qt-based \
                    applications. It supports several different plugins, including \
                    HSpell, Enchant, ASpell and HUNSPELL. \
                    It also supports automated language detection, based on a \
                    combination of different algorithms.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    sonnet
    checksums       rmd160  600295f95e7792946576a34b4056219f7c612c38 \
                    sha256  2762716e5be36989b17ef4f9b3a4804f39af961e82019878cf6d53266312c7ba
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-sonnet-add-qspxdg.diff
    }
    platform "darwin" {
        # this patch should be submitted upstream
        patchfiles-append \
                    patch-sonnet-use-qsettings-iniformat.diff
        # backend variants. Don't attempt to deactivate non-selected backends for now.
        variant aspell description {build the aspell backend} {
            depends_lib-append \
                    port:aspell
        }
        variant hunspell description {build the hunspell backend} {
            depends_lib-append \
                    port:hunspell
        }
        default_variants-append \
                    +aspell
    }
}

subport kf5-threadweaver {
    description     threadweaver
    long_description \
                    threadweaver
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    threadweaver
    checksums       rmd160  24a995e5e46ff49a262829e80956462676f9d152 \
                    sha256  9e7841e81eabaa4a9ae38dee5b3e724af919ff7e2795e805c77c2f43dd97daaa
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

### === Tier 2 ===

subport kf5-kauth {
    description     Execute actions as privileged user
    long_description \
                    KAuth provides a convenient, system-integrated way to offload actions that need \
                    to be performed as a privileged user (root, for example) to small (hopefully \
                    secure) helper utilities.
    set kf5.framework \
                    kauth
    checksums       rmd160  5d9c64a03ccc0681b380868c93b0255fa99c3203 \
                    sha256  c36ab0caddf1c3120546cff825098513585d461a27f94da78547b2792a61e2a4
    if {[variant_isset qspXDG]} {
        # there is no need to add the activator to desktoptojson, at the moment
        patchfiles-append \
                    patch-kauth-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kauth-nongui-policy-gen.diff
    kf5.depends_frameworks \
                    kcoreaddons
    # on linux, PolkitQt5-1 or PolkitQt-1 is required
    platform "linux" {
        depends_lib-append \
                    port:polkit-qt5
    }
}

subport kf5-kcompletion {
    description     Powerful completion framework, including completion-enabled lineedit and combobox.
    long_description \
                    When typing filenames, email addresses and other text where the user often wants \
                    to select from existing data (including what they previously typed) rather than \
                    enter anything wholly original, users often find it helpful if they only need to \
                    type the first few characters, and then have the application offer them a set of \
                    choices or attempt to finish off what they were typing. Email clients, shells \
                    and \"open file\" dialogs often provide this functionality. \
                    This framework helps implement this in Qt-based applications. You can use one of \
                    the completion-ready widgets provided by this framework, or integrate it into \
                    your application's other widgets directly.
    set kf5.framework \
                    kcompletion
    checksums       rmd160  4617d8c7b9dfa547cebe5a2cdfab44734c7e7474 \
                    sha256  4230e44395ec59e855fd4e70ebfd1d7a62fd1182c2a07d0cc4cee5234bc39620
    kf5.depends_frameworks \
                    kconfig kwidgetsaddons
}

subport kf5-kcrash {
    description     Graceful handling of application crashes
    long_description \
                    KCrash provides support for intercepting and handling application crashes.
    set kf5.framework \
                    kcrash
    checksums       rmd160  816f192ba3bf45e22d4a8b53c5fb341fa2e48680 \
                    sha256  4971dc462af809e443ef7c374a9404d70ec59f3cab52e0e330d6e8fee96e67ae
    kf5.depends_frameworks \
                    kcoreaddons kwindowsystem
    platform "darwin" {
        patchfiles-append \
                    patch-kcrash-dont-closeAllFDs.diff \
                    patch-kcrash-no-display.diff
    }
}

subport kf5-kdoctools {
    description     Create documentation from DocBook
    long_description \
                    Provides tools to generate documentation in various format from DocBook files.
    set kf5.framework \
                    kdoctools
    checksums       rmd160  362ead48f18f32d806c8f161963048aba9d28cf0 \
                    sha256  ebd187ee31c8c2e58f17e373d0218c50920eaa998bd7ac39e570e9f77213c8e1
    depends_build-append \
                    ${kf5.ki18n_dep} \
                    ${kf5.pythondep}
    depends_lib-append \
                    ${kf5.karchive_dep} \
                    port:libxslt \
                    port:docbook-xml \
                    port:docbook-xsl \
                    port:p5.16-uri \
                    port:gettext
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    if {[variant_isset qspXDG]} {
        # kdoctools builds a *static* library, which may mean we'll have to include the activator
        # as source if it turns out that that library is used as the only KF5 framework.
        patchfiles-append \
                    patch-kdoctools-add-qspxdg.diff
    }
# this patch is unnecessary if the kdelibs4 headers are moved out of the ${prefix}/include root
#     if {${os.platform} eq "darwin"} {
#         # workaround what appears to be a bug in the kdoctools buildsystem that
#         # causes it to pick up KDE4 headerfiles when they're present:
#         patchfiles-append \
#                     patch-kdoctools-xslt_kde.cpp.diff
#     }
    configure.args-append \
                        -DDOCBOOKXSL_DIR=${prefix}/share/xsl/docbook-xsl \
                        -DLIBXML2_INCLUDE_DIR=${prefix}/include/libxml2 \
                        -DLIBXML2_LIBRARIES=${prefix}/lib/libxml2.${kf5.libs_ext} \
                        -DLIBXML2_XMLLINT_EXECUTABLE=${prefix}/bin/xmllint \
                        -DLIBXSLT_INCLUDE_DIR=${prefix}/include \
                        -DLIBXSLT_LIBRARIES=${prefix}/lib/libxslt.${kf5.libs_ext}
}

subport kf5-kfilemetadata {
    description     A file metadata and text extraction library
    long_description \
                    KFileMetaData provides a simple library for extracting the text and metadata \
                    from a number of different files. This library is typically used by file \
                    indexers to retreive the metadata.
    set kf5.framework \
                    kfilemetadata
    checksums       rmd160  9da8d5a4936ef060f65ad332221fb4be7a1a1705 \
                    sha256  f5fa2b05d772a49e5fd2e4519ddfe00376e391400c5120fdc688effcee83c7f9
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    depends_lib-append \
                    ${kf5.karchive_dep} \
                    ${kf5.ki18n_dep} \
                    port:exiv2
    platform "darwin" {
        depends_lib-append \
                    port:poppler-qt5-mac \
                    port:taglib \
                    path:lib/libavcodec.dylib:ffmpeg \
                    port:ebook-tools
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    variant kde4compat description {allow installation alongside KDE4's port:kfilemetadata} {
        # note: it might be useful to provide a complementary variant to port:kfilemetadata
        post-destroot {
            file delete -force ${destroot}${prefix}/share/locale
        }
    }
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kfilemetadata
    }
}

subport kf5-kjobwidgets {
    description     Widgets for showing progress of asynchronous jobs
    long_description \
                    KJobWIdgets provides widgets for showing progress of asynchronous jobs.
    set kf5.framework \
                    kjobwidgets
    checksums       rmd160  97bb6858f77d5375c80a6c101e4adb59f96b988f \
                    sha256  aa4f90d776ab6d0d3cc668d5287f5e233f867f723abcb9876224898218a7ac1d
    kf5.depends_frameworks \
                    kcoreaddons kwidgetsaddons
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-knotifications {
    description     Desktop notifications
    long_description \
                    KNotification is used to notify the user of an event. It covers feedback and \
                    persistent events.
    set kf5.framework \
                    knotifications
    checksums       rmd160  7c73fd99f63338efcbede3aefe956bc1b0c6fdbb \
                    sha256  aa1013ab1bd82d431dd80ed849af38d156e471de264c566fb5792b271432d92d
    kf5.depends_frameworks \
                    kconfig kcodecs \
                    kcoreaddons kwindowsystem
    depends_lib-append \
                    port:phonon-qt5 \
                    port:dbusmenu-qt5
    platform "darwin" {
        # ignore KDE_FULL_SESSION if it's set
        patchfiles-append \
                    patch-knotifications-ignore-full_session-envvar.diff
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kpackage {
    description     Installation and loading of additional content \(ex: scripts, images...\) as packages
    long_description \
                    The Package framework lets the user install and load packages of non binary content \
                    such as scripted extensions or graphic assets, as if they were traditional plugins.
    set kf5.framework \
                    kpackage
    checksums       rmd160  0eb4c8753505981cb07aef27ed7cb14da2fb6d5c \
                    sha256  57e5dc4a8e084bb1140e519f97a808ef76c8ae01071cc62db666190fde6a474b
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    karchive kconfig kcoreaddons ki18n
    platform "darwin" {
        patchfiles-append \
                    patch-kpackage-add-qspxdg.diff
    }
    # this one ought to be reported upstream:
    patchfiles-append \
                    patch-kpackage-autotests+tool-nogui.diff
#     pre-test {
#         foreach t [glob -nocomplain ${build.dir}/autotests/*.app/Contents/MacOS/*] {
#             ln -s ${t} ${build.dir}/autotests/[file tail ${t}]
#         }
#     }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kpty {
    description     Interfacing with pseudo terminal devices
    long_description \
                    This library provides primitives to interface with pseudo terminal devices \
                    as well as a KProcess derived class for running child processes and \
                    communicating with them using a pty.
    set kf5.framework \
                    kpty
    checksums       rmd160  fd26680eaf2d4d4fed9bc3e8f303909241541a36 \
                    sha256  6c7b9d5803196f3873a51eb5ac3a95cbacc7fa4b142e26284840cb9d87e69a1c
    kf5.depends_frameworks \
                    kcoreaddons ki18n
}

subport kf5-kunitconversion {
    description     Converting physical units
    long_description \
                    KUnitConversion provides functions to convert values in different physical \
                    units. It supports converting different prefixes (e.g. kilo, mega, giga) as \
                    well as converting between different unit systems (e.g. liters, gallons).
    set kf5.framework \
                    kunitconversion
    checksums       rmd160  4a146a408f33cb4d5c9cc5a86503c4d605a69896 \
                    sha256  945a005a667ef47f8bd1a288a4b1f7591c248edfedf0601dd469c2f083aaf5de
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfig ki18n
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

### === Tier 3 ===

subport kf5-baloo {
    description     File searching and indexing
    long_description \
                    Baloo provides file searching and indexing. It does so by maintaining an index \
                    of the contents of your files. It isn't functional on Mac OS X and present only \
                    to be able to satisfy dependencies.
    set kf5.framework \
                    baloo
    checksums       rmd160  a5bd526f77c666449a706e31da2b438847777d38 \
                    sha256  12d5671378ec8d6d6c34496adff6f8b4d1d814771d6af594d4074d35084e1469
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons \
                    kfilemetadata ki18n kidletime kio \
                    solid
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-baloo-add-qspxdb.diff
    }
    platform "darwin" {
        depends_lib-append \
                    port:lmdb
        patchfiles-append \
                    patch-baloo-nongui-execs.diff
        post-destroot {
            # delete a file that isn't supposed to be used, and conflicts with KDE4's baloo:
            if {[file exists ${destroot}${prefix}/share/dbus-1/interfaces/org.kde.baloo.file.indexer.xml]} {
                file delete ${destroot}${prefix}/share/dbus-1/interfaces/org.kde.baloo.file.indexer.xml
            }
            foreach ld [glob -nocomplain ${destroot}${prefix}/share/locale/*/LC_MESSAGES] {
                foreach mo {baloo_file.mo baloo_file_extractor.mo baloosearch.mo balooshow.mo \
                        kio_baloosearch.mo kio_tags.mo kio_timeline.mo} {
                    if {[file exists ${ld}/${mo}]} {
                        file delete ${ld}/${mo}
                    }
                }
            }
            # rename a conflicting icon file (since baloo/Mac is supposed to be non-functional anyway)
            file rename ${destroot}${prefix}/share/icons/hicolor/128x128/apps/baloo.png \
                        ${destroot}${prefix}/share/icons/hicolor/128x128/apps/baloo5.png
        }
        test.cmd        echo
        test.target     no tests on OS X for this framework
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kbookmarks {
    description     Bookmarks management library
    long_description \
                    KBookmarks lets you access and manipulate bookmarks stored using the \
                    XBEL format (http://pyxml.sourceforge.net/topics/xbel)
    set kf5.framework \
                    kbookmarks
    checksums       rmd160  f33e32f2630f76e8b11e80331b88f6a13a9b5ca7 \
                    sha256  f220611b7df9a629a36dfb012a98f66e82558604d326cb60f82751e286a63e01
    kf5.depends_frameworks \
                    kcodecs kconfigwidgets kcoreaddons \
                    kiconthemes kwidgetsaddons kxmlgui
}

subport kf5-kcmutils {
    description     Utilities for KDE System Settings modules
    long_description \
                    KCMUtils provides various classes to work with KCModules. KCModules can be \
                    created with the KConfigWidgets framework.
    set kf5.framework \
                    kcmutils
    checksums       rmd160  2f404497de3e4574f84f4302e1ee0714ec5fc2af \
                    sha256  341330dba9cc50cfa035460c94f79892f5908e116f7a0f084be36e53f9a3e3b3
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfigwidgets kcoreaddons kdeclarative ki18n \
                    kiconthemes kitemviews kservice kxmlgui kpackage
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kconfigwidgets {
    description     Widgets for configuration dialogs
    long_description \
                    KConfigWidgets provides easy-to-use classes to create configuration dialogs, as \
                    well as a set of widgets which uses KConfig to store their settings.
    set kf5.framework \
                    kconfigwidgets
    checksums       rmd160  8334a286f7e7fb60bc28745fa20da434574f2e31 \
                    sha256  26ae840357c230c824789efde5892abc2c78d067ca474a90487f5b5c9248f486
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kauth kconfig kcodecs kcoreaddons \
                    kdoctools kguiaddons ki18n kwidgetsaddons
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kdeclarative {
    description     Integration of QML and KDE work spaces
    long_description \
                    KDeclarative provides integration of QML and KDE work spaces. \
                    It's comprises two parts: a library used by the C++ part of your application \
                    to intergrate QML with KDE Frameworks specific features, and a series of \
                    QML imports that offer bindings to some of the KDE Frameworks.
    set kf5.framework \
                    kdeclarative
    checksums       rmd160  0b06002b73ee002c2709da57527c120ebf1a6e18 \
                    sha256  a42d1f1900902cab4ba28d8c374c358fbd6697500eb18f004448fcd4b6e06832
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kpackage kconfig kio \
                    kiconthemes ki18n
    platform "darwin" {
        depends_lib-append \
                    port:libepoxy
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdeclarative-add-qspxdb.diff
    }
    patchfiles-append \
                    patch-kdeclarative-nongui.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kded {
    description     Central daemon of KDE work spaces
    long_description \
                    KDED is the KDE Daemon which runs in the background and performs \
                    a number of small tasks. \
                    Some of these tasks are built in, others are started on demand.
    set kf5.framework \
                    kded
    checksums       rmd160  c2d5282d5f1ece3df752e835c496fe3ca89bc495 \
                    sha256  18752b8928f97fba456d8badb1c378a45b24447ed503ac622136cd8492ea155c
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash \
                    kdbusaddons kdoctools kinit kservice
    # test and propose upstream:
    # https://git.reviewboard.kde.org/r/126170/
    patchfiles-append \
                    patch-kded-nongui-kded.diff
    platform "darwin" {
        # ignore KDE_FULL_SESSION if it's set
        patchfiles-append \
                        patch-kded-ignore-full_session-envvar.diff
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kdesignerplugin {
    description     Integrating KDE frameworks widgets with Qt Designer
    long_description \
                    This framework provides plugins for Qt Designer that allow it to display \
                    the widgets provided by various KDE frameworks, as well as a utility \
                    (kgendesignerplugin) that can be used to generate other such plugins \
                    from ini-style description files.
    set kf5.framework \
                    kdesignerplugin
    checksums       rmd160  c05af88224c9048c53c966892357c95aa1cf70ad \
                    sha256  c5a463a850c1830dbe92455b0595bad4797c434adb424e5a65d36f6fc16953f4
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfig kcoreaddons kdewebkit kdoctools
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdesignerplugin-add-qspxdb.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
#     test.cmd        echo
#     test.target     no tests for this framework
}

subport kf5-kdewebkit {
    description     Integration of the HTML rendering engine WebKit
    long_description \
                    This library provides KDE integration of the QtWebKit library.
    set kf5.framework \
                    kdewebkit
    checksums       rmd160  8782782474f990a00fe4ff664cda48d56189ba21 \
                    sha256  8a9b7a57e6f86cddfd4d75123dbe8226a805f6669fbd5601b9e9b636669006db
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfig kcoreaddons kio \
                    kjobwidgets kparts kservice kwallet
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kemoticons {
    description     Convert text emoticons to graphical emoticons
    long_description \
                    KEmoticons converts emoticons from text to a graphical representation with \
                    images in HTML. It supports setting different themes for emoticons coming \
                    from different providers.
    set kf5.framework \
                    kemoticons
    checksums       rmd160  bf799fae8a72d19fa904c96d22bca02fa7b0535c \
                    sha256  ba4ec30be11629fc046f1727eaa2c6ee80c26c23d953cf08214e6e600251d498
    kf5.depends_frameworks \
                    karchive kconfig kservice kcoreaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kemoticons-add-qspxdg.diff
    }
}

subport kf5-kglobalaccel {
    description     Global desktop keyboard shortcuts
    long_description \
                    KGlobalAccel allows you to have global accelerators that are independent of \
                    the focused window.  Unlike regular shortcuts, the application's window does not \
                    need focus for them to be activated. \
                    This framework is present only for dependency purposes: it is currently not operational on OS X.
    set kf5.framework \
                    kglobalaccel
    checksums       rmd160  bd24c5c7abe436cc69c12d196a65da6edc8dae54 \
                    sha256  bb8e7c1ef7db0ecf9886388834707f7851bf49225fb277331e5f8db250841d8a
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons ki18n
    patchfiles-append \
                    patch-kglobalaccel-agent-and-nogui.diff
}

subport kf5-kiconthemes {
    description     Icon GUI utilities
    long_description \
                    This library contains classes to improve the handling of icons \
                    in applications using the KDE Frameworks.
    set kf5.framework \
                    kiconthemes
    checksums       rmd160  29e15868b62728769439d78aa6cf39f45a0f1299 \
                    sha256  537b58f69ca22ae5493b5a206e266ef7775bfd9510268ba8ec46fddac8cfc983
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfigwidgets ki18n kitemviews kwidgetsaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kiconthemes-add-qspxdg.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kinit {
    description     Helper library to speed up start of applications on KDE workspaces
    long_description \
                    kdeinit is a process launcher somewhat similar to the famous init used for \
                    booting UNIX. It launches processes by forking and then loading a dynamic \
                    library which should contain a 'kdemain(...)' function. Using kdeinit to \
                    launch KDE applications makes starting a typical KDE applications about 2.5 \
                    times faster. It also reduces memory consumption per application.
    set kf5.framework \
                    kinit
    checksums       rmd160  4594042faad7cb5d035b724a1708d191f70f4730 \
                    sha256  e001df052765712b53b817a2a0ade6a18fee4deb013952d096f248baaeef97ba
    kf5.depends_frameworks \
                    kconfig kcrash kdoctools ki18n \
                    kio kservice kwindowsystem
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kinit-add-qspxdg.diff
    }
    # test and propose upstream:
    # https://git.reviewboard.kde.org/r/126161/
    patchfiles-append \
                    patch-kinit-nonguis-andavoid-kdeinit-crash.diff
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kio {
    description     Network transparent access to files and data
    long_description \
                    This framework implements almost all the file management functions you \
                    will ever need. It supports accessing files locally as well as via HTTP \
                    and FTP out of the box and can be extended by plugins to support other \
                    protocols as well.
    set kf5.framework \
                    kio
    checksums       rmd160  d529376d7584468e10d85712f7af314539c85452 \
                    sha256  3b5ee93fe1796091d387b9cabdc768c9d3b111b30cee24da74d9bab9b927a9d6
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    depends_lib-append \
                    port:libxslt \
                    port:libxml2 \
                    port:zlib
    platform "darwin" {
        depends_lib-append \
                    port:kerberos5
    }
    kf5.depends_frameworks \
                    karchive kbookmarks kcompletion kconfigwidgets \
                    kcoreaddons kcrash kdbusaddons kdoctools \
                    kguiaddons ki18n kiconthemes kitemviews \
                    kjobwidgets knotifications kservice ktextwidgets \
                    kwallet kwidgetsaddons kwindowsystem kxmlgui solid
    if {[variant_isset qspXDG]} {
        patchfiles-append \
            patch-kio-add-qspxdg.diff
    }
    # submit upstream:
    patchfiles-append \
                    patch-kio-nongui-kiod-and-agent.diff \
                    patch-kio-nongui-httpcachecl.diff
    # https://git.reviewboard.kde.org/r/126125/ :
    # committed in #73d50f44
    patchfiles-append \
                    patch-kio-use-osxtrash.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kparts {
    description     Plugin framework for user interface components
    long_description \
                    KParts implements the framework for KDE parts, which are \
                    elaborate widgets with a user-interface defined in terms of actions \
                    (menu items, toolbar icons).
    set kf5.framework \
                    kparts
    checksums       rmd160  8fd2f86d92282cfeeeb509934f12591be3f1d41f \
                    sha256  045be6fd8017ad14861cde2889df904f81530bf057eb260b430d80d4452e803c
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kio knotifications \
                    ktextwidgets kxmlgui
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kpeople {
    description     kpeople
    long_description \
                    kpeople
    set kf5.framework \
                    kpeople
    checksums       rmd160  5643feb06fd6a2aa351c5f4dd08ff9a9fd7a6df9 \
                    sha256  15bdc7832a1a0a6763b54395eebe9fa43434b9af03af1f3dfe75646d3d539a1e
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    # NB: kpeople can use Akonadi but it is unclear if the CMake files actually search for it.
    kf5.depends_frameworks \
                    kcoreaddons ki18n kitemviews \
                    kservice kwidgetsaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kpeople-add-qspxdg.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kservice {
    description     Plugin framework for desktop services
    long_description \
                    KService provides a plugin framework for handling desktop services. Services can \
                    be applications or libraries. They can be bound to MIME types or handled by \
                    application specific code.
    set kf5.framework \
                    kservice
    checksums       rmd160  ab208f8e064f30e28e4bd565c48de74a19a0a5ec \
                    sha256  e96eba4a77164c09c114546102fb693acf8213c75222b8d6ea00e8a1bb240b90
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons kdoctools ki18n
    patchfiles-append \
                    patch-kservice-xdg-menu-prefix.diff
    post-patch {
        reinplace "s|@APPMENUPREFIX@|kf5-|g" ${worksrcpath}/src/sycoca/vfolder_menu.cpp
    }
    configure.args-append \
                    -DAPPLICATIONS_MENU_NAME=kf5-applications.menu \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    # these cleaned out a number of directories under /Applications for me. At least I hope
    # it was the autotests that did that ...!
    test.run        no
}

subport kf5-ktexteditor {
    description     Full text editor component
    long_description \
                    KTextEditor provides a powerful text editor component that you can embed in your \
                    application, either as a KPart or using the KF5::TextEditor library (if you need \
                    more control). \
                    The text editor component contains many useful features, from syntax \
                    highlighting and automatic indentation to advanced scripting support, making it \
                    suitable for everything from a simple embedded text-file editor to an advanced \
                    IDE.
    set kf5.framework \
                    ktexteditor
    checksums       rmd160  06fb562385787d8909dc3d03ec051cb7ad73ed3d \
                    sha256  1cbb7e838a4aebc08e53add09988ed58475e2f512d1689081b084b6290ae3e3c
    depends_build-append \
                    port:gettext \
                    path:bin/perl5:perl5 \
                    ${kf5.pythondep}
    depends_lib-append \
                    port:libgit2
    kf5.depends_frameworks \
                    karchive kconfig kguiaddons \
                    ki18n kiconthemes kio kparts \
                    sonnet
    platform darwin {
        # this patch should be submitted upstream; cf. the corresponding sonnet patch
        patchfiles-append \
                    patch-ktexteditor-use-qsettings-iniformat.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-ktextwidgets {
    description     Text editing widgets
    long_description \
                    KTextWidgets provides widgets for displaying and editing text. It supports \
                    rich text as well as plain text.
    set kf5.framework \
                    ktextwidgets
    checksums       rmd160  d205924933cdb477e973a598c59a5e70c7d2bf24 \
                    sha256  891f0bdd453e30cd6e9d0f865c9337b6e981114ac21d08cb63c3b61ff0a5f3ef
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kcompletion kconfig kconfigwidgets ki18n \
                    kiconthemes kservice sonnet kwidgetsaddons \
                    kwindowsystem
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kwallet {
    description     Safe desktop-wide storage for passwords
    long_description \
                    This framework contains two main components: \
                    1: Interface to KWallet, the safe desktop-wide storage for passwords on KDE work \
                    spaces. \
                    2: The kwalletd used to safely store the passwords on KDE work spaces (when not using the OS X Keychain)
# not functional yet!
#     if {${os.platform} eq "darwin"} {
#         variant osxkeychain description {kwallet uses the OSX KeyChain} {
#             configure.args-append \
#                     -DMAC_USE_OSXKEYCHAIN:BOOL=ON
#         }
#     }
    set kf5.framework \
                    kwallet
    checksums       rmd160  40b7f4e5112f96aaffe20b7f43cf495f4d30a581 \
                    sha256  f1893d87607aaed6c532a2c05149f220df1795acf50a20d71bca178cea619cbd
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    gpgmepp kconfig kcoreaddons kdbusaddons ki18n \
                    kiconthemes knotifications kservice kwidgetsaddons \
                    kwindowsystem
    platform "darwin" {
        depends_lib-append \
                port:gpgme \
                port:libgcrypt
    }
    patchfiles-append \
                    patch-kwallet-nongui-runtimes.diff \
                    patch-kwallet-kwalletd-is-agent.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kxmlgui {
    description     Framework for managing menu and toolbar actions
    long_description \
                    KXMLGUI provides a framework for managing menu and toolbar actions in an \
                    abstract way. The actions are configured through a XML description and hooks \
                    in the application code. The framework supports merging of multiple \
                    description for example for integrating actions from plugins.
    set kf5.framework \
                    kxmlgui
    checksums       rmd160  60a8123a74b23047f6226ed9f30a790859224c03 \
                    sha256  5ac0d43884b48da7af3b90df2d8a1a26945d165db679163a497696f69270f0ef
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    attica kconfig kconfigwidgets kglobalaccel \
                    ki18n kiconthemes kitemviews ktextwidgets \
                    kwidgetsaddons kwindowsystem
    patchfiles-append \
                    patch-kxmlgui-use-iniformat.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

### === Tier 4 ===

subport kf5-frameworkintegration {
    description     Integration of Qt application with KDE workspaces
    long_description \
                    Framework Integration is a set of plugins responsible for better integration of \
                    Qt applications, among others by improving theming capabilities
    conflicts       kf5-frameworkintegration-devel
    set kf5.framework \
                    frameworkintegration
    checksums       rmd160  8cdae8e06a0d758ab0d808bc011c1dcbd2834ec7 \
                    sha256  ceb0f3e79497a99a88aea3154c0c50c376ce4e8efea18a9ff4e6de4a061bdb6f
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfig kconfigwidgets ki18n kiconthemes \
                    kio knotifications kwidgetsaddons
    # autotests need more patching than just being built as nongui (non-app-bundle) executables!
    patchfiles-append \
                    patch-fwintegration-autotests.diff \
                    patch-fwintegration-platform-adaptation3.diff
#     post-patch {
#         reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/platformtheme/khintssettings.cpp
#     }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.env-append \
                    KDE_SESSION_VERSION=5
    notes-append    "frameworkintegration uses Noto Sans (https://www.google.com/get/noto/) and \
                    Oxygen Mono (http://download.kde.org/stable/plasma/5.4.0/oxygen-fonts-5.4.0.tar.xz) \
                    fonts, ensure these are installed for use at runtime. Also, in order to use your selected \
                    KDE theme automatically, you need to use port:qt5-kde and set KDE_SESSION_VERSION to a \
                    value >=4 (launchctl setenv KDE_SESSION_VERSION 5 and equivalent in your login script)."
}

subport kf5-frameworkintegration-devel {
    description     Integration of Qt application with KDE workspaces
    long_description \
                    Framework Integration is a set of plugins responsible for better integration of \
                    Qt applications, among others by improving theming capabilities
    conflicts       kf5-frameworkintegration
    set kf5.framework \
                    frameworkintegration
    fetch.type      git
    git.branch      4037bdc0
    version         ${version}.5.0.0.171
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    kf5.depends_frameworks \
                    kconfig kconfigwidgets ki18n kiconthemes \
                    kio knotifications kwidgetsaddons
    # autotests need more patching than just being built as nongui (non-app-bundle) executables!
    patchfiles-append \
                    patch-fwintegration-platform-adaptation4.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.env-append \
                    KDE_SESSION_VERSION=5
    notes-append    "frameworkintegration uses Noto Sans (https://www.google.com/get/noto/) and \
                    Oxygen Mono (http://download.kde.org/stable/plasma/5.4.0/oxygen-fonts-5.4.0.tar.xz) \
                    fonts, ensure these are installed for use at runtime. Also, in order to use your selected \
                    KDE theme automatically, you need to use port:qt5-kde and set KDE_SESSION_VERSION to a \
                    value >=4 (launchctl setenv KDE_SESSION_VERSION 5 and equivalent in your login script)."
}

homepage            http://projects.kde.org/projects/${kf5.virtualPath}/${kf5.framework} \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/${kf5.framework}/html/index.html
if {${fetch.type} eq "git"} {
    if {[file exists ${filespath}/${kf5.framework}-git/.git]} {
        git.url     ${filespath}/${kf5.framework}-git
    } else {
        git.url     git://anongit.kde.org/${kf5.framework}
    }
    distname        ${kf5.framework}-${kf5.version}.git
} else {
    master_sites    http://download.kde.org/stable/${kf5.folder}
    distname        ${kf5.framework}-${version}
}

### === Porting Aids ===
### this would probably be better in a separate portdir because despite being frameworks
### they are distributed from a different URL

subport kf5-kdelibs4support {
    description     Legacy support for kdelibs 4 compatibility
    long_description \
                    This framework provides code and utilities to ease the transition from \
                    kdelibs 4 to KDE Frameworks 5. This includes CMake macros and C++ \
                    classes whose functionality has been replaced by code in CMake, Qt and \
                    other frameworks.
    variant kde4compat description {allow installation alongside KDE4's port:kde4-runtime} {}
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    kdelibs4support
    checksums       rmd160  f9daadae8de57346b21b1e36715b8c7b2193341b \
                    sha256  ac4d64070aa26cd95caacd0818546b4e49dbe60ce395b46983c7c674e0315578
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kbookmarks kcompletion kconfig kconfigwidgets \
                    kcrash kdbusaddons kded ki18n kdesignerplugin \
                    kdoctools kglobalaccel kguiaddons ki18n \
                    kiconthemes kio kitemviews knotifications kparts \
                    kservice ktextwidgets kunitconversion \
                    kwidgetsaddons kwindowsystem kxmlgui
    platform "darwin" {
        # pretend KDE_FULL_SESSION is set in order to get full support for theming settings
        patchfiles-append \
                    patch-kdelibs4supp-simulate-full_session.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    post-destroot {
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${destroot}${kf5.libexec_dir}/kf5/fileshareset
        if {[variant_isset kde4compat]} {
            file rename ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl \
                ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl5
        }
    }
}

### === Meta Ports ===

if {${subport} eq ${name}} {
    pre-fetch {
        ui_msg "This port is not yet implemented, install one of the subports"
        return -code error "not yet implemented"
    }
    homepage        http://projects.kde.org/projects/
    fetch {}
    checksum {}
    extract {}
    build {}
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-packages
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-packages/${subport}"
    }
}

subport kf5-tier1-frameworks {
    description     Meta-port for the Tier-1 Frameworks
    long_description \
                    ${description}, the frameworks that do not depend on other KF5 frameworks.
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier1
    kf5.depends_build_frameworks \
                    attica karchive kcodecs kconfig \
                    kcoreaddons kdbusaddons kdnssd kguiaddons \
                    ki18n kidletime kimageformats kitemmodels \
                    kitemviews kplotting kwidgetsaddons kwindowsystem \
                    solid sonnet threadweaver
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-packages
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-packages/${subport}"
    }
}

subport kf5-tier2-frameworks {
    description     Meta-port for the Tier-2 Frameworks
    long_description \
                    ${description}, the frameworks that depend only on Tier-1 frameworks
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier2
    kf5.depends_build_frameworks \
                    kauth kcompletion kcrash kdoctools \
                    kfilemetadata kjobwidgets knotifications \
                    kpackage kpty kunitconversion
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-packages
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-packages/${subport}"
    }
}

subport kf5-tier3-frameworks {
    description     Meta-port for the Tier-3 Frameworks
    long_description \
                    ${description}, the frameworks that depend on Tier-1 and/or Tier-2 frameworks
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier3
    kf5.depends_build_frameworks \
                    baloo kbookmarks kcmutils kconfigwidgets \
                    kdeclarative kded kdesignerplugin kdewebkit \
                    kemoticons kglobalaccel \
                    kiconthemes kinit \
                    kio kparts kservice ktextwidgets kwallet kxmlgui
    # to be completed:
    foreach fw { kf5-kactivities   \
            kf5-kdesu \
            kf5-knewstuff kf5-knotifyconfig \
            kf5-kpeople kf5-ktexteditor kf5-kxmlrpcclient \
            kf5-plasma} {
        depends_lib-append \
                    port:${fw}
    }
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-packages
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-packages/${subport}"
    }
}

livecheck.type      regex
livecheck.url       http://download.kde.org/stable/frameworks/${kf5.branch}
livecheck.regex     (5+(\\.\\d+)+)

# kate: backspace-indents true; indent-pasted-text true; indent-width 4; keep-extra-spaces true; remove-trailing-spaces modified; replace-tabs true; replace-tabs-save true; syntax Tcl/Tk; tab-indents true; tab-width 4;
