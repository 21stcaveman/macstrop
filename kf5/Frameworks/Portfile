# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
set kf5.framework   yes
PortGroup           kf5 1.1

name                KF5-Frameworks
version             ${kf5.version}
description         meta-port for the KDE Frameworks Version 5
long_description    ${description}
maintainers         gmail.com:rjvbertin mk openmaintainer

installs_libs       yes
if {${os.platform} eq "darwin"} {
    test.run        no
} else {
    test.run        yes
}

set startup_root ""

variant qspXDG description "Switch Qt5's QStandardPaths to XDG-compliant mode (e.g. using ${prefix}/share)" {
# The Qt5 QStandardPaths (QSP) patch allows QSP to return XDG/linuxy locations (paths) that are more suitable
# for a shared use of Qt5 in the MacPorts universe than the default values QSP returns that follow Apple's
# sandboxing dogmas. It must however be activated so that individual ports have the choice which "flavour" they
# use. KF5 applications should (probably) by using the XDG/Linuxy flavour unless they are to be built into
# individual, autonomous app bundles that each contain all required dependencies.
# Activation of the QSP patch is done by linking an additional, dedicated Qt component: Qt5::QspXDG .
# The approach philosophy used here is to link that component with all KF5 frameworks and helper applications
# built as part of those frameworks, even if they do not use the QSP class themselves. This redundancy comes
# with an overhead that should be negligible, and serves to lower the maintenance burden (monitoring the
# appearance of QSP usage).
#
# KF5 autotests were conceived to run with XDG-compliant QSP locations, and wreak havock when they are not.
    test.run        yes
}

platform "darwin" {
    if {[file exists ${qt_cmake_module_dir}/Qt5QspXDG/Qt5QspXDGConfig.cmake]} {
        default_variants \
                    +qspXDG
    } else {
        ui_debug "We appear to be building against a Qt5 port that doesn't have the QSP patch from port:qt5-kde. Don't fight it, just warn."
        notes-append "You will be running KF5 applications with the stock/native Qt5::QStandardPaths behaviour.\
                     That is not the recommended configuration for this port."
    }
}
if {(${os.platform} eq "darwin") && ![variant_isset qspXDG]} {
    # NOTE: Many kf5 ports violate MacPorts' ports file systems,
    #       but it is a must due to Qt5's QStandardPaths logic,
    #       so we'll quieten the warning this causes.
    destroot.violate_mtree  yes
}

patch.pre_args      -Np0

pre-patch {
    if {[variant_isset qspXDG] && ${subport} ne "kf5-tier1-frameworks" \
        && ${subport} ne "kf5-tier2-frameworks" && ${subport} ne "kf5-tier3-frameworks"} {
        # patch the find_package(Qt5) command to add the activator of the QSP patch (which selects XDG behaviour).
        # careful with the backslashes: it's a regular expression that must be passed on to sed(1) correctly!
        reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/CMakeLists.txt
        if {[file exists ${worksrcpath}/src/CMakeLists.txt]} {
            reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/src/CMakeLists.txt
            reinplace "s|\\(target_link_libraries(KF5\[\^ \$\]\*\\)|\\1 PRIVATE Qt5::QspXDG|g" ${worksrcpath}/src/CMakeLists.txt
        }
    }
}

post-destroot {
    if {[variant_exists examples] && [variant_isset examples] && [file exists ${build.dir}/examples]} {
        ui_debug "Installing examples"
        xinstall -m 755 -d ${destroot}${kf5.applications_dir}/examples
        foreach app [glob -nocomplain ${build.dir}/examples/*.app ${build.dir}/examples/*/*.app] {
            file copy ${app} ${destroot}${kf5.applications_dir}/examples/
        }
    }
}

### === Tier 1 ===

subport kf5-attica {
    description     Open Collaboration Service client library
    long_description \
                    Attica is a Qt library that implements the Open Collaboration Services API version 1.6 .
    set kf5.framework \
                    attica
    checksums       rmd160  7870a9089718265e562ab65a2389e3019631dac5 \
                    sha256  ce1a004bb2814931acbc435778fa65524da5a029d6a212f450af8043ca41ae58
    conflicts-append \
                    attica-qt5
}

subport kf5-kapidox {
    description     KDE Doxygen Tools
    long_description \
                    This framework contains scripts and data for building API documentation (dox) in \
                    a standard format and style. \
                    The Doxygen tool is used to do the actual documentation extraction and \
                    formatting, but this framework provides a wrapper script to make generating the \
                    documentation more convenient (including reading settings from the target \
                    framework or other module) and a standard template for the generated \
                    documentation.
    set kf5.framework \
                    kapidox
    checksums       rmd160  952dadb3146ba171c57289ec9fde65119f9da3c4 \
                    sha256  618ea6a45bf90546cc0b5891a316d997a6459d04a506f3ec7b0e226e8615a3b1
    installs_libs   no
    supported_archs noarch
    depends_build-append \
                    ${kf5.pythondep}
    depends_run-append \
                    ${kf5.pythondep} \
                    port:py${kf5.pybranch}-yaml \
                    port:py${kf5.pybranch}-jinja2
    platform "darwin" {
        # doxygen has a *lot* of dependencies all the way to Xorg, which are
        # complete overkill for a *runtime* dependency on Linux. Get it from
        # the host there.
        # doxyqml supports only Python 2.7
        depends_run-append \
                    port:doxygen \
                    port:py27-doxyqml
    }
    patchfiles-append \
                    patch-kapidox-include-objc++.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    post-destroot {
        if {${os.platform} eq "darwin"} {
            xinstall -m 755 -d ${destroot}/${kf5.pylibdir}
            file rename ${destroot}${prefix}/lib/python${kf5.pyversion}/site-packages ${destroot}/${kf5.pylibdir}
        } elseif {${os.platform} eq "linux"} {
            foreach b [glob -nocomplain ${destroot}${prefix}/bin/*] {
                reinplace "s|/usr/bin/python|${prefix}/bin/python|g" ${b}
                reinplace "s|'/usr/share/doc/qt'|'${prefix}/libexec/qt5/doc'|g" ${b}
                reinplace "s|/usr/share|${prefix}/share|g" ${b}
            }
        }
    }
    test.cmd        echo
    test.target     no tests for this framework
    notes-append    "It is recommended to install the Roboto fonts for optimal displaying of documentation generated \
                    through kf5-kapidox and doxygen. See http://www.google.com/fonts/specimen/Roboto ."
}

subport kf5-karchive {
    description     Reading, creating, and manipulating file archives
    long_description \
                    KArchive provides classes for easy reading, creation and manipulation of \
                    "archive" formats like ZIP and TAR. \
                    It also provides transparent compression and decompression of data, like the \
                    GZip format, via a subclass of QIODevice.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    karchive
    checksums       rmd160  06ad414d69664ca6d07ce451fcced6259fc88e45 \
                    sha256  a1d12ae9c12ec62c42d814bbe89d323ed804a2a4211db402bfe9dac01edfc7e7
    depends_lib-append \
                    port:zlib
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kcodecs {
    description     String encoding library
    long_description \
                    KCodecs provide a collection of methods to manipulate strings using various \
                    encodings. It can automatically determine the charset of a string, translate XML entities, \
                    validate email addresses, and find encodings by name in a more tolerant way than QTextCodec \
                    (useful e.g. for data coming from the Internet).
    set kf5.framework \
                    kcodecs
    checksums       rmd160  e01901c91710110b15ecf0ff10eebd852e0470ea \
                    sha256  43ee8f25170497cfa648e8be790ac6f12567797471701893dc3f99ae4f61d18a
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kconfig {
    description     Persistent platform-independent application settings.
    long_description \
                    KConfig provides an advanced configuration system. It is made of two parts with the evocative names \
                    KConfigCore and KConfigGui.
    set kf5.framework \
                    kconfig
    checksums       rmd160  5633aaede25ac3e5a10c28945f54949765a28603 \
                    sha256  325bb286987081af061f9a146289849b11c0a605f91c1c8d7416ebc80d7faacd
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kconfig-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kconfig-prefix-etc.diff \
                    patch-kconfig-restore-wingeo.diff
    post-patch {
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/core/kconfig.cpp
    }
}

subport kf5-kcoreaddons {
    description     Qt addon library with a collection of non-GUI utilities
    long_description \
                    KCoreAddons provides classes built on top of QtCore to perform various tasks \
                    such as manipulating mime types, autosaving files, creating backup files, \
                    generating random sequences, performing text manipulations such as macro \
                    replacement, accessing user information and many more.
    set kf5.framework \
                    kcoreaddons
    checksums       rmd160  fd9cbbf86325cbeb6df044d84e6428153d02fa77 \
                    sha256  f6200396dece6469438d57d02b7d8c231bcf6986190cbb3669923dc562d4a65d
    depends_lib-append \
                    port:shared-mime-info
    if {[variant_isset qspXDG]} {
        # desktoptojson doesn't currently use QSP so doesn't require the activator
        patchfiles-append \
                    patch-kcoreaddons-add-qspxdg.diff
    }
    platform "darwin" {
        configure.args-append \
                    -DKDE4_DEFAULT_HOME=Library/Preferences/KDE
    }
}

subport kf5-kdbusaddons {
    description     Convenience classes for DBus
    long_description \
                    KDBusAddons provides convenience classes on top of QtDBus, as well as an API to \
                    create KDED modules.
    set kf5.framework \
                    kdbusaddons
    checksums       rmd160  508e68d1f9a4de866bbd6ca16d915c2b56709af1 \
                    sha256  b599a448be04bfeee0be7bf0aaf6272964bb82871b5dd1f26cf06c03c44993d8
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdbusaddons-add-qspxdg.diff
    }
}

subport kf5-kdnssd {
    description     Network service discovery using Zeroconf
    long_description \
                    KDNSSD is a library for handling the DNS-based Service Discovery Protocol \
                    (DNS-SD), the layer of Zeroconf(TM) that allows network \
                    services, such as printers, to be discovered without any user intervention or \
                    centralised infrastructure.
    set kf5.framework \
                    kdnssd
    checksums       rmd160  6d076d940d04b6efc4a53a034b21a391905719ad \
                    sha256  e10a1b2f3b64039c964128d47edce7b19a7d90975dd17084210c895b6f83d216
    platform "darwin" {
        # Avahi is required but apparently only at runtime
        depends_run-append \
                    port:avahi
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kguiaddons {
    description     Utilities for graphical user interfaces
    long_description \
                    The KDE GUI addons provide utilities for graphical user interfaces in the areas \
                    of colours, fonts, text, images, keyboard input.
    set kf5.framework \
                    kguiaddons
    checksums       rmd160  76dc958668116825f8f0be9a9417599b2703b169 \
                    sha256  e434d05fb78d3d897e75e09bf0ad8781b87a73ff1185982e3af71fc108a525e4
    if {[variant_isset qspXDG]} {
        # this is a probable case of currently unneeded QSP patch activation
        patchfiles-append \
                    patch-kguiaddons-add-qspxdg.diff
    }
}

subport kf5-ki18n {
    description     KDE Gettext-based UI text internationalisation
    long_description \
        KI18n provides functionality for internationalising user interface text \
        in applications, based on the GNU Gettext translation system. \
        It wraps the standard Gettext functionality, so that the programmers \
        and translators can use the familiar Gettext tools and workflows. \
        KI18n provides additional functionality as well, for both programmers \
        and translators, which can help to achieve a higher overall quality \
        of source and translated text. This includes argument capturing, \
        customisable markup, and translation scripting.
    set kf5.framework \
                    ki18n
    checksums       rmd160  3e3f52898b92da4a8f7a56cfea80ccf8de8b20c8 \
                    sha256  e35450c1e40427f676ed88a25380e306ace259cdb1768e0da5e9942eb2f6901d
    kf5.has_translations
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-ki18n-add-qspxdg.diff
    }
}

subport kf5-kidletime {
    description     Reporting of idle time of user and system
    long_description \
                    KIdleTime is a singleton reporting information on idle time. It is useful not \
                    only for finding out about the current idle time of the host, but also for getting \
                    notified upon idle time events, such as custom timeouts, or user activity.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kidletime
    checksums       rmd160  61a665a5784286c91e3012b984b21b722d713acb \
                    sha256  25d9d3a4717a9bcc353e5475a3b9873ae7c7b6d785dec0016e33cca1181f2f1a
    patchfiles-append \
                    patch-kidletime-use-iokit.diff \
                    patch-kidletime-xsync.diff
    if {[variant_isset docs]} {
        patchfiles-append \
                    patch-kidletime-documentation.diff
    }
    # RJVB: kidletime currently seems to use a Carbon-based poller ; check if I haven't already implemented
    # something more native for KDE4.
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kimageformats {
    description     Plugins to allow QImage to support extra file formats.
    long_description \
                    This framework provides additional image format plugins for QtGui. \
                    As such it is not required for the compilation of any other software, \
                    but may be a runtime requirement for Qt-based software to support \
                    certain image formats.
    set kf5.framework \
                    kimageformats
    checksums       rmd160  0f73b0014ae44652b23f51b8928032831397ed75 \
                    sha256  7a7d58e573b82ff4fcb9a8d9313e7b9c77e487ee186d1dea7dd081c2f8018037
    platform "darwin" {
        depends_lib-append \
                    port:openexr
    }
    if {[variant_isset qspXDG]} {
        # adding the QSP activator to the plugins too for now; should be unnecessary.
        patchfiles-append \
                    patch-kimageformats-add-qspxdg.diff
    }
}

subport kf5-kitemmodels {
    description     Set of item models extending the Qt model-view framework
    long_description \
                    Set of item models extending the Qt model-view framework
    set kf5.framework \
                    kitemmodels
    checksums       rmd160  857a5579549b4bd935aa1a33e8484a5d55f7d7be \
                    sha256  dea6218ca68a2ac8728ae85d045b06fd28ad1ddd3029d2edf8f4bbea4f0bf8a7
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
    kf5.add_test_library_path \
                    ${build.dir}/autotests/proxymodeltestsuite
}

subport kf5-kitemviews {
    description     Set of item views extending the Qt model-view framework
    long_description \
                    KItemViews includes a set of views, which can be used with item models. It \
                    includes views for categorising lists and to add search filters to flat and \
                    hierarchical lists.
    set kf5.framework \
                    kitemviews
    checksums       rmd160  73243686010c9bcfddca85d030df63e423049332 \
                    sha256  e3223f307e367223124ad140d9e8d52a3bb11a3de64c357ca1d220ae870c6ecc
}

subport kf5-kplotting {
    description     A lightweight plotting framework
    long_description \
                    KPlotWidget is a QWidget-derived class that provides a virtual base class \
                    for easy data-plotting. The idea behind KPlotWidget is that you only have \
                    to specify information in \"data units\"\; i.e., the natural units of the \
                    data being plotted.  KPlotWidget automatically converts everything \
                    to screen pixel units.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kplotting
    checksums       rmd160  8745d3e8713ac64b78e056f2502a88b50dd07d62 \
                    sha256  bdce3c19d491c9f8d7a1fea7e84973ab6ca463a29106ab24ee5d4527dc660f45
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kplotting-add-qspxdg.diff
    }
}

subport kf5-kwidgetsaddons {
    description     A large set of desktop widgets
    long_description \
                    This repository contains add-on widgets and classes for applications \
                    that use the Qt Widgets module. If you are porting applications from \
                    KDE Platform 4 "kdeui" library, you will find many of its classes here. \
                    Provided are action classes that can be added to toolbars or menus, \
                    a wide range of widgets for selecting characters, fonts, colours, \
                    actions, dates and times, or MIME types, as well as platform-aware \
                    dialogs for configuration pages, message boxes, and password requests. \
                    Further widgets and classes can be found in other KDE frameworks.
    set kf5.framework \
                    kwidgetsaddons
    checksums       rmd160  b71493cfbeb1f391ccabdcb69e3bfc858d3b3da9 \
                    sha256  76f75144dfa4f3bfd1389ecef4bd6aeeac5edc4b230a33fa9be58c4f3ef73294
    platform darwin {
        # submit upstream
        patchfiles-append \
                    patch-kwidgaddons-restrict-WId-usage.diff
    }
}

subport kf5-kwindowsystem {
    description     Access to the windowing system
    long_description \
                    Convenience access to certain properties and features of the windowing system. \
                    KWindowSystem provides information about the windowing system and allows interaction with \
                    the windowing system. It provides a high level API which is windowing system independent and \
                    has platform specific implementations. This API is inspired by X11 and thus not all functionality \
                    is available on all windowing systems. On Mac OS X, X11 support is not included though that \
                    would be possible theoretically.
    conflicts-append \
                    kf5-kwindowsystem-devel
    set kf5.framework \
                    kwindowsystem
    checksums       rmd160  13939c0df2896119def371ccc3bbdf3ff68546af \
                    sha256  a460f9d2a045c4fd8bb71578811caa93b1a39f04170adedc4164c71e8f290ba0
    platform "darwin" {
        test.cmd    echo
        test.target no tests for this framework
    }
    platform darwin {
        # submit upstream after porting all KWindowSystem adaptations for OS X from KDE4
        patchfiles-append \
                    patch-kwinsys-osx-plugin.diff
    }
}

subport kf5-kwindowsystem-devel {
    description     Access to the windowing system
    long_description \
                    Convenience access to certain properties and features of the windowing system. \
                    KWindowSystem provides information about the windowing system and allows interaction with \
                    the windowing system. It provides a high level API which is windowing system independent and \
                    has platform specific implementations. This API is inspired by X11 and thus not all functionality \
                    is available on all windowing systems. On Mac OS X, X11 support is not included though that \
                    would be possible theoretically.
    conflicts-append \
                    kf5-kwindowsystem
    set kf5.framework \
                    kwindowsystem
    fetch.type      git
    git.branch      cb4d98484abd13989d1d95b9df1fb06c8580503f
    version         ${version}.4.100.0.129
    platform "darwin" {
        test.cmd    echo
        test.target no tests for this framework
    }
    platform darwin {
        # submit upstream after porting all KWindowSystem adaptations for OS X from KDE4
        patchfiles-append \
                    patch-kwinsys-osx-plugin.diff
    }
}

subport kf5-solid {
    description     Desktop hardware abstraction
    long_description \
                    Solid is a device integration framework.  It provides a way of querying and \
                    interacting with hardware independently of the underlying operating system.
    set kf5.framework \
                    solid
    checksums       rmd160  31603feb4941825d9f4bfede2665e0b0c3a5f30a \
                    sha256  a333f6e3eb1468d87bca3b372777ba9ead09d89cbafd527424b8e7c7cac4edc5
    if {${os.platform} eq "darwin"} {
        depends_build-append \
                    port:flex \
                    port:bison
    } else {
        # apparently not needed after all:
        #            patch-solid-findudev.diff
        patchfiles-append \
                    patch-solid-xdgdatadirs.diff
        post-patch {
            reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/cmake/FindMediaPlayerInfo.cmake
        }
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-solid-add-qspxdg.diff
    }
    configure.args-append \
                    -DWITH_NEW_SOLID_JOB=ON
}

subport kf5-sonnet {
    description     Multi-language spell checker
    long_description \
                    Sonnet is a plugin-based spell checking library for Qt-based \
                    applications. It supports several different plugins, including \
                    HSpell, Enchant, ASpell and HUNSPELL. \
                    It also supports automated language detection, based on a \
                    combination of different algorithms.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    sonnet
    checksums       rmd160  cd0e6b30327ada16ef741d8425e1b15f4dcc2f35 \
                    sha256  5bafe5540cfb07f0306027223893701e1d19d81f0ce0310261f3303b59fbeb38
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-sonnet-add-qspxdg.diff
    }
    platform "darwin" {
        # this patch should be submitted upstream
        patchfiles-append \
                    patch-sonnet-use-qsettings-iniformat.diff
        # backend variants. Don't attempt to deactivate non-selected backends for now.
        variant aspell description {build the aspell backend} {
            depends_lib-append \
                    port:aspell
        }
        variant hunspell description {build the hunspell backend} {
            depends_lib-append \
                    port:hunspell
        }
        default_variants-append \
                    +aspell
    }
}

subport kf5-threadweaver {
    description     threadweaver
    long_description \
                    threadweaver
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    threadweaver
    checksums       rmd160  0bd09e7bdc59fd21dc6adc1dc28eba8879f15b5a \
                    sha256  5c23052918c15024e45dbf28da1f7b16528698837f1d6a3e884a69c27fc6c7b1
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
    post-patch {
        reinplace "s|/usr/|${prefix}/|g" ${worksrcpath}/examples/ThumbNailer/Benchmark.cpp
    }
}

### === Tier 2 ===

subport kf5-kauth {
    description     Execute actions as privileged user
    long_description \
                    KAuth provides a convenient, system-integrated way to offload actions that need \
                    to be performed as a privileged user (root, for example) to small (hopefully \
                    secure) helper utilities.
    set kf5.framework \
                    kauth
    checksums       rmd160  89071e48eab3a9df9e95a7f6eb8fad522a1ff879 \
                    sha256  c3e3a370a6b847cebf73ca8262b79142fc1e821d9dcb81c08063ba0a097cfb6c
    if {[variant_isset qspXDG]} {
        # there is no need to add the activator to desktoptojson, at the moment
        patchfiles-append \
                    patch-kauth-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kauth-nongui-policy-gen.diff
    kf5.depends_frameworks \
                    kcoreaddons
    # on linux, PolkitQt5-1 or PolkitQt-1 is required
    platform "linux" {
        depends_lib-append \
                    port:polkit-qt5
    }
}

subport kf5-kcompletion {
    description     Powerful completion framework, including completion-enabled lineedit and combobox.
    long_description \
                    When typing filenames, email addresses and other text where the user often wants \
                    to select from existing data (including what they previously typed) rather than \
                    enter anything wholly original, users often find it helpful if they only need to \
                    type the first few characters, and then have the application offer them a set of \
                    choices or attempt to finish off what they were typing. Email clients, shells \
                    and \"open file\" dialogs often provide this functionality. \
                    This framework helps implement this in Qt-based applications. You can use one of \
                    the completion-ready widgets provided by this framework, or integrate it into \
                    your application's other widgets directly.
    set kf5.framework \
                    kcompletion
    checksums       rmd160  07cdff968c47d8a0b19a0e2d9c4d14bf0c67c887 \
                    sha256  4f2822e515b905c75b37c47af5d9502ef1fce9aff5220ba60b972691e7e81535
    kf5.depends_frameworks \
                    kconfig kwidgetsaddons
}

subport kf5-kcrash {
    description     Graceful handling of application crashes
    long_description \
                    KCrash provides support for intercepting and handling application crashes.
    set kf5.framework \
                    kcrash
    checksums       rmd160  5afc980c04ed2416f0114616295cd5f1ac212bc8 \
                    sha256  edd4906a2cf62dbee0e502e375cba4718361a9033ce278cf738371edf4243b6c
    kf5.depends_frameworks \
                    kcoreaddons kwindowsystem
    platform "darwin" {
        patchfiles-append \
                    patch-kcrash-dont-closeAllFDs.diff \
                    patch-kcrash-no-display.diff
    }
}

subport kf5-kdoctools {
    description     Create documentation from DocBook
    long_description \
                    Provides tools to generate documentation in various format from DocBook files.
    set kf5.framework \
                    kdoctools
    checksums       rmd160  6d60b3c9e5ef6956bf255361ad21914bdcbb2ae0 \
                    sha256  2857094d27cbcc1e89790ad5d760cbeb699f2a5636c3a5ec603d3d9791917f61
    kf5.depends_build_frameworks \
                    ki18n
    depends_lib-append \
                    port:libxslt \
                    port:docbook-xml \
                    port:docbook-xsl \
                    port:p5.16-uri
    kf5.depends_frameworks \
                    karchive
    # not really sure about this one:
    depends_run-append \
                    port:gettext
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    if {[variant_isset qspXDG]} {
        # kdoctools builds a *static* library, which may mean we'll have to include the activator
        # as source if it turns out that that library is used as the only KF5 framework.
        patchfiles-append \
                    patch-kdoctools-add-qspxdg.diff
    }
# this patch is unnecessary if the kdelibs4 headers are moved out of the ${prefix}/include root
#     if {${os.platform} eq "darwin"} {
#         # workaround what appears to be a bug in the kdoctools buildsystem that
#         # causes it to pick up KDE4 headerfiles when they're present:
#         patchfiles-append \
#                     patch-kdoctools-xslt_kde.cpp.diff
#     }
    configure.args-append \
                        -DDOCBOOKXSL_DIR=${prefix}/share/xsl/docbook-xsl \
                        -DLIBXML2_INCLUDE_DIR=${prefix}/include/libxml2 \
                        -DLIBXML2_LIBRARIES=${prefix}/lib/libxml2.${kf5.libs_ext} \
                        -DLIBXML2_XMLLINT_EXECUTABLE=${prefix}/bin/xmllint \
                        -DLIBXSLT_INCLUDE_DIR=${prefix}/include \
                        -DLIBXSLT_LIBRARIES=${prefix}/lib/libxslt.${kf5.libs_ext}
}

subport kf5-kfilemetadata {
    description     A file metadata and text extraction library
    long_description \
                    KFileMetaData provides a simple library for extracting the text and metadata \
                    from a number of different files. This library is typically used by file \
                    indexers to retreive the metadata.
    set kf5.framework \
                    kfilemetadata
    checksums       rmd160  a331d0bad3aca61090288532b02c169cd58e6318 \
                    sha256  f0d7e4c5bb74d1eeb5a1f5fa93c14567154ec3fd12c261148a617c167631c8a8
    depends_lib-append \
                    port:exiv2
    kf5.depends_frameworks \
                    karchive ki18n
    platform "darwin" {
        depends_lib-append \
                    port:poppler-qt5-mac \
                    port:taglib \
                    path:lib/libavcodec.dylib:ffmpeg \
                    port:ebook-tools
    }
    # report upstream?
    patchfiles-append \
                    patch-kfilemdata-compversion5.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    variant kde4compat description {allow installation alongside KDE4's port:kfilemetadata} {
        # note: it might be useful to provide a complementary variant to port:kfilemetadata
        post-destroot {
            file delete -force ${destroot}${prefix}/share/locale
        }
    }
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kfilemetadata
    }
    post-destroot {
        # kfilemetadata "stock" has the weird idea to set the compatibility/so version to 3 ...
        if {${os.platform} eq "darwin"} {
            ln -s libKF5FileMetaData.5.dylib ${destroot}${prefix}/lib/libKF5FileMetaData.3.dylib
        } else {
            ln -s libKF5FileMetaData.so.5 ${destroot}${prefix}/lib/${os.arch}-linux-gnu/libKF5FileMetaData.so.3
        }
    }
}

subport kf5-kjobwidgets {
    description     Widgets for showing progress of asynchronous jobs
    long_description \
                    KJobWIdgets provides widgets for showing progress of asynchronous jobs.
    set kf5.framework \
                    kjobwidgets
    checksums       rmd160  b34e74d41df9033f8e5d0c7adb4712db4370556b \
                    sha256  3cfbb9871cfbb02b6755a8868fe6a1b1935b5632a243f9767e8635f04075470a
    kf5.depends_frameworks \
                    kcoreaddons kwidgetsaddons
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-knotifications {
    description     Desktop notifications
    long_description \
                    KNotification is used to notify the user of an event. It covers feedback and \
                    persistent events.
    set kf5.framework \
                    knotifications
    checksums       rmd160  4f698ebe425a56994c60d6a35ee8ad217924b756 \
                    sha256  19e47eb755c9140b452bf80a6880bfd52a6f805eba48187fbacd2a48eb064f4c
    kf5.depends_frameworks \
                    kconfig kcodecs \
                    kcoreaddons kwindowsystem
    depends_lib-append \
                    port:phonon-qt5 \
                    port:dbusmenu-qt5
    platform "darwin" {
        # ignore KDE_FULL_SESSION if it's set
        patchfiles-append \
                    patch-knotifications-ignore-full_session-envvar.diff
    }
    # provide names for the sound file and notifyrc warnings (and make a simple beep):
    patchfiles-append \
                    patch-knotifications-better-sound-warning.diff
    # https://git.reviewboard.kde.org/r/126369/
    patchfiles-append \
                    patch-knotifications-OSX-adaptations.diff
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kpackage {
    description     Installation and loading of additional content \(ex: scripts, images...\) as packages
    long_description \
                    The Package framework lets the user install and load packages of non binary content \
                    such as scripted extensions or graphic assets, as if they were traditional plugins.
    set kf5.framework \
                    kpackage
checksums           rmd160  02c1e4b11871f8e7a3fa634249624db85945113e \
                    sha256  a727a94fadf87c539c801d77cb1197c1d0bc561afd9591d4aefecfbf2283e30f
    kf5.depends_frameworks \
                    karchive kconfig kcoreaddons ki18n
    platform "darwin" {
        patchfiles-append \
                    patch-kpackage-add-qspxdg.diff
    }
    # this one ought to be reported upstream:
    patchfiles-append \
                    patch-kpackage-autotests+tool-nogui.diff \
                    patch-kpackage-doctools-accept-older-version.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kpty {
    description     Interfacing with pseudo terminal devices
    long_description \
                    This library provides primitives to interface with pseudo terminal devices \
                    as well as a KProcess derived class for running child processes and \
                    communicating with them using a pty.
    set kf5.framework \
                    kpty
    checksums       rmd160  15d7355cb0ceb811459b53b1f79cf42e90b3df1c \
                    sha256  ac6bad721a16b97a3ba8d8a8184365a2e9eaecc736f24aec7f4e8fe1d3e54fb3
    kf5.depends_frameworks \
                    kcoreaddons ki18n
}

subport kf5-kunitconversion {
    description     Converting physical units
    long_description \
                    KUnitConversion provides functions to convert values in different physical \
                    units. It supports converting different prefixes (e.g. kilo, mega, giga) as \
                    well as converting between different unit systems (e.g. liters, gallons).
    set kf5.framework \
                    kunitconversion
    checksums       rmd160  ec8a906062bb8989b0331b91b79c907eed633b23 \
                    sha256  4eae802b107e95ca39f28b7f08fa880a0e0fa3c678a9afcaa1b8d4901a988379
    kf5.depends_frameworks \
                    kconfig ki18n
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

### === Tier 3 ===

subport kf5-baloo {
    description     File searching and indexing
    long_description \
                    Baloo provides file searching and indexing. It does so by maintaining an index \
                    of the contents of your files. It isn't functional on Mac OS X and present only \
                    to be able to satisfy dependencies.
    set kf5.framework \
                    baloo
    checksums       rmd160  718b1c751b6a57266b4b579fee35c38afd298110 \
                    sha256  608a687d16daad7cbfac3f344a3bb11ba4c25cdb81e3cb7596f70e1393b1f305
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons \
                    kfilemetadata ki18n kidletime kio \
                    solid
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-baloo-add-qspxdb.diff
    }
    platform "darwin" {
        depends_lib-append \
                    port:lmdb
        patchfiles-append \
                    patch-baloo-nongui-execs.diff
        post-destroot {
            # delete a file that isn't supposed to be used, and conflicts with KDE4's baloo:
            if {[file exists ${destroot}${prefix}/share/dbus-1/interfaces/org.kde.baloo.file.indexer.xml]} {
                file delete ${destroot}${prefix}/share/dbus-1/interfaces/org.kde.baloo.file.indexer.xml
            }
            foreach ld [glob -nocomplain ${destroot}${prefix}/share/locale/*/LC_MESSAGES] {
                foreach mo {baloo_file.mo baloo_file_extractor.mo baloosearch.mo balooshow.mo \
                        kio_baloosearch.mo kio_tags.mo kio_timeline.mo} {
                    if {[file exists ${ld}/${mo}]} {
                        file delete ${ld}/${mo}
                    }
                }
            }
            # rename a conflicting icon file (since baloo/Mac is supposed to be non-functional anyway)
            file rename ${destroot}${prefix}/share/icons/hicolor/128x128/apps/baloo.png \
                        ${destroot}${prefix}/share/icons/hicolor/128x128/apps/baloo5.png
        }
        test.cmd        echo
        test.target     no tests on OS X for this framework
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kactivities {
    description     Core components for the KDE Activity concept
    long_description \
                    When a user is interacting with a computer, there are three main areas of \
                    contextual information that may affect the behaviour of the system: who the user \
                    is, where s/he is, and what s/he is doing. \
                    *Activities* deal with the last one. An activity might be \"developing a KDE \
                    application\", \"studying 19th century art\", \"composing music\" or \"watching funny \
                    videos\". Each of these activites may involve multiple applications, and a single \
                    application may be used in multiple activities (for example, most activities are \
                    likely to involve using a web browser, but different activities will probably \
                    involve different websites). \
                    KActivities provides the infrastructure needed to manage users' activites, \
                    allowing them to switch between tasks, and for applications to update their \
                    state to match the user's current activity. This includes a daemon, a library \
                    for interacting with that daemon, and plugins for integration with other \
                    frameworks.
    set kf5.framework \
                    kactivities
    checksums       rmd160  be90a9f792478464e69dc956a0da722d5909dd7b \
                    sha256  5a7580770349f005972ab5cf27f2f67ce643c1b3cfffdf56c03729fbd61cdd52
    platform darwin {
        depends_lib-append \
                    port:boost
    }
    kf5.depends_frameworks \
                    kbookmarks kcmutils kconfig kconfigwidgets \
                    kcoreaddons kdbusaddons kdeclarative \
                    kglobalaccel ki18n kio kpackage kservice \
                    kwidgetsaddons kwindowsystem kxmlgui
    if {[variant_isset qspXDG]} {
        pre-patch {
            reinplace "s|\\(find_package (Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/CMakeLists.txt
        }
        patchfiles-append \
                    patch-kactivities-add-qspxdg.diff
        # submit this one upstream (and monitor if the procedure used suffices to stay
        # out of the Dock and AppSwitcher!)
        patchfiles-append \
                    patch-kactivities-nongui-kactivd.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.cmd        echo
    test.target     no tests on OS X for this framework
}

subport kf5-kbookmarks {
    description     Bookmarks management library
    long_description \
                    KBookmarks lets you access and manipulate bookmarks stored using the \
                    XBEL format (http://pyxml.sourceforge.net/topics/xbel)
    set kf5.framework \
                    kbookmarks
    checksums       rmd160  60f2602f5e55defc1c8ce0694cd20d0eb33546f7 \
                    sha256  cab3d5b6953843080030cf1ce0c516d1d17330cda935c269aafed2209e026766
    kf5.depends_frameworks \
                    kcodecs kconfigwidgets kcoreaddons \
                    kiconthemes kwidgetsaddons kxmlgui
}

subport kf5-kcmutils {
    description     Utilities for KDE System Settings modules
    long_description \
                    KCMUtils provides various classes to work with KCModules. KCModules can be \
                    created with the KConfigWidgets framework.
    set kf5.framework \
                    kcmutils
    checksums       rmd160  e0b79672c8e58f4fa2fffacdbba69210905b8a9f \
                    sha256  f0233c2afb6e644756402ddbc7d5595f7dacab1ff1e38f6e60378244a242cb9c
    kf5.depends_frameworks \
                    kconfigwidgets kcoreaddons kdeclarative ki18n \
                    kiconthemes kitemviews kservice kxmlgui kpackage
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kconfigwidgets {
    description     Widgets for configuration dialogs
    long_description \
                    KConfigWidgets provides easy-to-use classes to create configuration dialogs, as \
                    well as a set of widgets which uses KConfig to store their settings.
    set kf5.framework \
                    kconfigwidgets
    checksums       rmd160  eec4f8f4930b15fddec14af34978ae88298d7513 \
                    sha256  c23382e70182a84b4a164afa313612308d3dcf1f5ec34bad882853725599793b
    kf5.depends_frameworks \
                    kauth kconfig kcodecs kcoreaddons \
                    kdoctools kguiaddons ki18n kwidgetsaddons
    # test and submit upstream
    patchfiles-append \
                    patch-kconfigwidgets-kstdactions-menurole.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kdeclarative {
    description     Integration of QML and KDE work spaces
    long_description \
                    KDeclarative provides integration of QML and KDE work spaces. \
                    It's comprises two parts: a library used by the C++ part of your application \
                    to intergrate QML with KDE Frameworks specific features, and a series of \
                    QML imports that offer bindings to some of the KDE Frameworks.
    set kf5.framework \
                    kdeclarative
    checksums       rmd160  8dde46dd7ddcd39fe34a96b92bafe6a8a372246e \
                    sha256  93a02714e8aafeb1d33a416e609e0af20d757be987ab70e62b4d0ccedb6ce58a
    kf5.depends_frameworks \
                    kpackage kconfig kio \
                    kiconthemes ki18n
    platform "darwin" {
        depends_lib-append \
                    port:libepoxy
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdeclarative-add-qspxdb.diff
    }
    patchfiles-append \
                    patch-kdeclarative-nongui.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kded {
    description     Central daemon of KDE work spaces
    long_description \
                    KDED is the KDE Daemon which runs in the background and performs \
                    a number of small tasks. \
                    Some of these tasks are built in, others are started on demand.
    set kf5.framework \
                    kded
    checksums       rmd160  c8dafb6dfdb59258fda971963e649e901679035a \
                    sha256  134e108fd99e196e4c539848fe5de9a2a39325d77d845b084809831d774b9eea
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash \
                    kdbusaddons kdoctools kinit kservice
    # test and propose upstream:
    # https://git.reviewboard.kde.org/r/126170/
    patchfiles-append \
                    patch-kded-nongui-kded.diff
    platform "darwin" {
        # ignore KDE_FULL_SESSION if it's set
        patchfiles-append \
                        patch-kded-ignore-full_session-envvar.diff
        post-destroot {
            xinstall -d -m 755 ${destroot}${prefix}/Library/LaunchAgents
            xinstall -m 644 ${filespath}/org.macports.kded5.plist \
                ${destroot}${prefix}/Library/LaunchAgents
            reinplace "s|%PREFIX%|${prefix}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kded5.plist
            if { ${startupitem.install} != "no" } {
                xinstall -d -m 755 ${destroot}${startup_root}/Library/LaunchAgents
                ln -s ${prefix}/Library/LaunchAgents/org.macports.kded5.plist ${destroot}${startup_root}/Library/LaunchAgents
            }
        }
        notes-append    "You can opt to let the KDE daemon, kded5, be started automatically at login. \
        To do this, use the following command (once): \
         launchctl load -w ${startup_root}/Library/LaunchAgents/org.macports.kded5.plist"
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kdesignerplugin {
    description     Integrating KDE frameworks widgets with Qt Designer
    long_description \
                    This framework provides plugins for Qt Designer that allow it to display \
                    the widgets provided by various KDE frameworks, as well as a utility \
                    (kgendesignerplugin) that can be used to generate other such plugins \
                    from ini-style description files.
    set kf5.framework \
                    kdesignerplugin
    checksums       rmd160  a759318420447a0131e95f3efdd692047ea00a23 \
                    sha256  3f4c1762f5793f5a33a6f72f658e725f7f2edc73fbc9e2d44b4ebf4054d4876c
    kf5.depends_frameworks \
                    kconfig kcoreaddons kdewebkit kdoctools ki18n
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdesignerplugin-add-qspxdb.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
#     test.cmd        echo
#     test.target     no tests for this framework
}

subport kf5-kdesu {
    description     User interface for running shell commands with root privileges
    long_description \
                    kf5-kdesu provides functionality for building GUI front ends for \
                    (password asking) console mode programs. For example, kdesu and \
                    kdessh use it to interface with su and ssh respectively.
    set kf5.framework \
                    kdesu
    checksums       rmd160  0471ad0418af31db2c93bfef0cda4622359923dd \
                    sha256  0884aed186fd5169ef055d2f8b33d4bf31ad6e61c4373c1c2249874f3a1913a1
    kf5.depends_frameworks \
                    kcoreaddons ki18n kpty kservice
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdesu-add-qspxdg.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kdewebkit {
    description     Integration of the HTML rendering engine WebKit
    long_description \
                    This library provides KDE integration of the QtWebKit library.
    set kf5.framework \
                    kdewebkit
    checksums       rmd160  59144a62d3f212aba90570a4534a7ccf84588dbd \
                    sha256  acc7568696d7a4af021aed4277fbf5c7499719f672bb976ebf308118ae5576dc
    # KDEWebKit doesn't declare an explicit dependency on KI18n but lets cmake pull it in through
    # automatically. We add it here so we don't have to add explicit depends_build on gettext and python.
    kf5.depends_frameworks \
                    kconfig kcoreaddons ki18n kio \
                    kjobwidgets kparts kservice kwallet
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kemoticons {
    description     Convert text emoticons to graphical emoticons
    long_description \
                    KEmoticons converts emoticons from text to a graphical representation with \
                    images in HTML. It supports setting different themes for emoticons coming \
                    from different providers.
    set kf5.framework \
                    kemoticons
    checksums       rmd160  549c4eed05cbcb2d9b736627664e0e3d75066351 \
                    sha256  23ecdffb3110329cab7d8c3e614b6096ac2cc457fe69e60db503de40b593bf33
    kf5.depends_frameworks \
                    karchive kconfig kservice kcoreaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kemoticons-add-qspxdg.diff
    }
}

subport kf5-kglobalaccel {
    description     Global desktop keyboard shortcuts
    long_description \
                    KGlobalAccel allows you to have global accelerators that are independent of \
                    the focused window.  Unlike regular shortcuts, the application's window does not \
                    need focus for them to be activated. \
                    This framework is present only for dependency purposes: it is currently not operational on OS X.
    set kf5.framework \
                    kglobalaccel
    checksums       rmd160  402fb15ea3d54a8bdd949043fc2c1ab214e4da7d \
                    sha256  1f12b02db246c7ef379976081ee3d85639e018acfb35cc1a4a5ef58725eda836
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons ki18n
    patchfiles-append \
                    patch-kglobalaccel-agent-and-nogui.diff
}

subport kf5-kiconthemes {
    description     Icon GUI utilities
    long_description \
                    This library contains classes to improve the handling of icons \
                    in applications using the KDE Frameworks.
    set kf5.framework \
                    kiconthemes
    checksums       rmd160  1f8b2514a3af45acef09acff54de204acc6c7a97 \
                    sha256  638216de3c9fba6249c0e2e3ce0c779b89c4b20683f1a3c1d8ea82952b7ffcb9
    kf5.depends_frameworks \
                    kconfigwidgets ki18n kitemviews kwidgetsaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kiconthemes-add-qspxdg.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kinit {
    description     Helper library to speed up start of applications on KDE workspaces
    long_description \
                    kdeinit is a process launcher somewhat similar to the famous init used for \
                    booting UNIX. It launches processes by forking and then loading a dynamic \
                    library which should contain a 'kdemain(...)' function. Using kdeinit to \
                    launch KDE applications makes starting a typical KDE applications about 2.5 \
                    times faster. It also reduces memory consumption per application.
    set kf5.framework \
                    kinit
    checksums       rmd160  1b69d8f778aaa2d2fe0f7a04d8cad60fc8d38402 \
                    sha256  b1d8fc2727cb15875e3e2aeac645f9bbd482420297407ed2d41b3cf40b634fa1
    kf5.depends_frameworks \
                    kconfig kcrash kdoctools ki18n \
                    kio kservice kwindowsystem
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kinit-add-qspxdg.diff
    }
    post-patch {
        reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/klauncher/klauncher_main.cpp
    }
    # test and propose upstream:
    # https://git.reviewboard.kde.org/r/126161/
    patchfiles-append \
                    patch-kinit-nonguis-andavoid-kdeinit-crash.diff
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kio {
    description     Network transparent access to files and data
    long_description \
                    This framework implements almost all the file management functions you \
                    will ever need. It supports accessing files locally as well as via HTTP \
                    and FTP out of the box and can be extended by plugins to support other \
                    protocols as well.
    set kf5.framework \
                    kio
    checksums       rmd160  69ea9cc6340968386c6e730483d9ff25126b0e47 \
                    sha256  1491a8dfe12bef2b5e889a1fa61eab9c4247608db2934bd22a7b0270d714d0b5
    depends_lib-append \
                    port:libxslt \
                    port:libxml2 \
                    port:zlib
    platform "darwin" {
        depends_lib-append \
                    port:kerberos5
#         # this should probably be a regular patch ... and do we actually
#         # want to replace xdg-open?
#         post-patch {
#             reinplace "s|xdg-open|open|g" ${worksrcpath}/src/widgets/krun.cpp
#         }
#
#         # We may want to change the smb.conf location list in src/core/ksambashare.cpp
    }
    post-patch {
        # get the fallback smbd from MacPorts:
        reinplace "s|/usr/local/sbin/smbd|${prefix}/sbin/smbd|g" ${worksrcpath}/src/core/ksambashare.cpp
    }
    kf5.depends_frameworks \
                    karchive kbookmarks kcompletion kconfigwidgets \
                    kcoreaddons kcrash kdbusaddons kdoctools \
                    kguiaddons ki18n kiconthemes kitemviews \
                    kjobwidgets knotifications kservice ktextwidgets \
                    kwallet kwidgetsaddons kwindowsystem kxmlgui solid
    if {[variant_isset qspXDG]} {
        patchfiles-append \
            patch-kio-add-qspxdg.diff
    }
    # submit upstream:
    patchfiles-append \
                    patch-kio-nongui-kiod-and-agent.diff \
                    patch-kio-nongui-httpcachecl.diff
    # https://git.reviewboard.kde.org/r/126125/ :
    # committed in #73d50f44
    patchfiles-append \
                    patch-kio-use-osxtrash.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-knewstuff {
    description     Framework for downloading and sharing additional application data
    long_description \
                    The KNewStuff library implements collaborative data sharing for \
                    applications. It uses kf5-attica to support the Open Collaboration Services \
                    specification.
    set kf5.framework \
                    knewstuff
    checksums       rmd160  b539fef750708aef6a433b7041fedc703c2c29fe \
                    sha256  ba50503296ef084378db28f739cf773a59dcfab90263ca01e720a0f3bc0e59d2
    kf5.depends_frameworks \
                    attica karchive kcompletion kconfig \
                    kcoreaddons ki18n kiconthemes kio \
                    kitemviews kservice ktextwidgets \
                    kwidgetsaddons kxmlgui
    # this one should probably be submitted upstream
    patchfiles-append \
                    patch-knewstuff-autotests.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-knotifyconfig {
    description     Configuration dialog for desktop notifications
    long_description \
                    KNotifyConfig provides a configuration dialog for desktop notifications which \
                    can be embedded in your application.
    set kf5.framework \
                    knotifyconfig
    checksums       rmd160  a358ce0cc3ab38b7e6f38f5063a39c25e4a3d361 \
                    sha256  d6f0356ded865f415532719feccbaa6112a0732a16b0e233494296a7f610cad1
    kf5.depends_frameworks \
                    kconfigwidgets ki18n kio \
                    knotifications kwidgetsaddons kxmlgui
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kparts {
    description     Plugin framework for user interface components
    long_description \
                    KParts implements the framework for KDE parts, which are \
                    elaborate widgets with a user-interface defined in terms of actions \
                    (menu items, toolbar icons).
    set kf5.framework \
                    kparts
    checksums       rmd160  6b0866ad1943fcb711505d26972c8494123b1784 \
                    sha256  9d739db5067dbf71ef87d323da5db35eb9f653bf9466a6d4aeaf9051fe09b021
    # KParts depends on ki18n despite not declaring it explicitly
    kf5.depends_frameworks \
                    ki18n kio knotifications \
                    ktextwidgets kxmlgui
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kpeople {
    description     kpeople
    long_description \
                    kpeople
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kpeople
    checksums       rmd160  f5abb1086ec466fd796e217c8787f3d2d9c3add6 \
                    sha256  e3258f812310664213bba9a0f0494e4692562a37ce546c979a3c8a2c9214f234
    # NB: kpeople can use Akonadi but it is unclear if the CMake files actually search for it.
    kf5.depends_frameworks \
                    kcoreaddons ki18n kitemviews \
                    kservice kwidgetsaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kpeople-add-qspxdg.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

# the plasma framework can depend on akonadi and kdepimlibs!
# on OS X versions lacking OpenGL ES it can also use the emulator from
# http://malideveloper.arm.com/downloads/OpenGL_ES_Emulator_1.3.2.0699222_MacOSX.tgz
subport kf5-plasma-framework {
    description     Foundational libraries, components, and tools of the Plasma workspaces
    long_description \
                    ${description}. The plasma framework provides \
                    QML components\; \
                    A C++ library: libplasma \
                    and Script engines.
    variant examples description {install any examples provided} {
        configure.args-append \
                    -DBUILD_EXAMPLES=ON
    }
    set kf5.framework \
                    plasma-framework
    checksums       rmd160  5d8cfa2281a2c76379165341dbf1be9388687093 \
                    sha256  50bab98ec5c364cf57a5ea93b0ad7cd067b48a6115d5c4e3ef440398de0d295e
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kactivities karchive kconfig kconfigwidgets \
                    kcoreaddons kdbusaddons kdeclarative kdoctools \
                    kglobalaccel kguiaddons ki18n kiconthemes kio kservice \
                    kwindowsystem kxmlgui knotifications kpackage \

    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-plasmafw-add-qspxdg.diff
    }
    # submit this one upstream
    patchfiles-append \
                    patch-plasmafw-autotests.diff
    post-patch {
        reinplace "s|/usr/share/inkscape|${prefix}/share/inkscape|g" "${worksrcpath}/src/tools/inkscape extensions/plasmarename.py"
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${worksrcpath}/src/tools/currentColorFillFix.sh
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kservice {
    description     Plugin framework for desktop services
    long_description \
                    KService provides a plugin framework for handling desktop services. Services can \
                    be applications or libraries. They can be bound to MIME types or handled by \
                    application specific code.
    set kf5.framework \
                    kservice
    checksums       rmd160  30cc49290719a1567ab9c48a58415b2ec2f9deab \
                    sha256  681159d8a05c0679a27009f6844dbac4f64d553d52d8fd00ad060ee98d35e45b
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons kdoctools ki18n
    patchfiles-append \
                    patch-kservice-xdg-menu-prefix.diff \
                    patch-kservice-fix-invokeBrowser.diff
    post-patch {
        reinplace "s|@APPMENUPREFIX@|kf5-|g" ${worksrcpath}/src/sycoca/vfolder_menu.cpp
    }
    configure.args-append \
                    -DAPPLICATIONS_MENU_NAME=kf5-applications.menu \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    platform darwin {
        post-destroot {
            xinstall -d -m 755 ${destroot}${prefix}/Library/LaunchAgents
            xinstall -m 644 ${filespath}/org.macports.kdecache5.plist \
                ${destroot}${prefix}/Library/LaunchAgents
            reinplace "s|%PREFIX%|${prefix}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kdecache5.plist
            reinplace "s|%APPLICATIONS_DIR%|${applications_dir}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kdecache5.plist
            if { ${startupitem.install} != "no" } {
                xinstall -d -m 755 ${destroot}${startup_root}/Library/LaunchAgents
                ln -s ${prefix}/Library/LaunchAgents/org.macports.kdecache5.plist ${destroot}${startup_root}/Library/LaunchAgents
            }
        }
        notes-append    "An agent can be started to maintain KDE's desktop file system configuration cache, \
        to avoid having to run 'kbuildsycoca5' manually. \
        To start it run the following command: \
         launchctl load -w ${startup_root}/Library/LaunchAgents/org.macports.kdecache5.plist"
    }
    # the autotests from this port  cleaned out a number of directories under /Applications for me.
    # Shouldn't happen anymore with Qt's QSP switched to XDG mode (+qspXDG variant), but since that's
    # not a compulsory mode we disallow running the tests.
    test.run        no
}

subport kf5-ktexteditor {
    description     Full text editor component
    long_description \
                    KTextEditor provides a powerful text editor component that you can embed in your \
                    application, either as a KPart or using the KF5::TextEditor library (if you need \
                    more control). \
                    The text editor component contains many useful features, from syntax \
                    highlighting and automatic indentation to advanced scripting support, making it \
                    suitable for everything from a simple embedded text-file editor to an advanced \
                    IDE.
    set kf5.framework \
                    ktexteditor
    checksums       rmd160  d609eca37efc9683be31e7181bfca59cdfc20a0f \
                    sha256  f992c5c7cf0d4f6427cb2194b18d27301c5e28b19bdaadd0ab370580bf71509b
    depends_build-append \
                    path:bin/perl5:perl5
    depends_lib-append \
                    port:libgit2
    kf5.depends_frameworks \
                    karchive kconfig kguiaddons \
                    ki18n kiconthemes kio kparts \
                    sonnet
    platform darwin {
        variant full description {activate features that are not currently supported fully on OS X} {}
        # this patch should be submitted upstream; cf. the corresponding sonnet patch
        patchfiles-append \
                    patch-ktexteditor-use-qsettings-iniformat.diff
        if {![variant_isset full]} {
            # *not* the +full version; disable certain features
            patchfiles-append \
                    patch-ktexteditor-disable-offending-menus.diff
        }
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-ktextwidgets {
    description     Text editing widgets
    long_description \
                    KTextWidgets provides widgets for displaying and editing text. It supports \
                    rich text as well as plain text.
    set kf5.framework \
                    ktextwidgets
    checksums       rmd160  9a2a8a487975f71a6c05667ab93c76f9f42c0b8a \
                    sha256  e3b08a4444e238f73811905d6a87f53181df3ecd7be49cca701c1204b45080a4
    kf5.depends_frameworks \
                    kcompletion kconfig kconfigwidgets ki18n \
                    kiconthemes kservice sonnet kwidgetsaddons \
                    kwindowsystem
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kwallet {
    description     Safe desktop-wide storage for passwords
    long_description \
                    This framework contains two main components: \
                    1: Interface to KWallet, the safe desktop-wide storage for passwords on KDE work \
                    spaces. \
                    2: The kwalletd used to safely store the passwords on KDE work spaces (when not using the OS X Keychain)
# not functional yet!
#     if {${os.platform} eq "darwin"} {
#         variant osxkeychain description {kwallet uses the OSX KeyChain} {
#             configure.args-append \
#                     -DMAC_USE_OSXKEYCHAIN:BOOL=ON
#         }
#     }
    set kf5.framework \
                    kwallet
    checksums       rmd160  a4718aa6b664b01cea36be85801b4ac067c76e7d \
                    sha256  3b6a119a44103d90cb25d4ee466bb301820156ed92f295771ac459534963a214
    kf5.depends_frameworks \
                    gpgmepp kconfig kcoreaddons kdbusaddons ki18n \
                    kiconthemes knotifications kservice kwidgetsaddons \
                    kwindowsystem
    platform "darwin" {
        depends_lib-append \
                port:gpgme \
                port:libgcrypt
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kwallet-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kwallet-nongui-runtimes.diff \
                    patch-kwallet-kwalletd-is-agent.diff \
                    patch-kwallet-cmake-keychain-or-kwalletd.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    if {![variant_exists osxkeychain] || ![variant_isset osxkeychain]} {
        post-destroot {
            xinstall -d -m 755 ${destroot}${prefix}/Library/LaunchAgents
            xinstall -m 644 ${filespath}/org.macports.kwalletd5.plist \
                ${destroot}${prefix}/Library/LaunchAgents
            reinplace "s|%PREFIX%|${prefix}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kwalletd5.plist
            if { ${startupitem.install} != "no" } {
                xinstall -d -m 755 ${destroot}${startup_root}/Library/LaunchAgents
                ln -s ${prefix}/Library/LaunchAgents/org.macports.kwalletd5.plist ${destroot}${startup_root}/Library/LaunchAgents
            }
        }
        notes-append    "The KDE Wallet daemon, kwalletd5, has to be started, and not on-demand by KDE itself. \
        This works best when done manually from a terminal (or a .cshrc/.profile/.bashrc script). \
        To do it automatically at login, use the following command (once): \
         launchctl load -w ${startup_root}/Library/LaunchAgents/org.macports.kwalletd5.plist"
     }
}

subport kf5-kxmlgui {
    description     Framework for managing menu and toolbar actions
    long_description \
                    KXMLGUI provides a framework for managing menu and toolbar actions in an \
                    abstract way. The actions are configured through a XML description and hooks \
                    in the application code. The framework supports merging of multiple \
                    description for example for integrating actions from plugins.
    set kf5.framework \
                    kxmlgui
    checksums       rmd160  25c022bbfa0e20035b6e68ea7138bf36d5fb4b9c \
                    sha256  b6fdb08a816f58aaca9419b9821c70e18641b371f2b22e63c095a3905c9a7d65
    kf5.depends_frameworks \
                    attica kconfig kconfigwidgets kglobalaccel \
                    ki18n kiconthemes kitemviews ktextwidgets \
                    kwidgetsaddons kwindowsystem
    # this patch should be reported upstream
    patchfiles-append \
                    patch-kxmlgui-kmainwindow-event.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kxmlrpcclient {
    description     XML-RPC client
    long_description \
                    This library contains simple XML-RPC Client support. It is a complete \
                    client and is quite easy to use.
    set kf5.framework \
                    kxmlrpcclient
    checksums       rmd160  bf6c800bbab13fcea03487d0c5d6f70f3be99de0 \
                    sha256  9a1db5fa2fcd87e55ac74e0ea8c05e4ddd83bcef68a471749bd63271966147fe
    kf5.depends_frameworks \
                    ki18n kio
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                patch-kxmlrpcclnt-add-qspxdg.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

### === Tier 4 ===

subport kf5-frameworkintegration {
    description     Integration of Qt application with KDE workspaces
    long_description \
                    Framework Integration is a set of plugins responsible for better integration of \
                    Qt applications, among others by improving theming capabilities
    conflicts-append \
                    kf5-frameworkintegration-devel
    set kf5.framework \
                    frameworkintegration
    checksums       rmd160  947cb31d2964adb949860b6892d70e6320029e86 \
                    sha256  743f94f359984b85f608b2f4f059b2daaa1f8dc90210431526677dcd0da60cb9
    kf5.depends_frameworks \
                    kconfig kconfigwidgets ki18n kiconthemes \
                    kio knotifications kwidgetsaddons
    patchfiles-append \
                    patch-fwintegration-platform-adaptation3.diff
#     post-patch {
#         reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/platformtheme/khintssettings.cpp
#     }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.env-append \
                    KDE_SESSION_VERSION=5
    notes-append    "frameworkintegration uses Noto Sans (https://www.google.com/get/noto/) and \
                    Oxygen Mono (http://download.kde.org/stable/plasma/5.4.0/oxygen-fonts-5.4.0.tar.xz) \
                    fonts, ensure these are installed for use at runtime. Also, in order to use your selected \
                    KDE theme automatically, you need to use port:qt5-kde and set KDE_SESSION_VERSION to a \
                    value >=4 (launchctl setenv KDE_SESSION_VERSION 5 and equivalent in your login script)."
}

subport kf5-frameworkintegration-devel {
    description     Integration of Qt application with KDE workspaces
    long_description \
                    Framework Integration is a set of plugins responsible for better integration of \
                    Qt applications, among others by improving theming capabilities
    conflicts-append \
                    kf5-frameworkintegration
    set kf5.framework \
                    frameworkintegration
    fetch.type      git
    git.branch      4037bdc0
    version         ${version}.5.0.0.173
    kf5.depends_frameworks \
                    kconfig kconfigwidgets ki18n kiconthemes \
                    kio knotifications kwidgetsaddons
    # autotests need more patching than just being built as nongui (non-app-bundle) executables!
    patchfiles-append \
                    patch-fwintegration-platform-adaptation4.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    test.env-append \
                    KDE_SESSION_VERSION=5
    notes-append    "frameworkintegration uses Noto Sans (https://www.google.com/get/noto/) and \
                    Oxygen Mono (http://download.kde.org/stable/plasma/5.4.0/oxygen-fonts-5.4.0.tar.xz) \
                    fonts, ensure these are installed for use at runtime. Also, in order to use your selected \
                    KDE theme automatically, you need to use port:qt5-kde and set KDE_SESSION_VERSION to a \
                    value >=4 (launchctl setenv KDE_SESSION_VERSION 5 and equivalent in your login script)."
}

homepage            http://projects.kde.org/projects/${kf5.virtualPath}/${kf5.framework} \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/${kf5.framework}/html/index.html
if {${fetch.type} eq "git"} {
    if {[file exists ${filespath}/${kf5.framework}-git/.git]} {
        git.url     ${filespath}/${kf5.framework}-git
    } else {
        git.url     git://anongit.kde.org/${kf5.framework}
    }
    distname        ${kf5.framework}-5.git
} else {
    master_sites    http://download.kde.org/stable/${kf5.folder}
    distname        ${kf5.framework}-${version}
}

### === Porting Aids ===
### this would probably be better in a separate portdir because despite being frameworks
### they are distributed from a different URL

subport kf5-kdelibs4support {
    description     Legacy support for kdelibs 4 compatibility
    long_description \
                    This framework provides code and utilities to ease the transition from \
                    kdelibs 4 to KDE Frameworks 5. This includes CMake macros and C++ \
                    classes whose functionality has been replaced by code in CMake, Qt and \
                    other frameworks.
    conflicts       kf5-kdelibs4support-devel
    variant kde4compat description {allow installation alongside KDE4's port:kde4-runtime} {}
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kde4-runtime
    }
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    kdelibs4support
    checksums       rmd160  7769359fd409f06c76b53cb16b6621c907e44871 \
                    sha256  3d9f2e9223c01caebd2bc2be1590b00ea9413a6874020caa622034f981c9270e
    depends_build-append \
                    ${kf5.oxygen-icons_dep}
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kbookmarks kcompletion kconfig kconfigwidgets \
                    kcrash kdbusaddons kded ki18n kdesignerplugin \
                    kdoctools kglobalaccel kguiaddons ki18n \
                    kiconthemes kio kitemviews knotifications kparts \
                    kservice ktextwidgets kunitconversion \
                    kwidgetsaddons kwindowsystem kxmlgui
    platform "darwin" {
        # pretend KDE_FULL_SESSION is set in order to get full support for theming settings
        patchfiles-append \
                    patch-kdelibs4supp-simulate-full_session.diff \
                    patch-kdelibs4supp-add-icon.diff
        post-patch {
            # create the destination directory that will host icon file links:
            xinstall -m 755 -d ${build.dir}/src/kdebugdialog/icons
            # call kf5.link_icons to populate that directory with icon links with appropriate names:
            # ${prefix}/share/icons/oxygen/128x128/actions/tools-report-bug.png will become 128-tools-report-bug.png etc.
            kf5.link_icons ${prefix}/share/icons/oxygen actions tools-report-bug.png ${build.dir}/src/kdebugdialog/icons
        }
    }
    # submit upstream
    patchfiles-append \
                    patch-kdelibs4supp-qosmac=osx.diff \
                    patch-kdelibs4supp-correct-menuroles-kaction.diff \
                    patch-kdelibs4supp-correct-fileshareset-install.diff
    # https://git.reviewboard.kde.org/r/126308
#     patchfiles-append \
#                     patch-kdelibs4supp-kpbutton-noshowicon.diff
    # https://git.reviewboard.kde.org/r/126309/
    patchfiles-append \
                    patch-kdelibs4supp-backtrace-demangle.diff
    patchfiles-append \
                    patch-kdelibs4supp-add-bundle-path.diff
    post-patch {
        reinplace "s|/usr/local/|${prefix}/|g" ${worksrcpath}/src/kssl/kopenssl.cpp
        reinplace "s|/usr/sbin|${prefix}/sbin|g" ${worksrcpath}/src/kio/kfileshare.cpp
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/kdecore/kmimetyperepository.cpp
        reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/kdecore/kstandarddirs.cpp
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    post-destroot {
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${destroot}${kf5.libexec_dir}/kf5/fileshareset
        if {[variant_isset kde4compat]} {
            file rename ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl \
                ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl5
        }
    }
}

subport kf5-kdelibs4support-devel {
    description     Legacy support for kdelibs 4 compatibility
    long_description \
                    This framework provides code and utilities to ease the transition from \
                    kdelibs 4 to KDE Frameworks 5. This includes CMake macros and C++ \
                    classes whose functionality has been replaced by code in CMake, Qt and \
                    other frameworks.
    conflicts       kf5-kdelibs4support
    variant kde4compat description {allow installation alongside KDE4's port:kde4-runtime} {}
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kde4-runtime
    }
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    fetch.type      git
    git.branch      eefd3e5ab9e82220e5e66d7655a6e0d11129ac42
    version         ${version}.5.2.0.145
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    kdelibs4support
    depends_build-append \
                    ${kf5.oxygen-icons_dep}
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kbookmarks kcompletion kconfig kconfigwidgets \
                    kcrash kdbusaddons kded ki18n kdesignerplugin \
                    kdoctools kglobalaccel kguiaddons ki18n \
                    kiconthemes kio kitemviews knotifications kparts \
                    kservice ktextwidgets kunitconversion \
                    kwidgetsaddons kwindowsystem kxmlgui
    platform "darwin" {
        # pretend KDE_FULL_SESSION is set in order to get full support for theming settings
        patchfiles-append \
                    patch-kdelibs4supp-simulate-full_session.diff \
                    patch-kdelibs4supp-add-icon.diff
        post-patch {
            xinstall -m 755 -d ${build.dir}/src/kdebugdialog/icons
            kf5.link_icons ${prefix}/share/icons/oxygen actions tools-report-bug.png ${build.dir}/src/kdebugdialog/icons
        }
    }
    # submit upstream
    patchfiles-append \
                    patch-kdelibs4supp-qosmac=osx.diff \
                    patch-kdelibs4supp-correct-menuroles-kaction.diff \
                    patch-kdelibs4supp-correct-fileshareset-install.diff
#     # https://git.reviewboard.kde.org/r/126308
#     patchfiles-append \
#                     patch-kdelibs4supp-kpbutton-noshowicon.diff
    # https://git.reviewboard.kde.org/r/126309/
    patchfiles-append \
                    patch-kdelibs4supp-backtrace-demangle.diff
    patchfiles-append \
                    patch-kdelibs4supp-add-bundle-path.diff
    post-patch {
        reinplace "s|/usr/local/|${prefix}/|g" ${worksrcpath}/src/kssl/kopenssl.cpp
        reinplace "s|/usr/sbin|${prefix}/sbin|g" ${worksrcpath}/src/kio/kfileshare.cpp
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/kdecore/kmimetyperepository.cpp
        reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/kdecore/kstandarddirs.cpp
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    post-destroot {
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${destroot}${kf5.libexec_dir}/kf5/fileshareset
        if {[variant_isset kde4compat]} {
            file rename ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl \
                ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl5
        }
    }
}

post-destroot {
    if {[variant_isset qspXDG]} {
        ui_msg "--->  Checking ${subport} for the QspXDG activator ..."
        if {[info exists kf5.framework]} {
            upvar #0 kf5.${kf5.framework}_lib lib
        } elseif {[info exists kf5.portingAid]} {
            upvar #0 kf5.${kf5.portingAid}_lib lib
        } else {
            upvar #0 kf5.${kf5.project}_lib lib
        }
        if {[info exists lib]} {
            set libopt "-qsplib ${lib}"
        } else {
            set libopt ""
        }
        if {[catch {system "${filespath}/../check-qspxdg.sh ${libopt} ${subport} 2>&1"} result context]} {
            ui_msg "QspXDG activator check failed: ${result}, ${context}"
        } else {
            ui_debug "QspXDG activator check: ${result}"
        }
    }
}

### === Meta Ports ===

if {${subport} eq ${name}} {
    long_description \
                    This meta-port pulls in all KF5 Frameworks, plus the kdelibs4support porting aid.
    homepage        http://projects.kde.org/projects/
    depends_build-append \
                    port:kf5-tier1-frameworks \
                    port:kf5-tier2-frameworks \
                    port:kf5-tier3-frameworks \
                    port:kf5-kdelibs4support
    fetch {}
    checksum {}
    extract {}
    build {}
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-tier1-frameworks {
    description     Meta-port for the Tier-1 Frameworks
    long_description \
                    ${description}, the frameworks that do not depend on other KF5 frameworks.
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier1
    depends_build-append \
                    ${kf5.kapidox_dep}
    kf5.depends_build_frameworks \
                    attica karchive kcodecs kconfig \
                    kcoreaddons kdbusaddons kdnssd kguiaddons \
                    ki18n kidletime kimageformats kitemmodels \
                    kitemviews kplotting kwidgetsaddons kwindowsystem \
                    solid sonnet threadweaver
    # kf5-kapidox  kf5-attica kf5-karchive kf5-kcodecs kf5-kconfig kf5-kcoreaddons kf5-kdbusaddons kf5-kdnssd kf5-kguiaddons kf5-ki18n kf5-kidletime kf5-kimageformats kf5-kitemmodels kf5-kitemviews kf5-kplotting kf5-kwidgetsaddons kf5-kwindowsystem kf5-solid kf5-sonnet kf5-threadweaver
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-tier2-frameworks {
    description     Meta-port for the Tier-2 Frameworks
    long_description \
                    ${description}, the frameworks that depend only on Tier-1 frameworks
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier2
    kf5.depends_build_frameworks \
                    kauth kcompletion kcrash kdoctools \
                    kfilemetadata kjobwidgets knotifications \
                    kpackage kpty kunitconversion
    # kf5-kauth kf5-kcompletion kf5-kcrash kf5-kdoctools kf5-kfilemetadata kf5-kjobwidgets kf5-knotifications kf5-kpackage kf5-kpty kf5-kunitconversion
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-tier3-frameworks {
    description     Meta-port for the Tier-3 Frameworks
    long_description \
                    ${description}, the frameworks that depend on Tier-1 and/or Tier-2 and/or Tier-3 frameworks
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier3
    kf5.depends_build_frameworks \
                    baloo kactivities kbookmarks kcmutils kconfigwidgets \
                    kdeclarative kded kdesignerplugin kdesu kdewebkit \
                    kemoticons kglobalaccel kiconthemes kinit kio \
                    knewstuff knotifyconfig kparts kpeople plasma-framework \
                    kservice ktexteditor ktextwidgets kwallet kxmlgui kxmlrpcclient
    # kf5-baloo kf5-kactivities kf5-kbookmarks kf5-kcmutils kf5-kconfigwidgets kf5-kdeclarative kf5-kded kf5-kdesignerplugin kf5-kdesu kf5-kdewebkit kf5-kemoticons kf5-kglobalaccel kf5-kiconthemes kf5-kinit kf5-kio kf5-knewstuff kf5-knotifyconfig kf5-kparts kf5-kpeople kf5-plasma-framework kf5-kservice kf5-ktexteditor kf5-ktextwidgets kf5-kwallet kf5-kxmlgui kf5-kxmlrpcclient
    # install order:
    # kf5-kconfigwidgets
    # kf5-kiconthemes kf5-kglobalaccel kf5-kservice
    # kf5-ktextwidgets
    # kf5-kxmlgui
    # kf5-kbookmarks kf5-kwallet
    # kf5-kio
    # kf5-baloo kf5-kdeclarative
    # kf5-kcmutils
    # kf5-kactivities
    # kf5-kinit kf5-kparts kf5-kdesignerplugin
    # kf5-kdewebkit kf5-kdesu kf5-kemoticons kf5-knewstuff kf5-knotifyconfig kf5-kpeople kf5-plasma-framework kf5-ktexteditor kf5-kxmlrpcclient kf5-kded
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-portingaid-frameworks {
    description     Meta-port for the Porting Aids Frameworks
    long_description \
                    ${description}, the frameworks aiming to ease the porting of applications \
                    from KDE4 to KF5 (KDE5).
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/#porting-aids
    kf5.depends_build_frameworks \
                    kdelibs4support
    # to be done: khtml, kjs, kjsembed, kmediaplayer, kross, krunner
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

livecheck.type      regex
livecheck.version   ${kf5.branch}
livecheck.url       http://download.kde.org/stable/frameworks/
livecheck.regex     (5+(\\.\\d+)+)

# kate: backspace-indents true; indent-pasted-text true; indent-width 4; keep-extra-spaces true; remove-trailing-spaces modified; replace-tabs true; replace-tabs-save true; syntax Tcl/Tk; tab-indents true; tab-width 4;
