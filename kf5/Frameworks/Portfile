# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
set kf5.framework   yes
PortGroup           kf5 1.1

name                KF5-Frameworks
version             ${kf5.version}
description         meta-port for the KF5 Frameworks
long_description    ${description}
maintainers         gmail.com:rjvbertin mk openmaintainer

installs_libs       yes
use_xz              yes
test.run            yes

variant qspXDG description {Configure Qt5's QStandardPaths to return XDG/Linuxy paths for shared locations} {
# The Qt5 QStandardPaths (QSP) patch allows QSP to return XDG/linuxy locations (paths) that are more suitable
# for a shared use of Qt5 in the MacPorts universe than the default values QSP returns that follow Apple's
# sandboxing dogmas. It must however be activated so that individual ports have the choice which "flavour" they
# use. KF5 applications should (probably) by using the XDG/Linuxy flavour unless they are to be built into
# individual, autonomous app bundles that each contain all required dependencies.
# Activation of the QSP patch is done by linking an additional, dedicated Qt component: Qt5::QspXDG .
# The approach philosophy used here is to link that component with all KF5 frameworks and helper applications
# built as part of those frameworks, even if they do not use the QSP class themselves. This redundancy comes
# with an overhead that should be negligible, and serves to lower the maintenance burden (monitoring the
# appearance of QSP usage).
}

if {${os.platform} eq "darwin"} {
    if {[file exists ${qt_cmake_module_dir}/Qt5QspXDG/Qt5QspXDGConfig.cmake]} {
        default_variants \
                    +qspXDG
    } else {
        ui_debug "We appear to be building against a Qt5 port that doesn't have RJVB's QSP patch. Don't fight it, just warn."
        notes-append "You will be running KF5 applications with the stock/native Qt5::QStandardPaths behaviour.\
                     That is not the recommended configuration."
    }
}

if {${subport} eq ${name}} {
    depends_build-append \
                    port:kf5-frameworkintegration
    set kf5.framework \
                    frameworkintegration
    fetch {}
    checksum {}
    extract {}
    build {}
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-packages
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-packages/${subport}"
    }
}

# patch.pre_args      -Np1

set kf5.pyversion   2.7
if {${os.platform} eq "darwin"} {
    # this should probably become under control of a variant
    set kf5.pythondep \
                    port:python27
    set kf5.pylibdir \
                    ${frameworks_dir}/Python.framework/Versions/${kf5.pyversion}/lib/python${kf5.pyversion}
} elseif {${os.platform} eq "linux"} {
    # for personal use: don't add a python dependency.
    set kf5.pythondep \
                    bin:python:python27
}

post-patch {
    if {[variant_isset qspXDG] && ${subport} ne "kf5-tier1-frameworks" \
        && ${subport} ne "kf5-tier2-frameworks" && ${subport} ne "kf5-tier3-frameworks"} {
        # patch the find_package(Qt5) command to add the activator of the QSP patch (which selects XDG behaviour).
        # careful with the backslashes: it's a regular expression that must be passed on to sed(1) correctly!
        reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/CMakeLists.txt
        if {[file exists ${worksrcpath}/src/CMakeLists.txt]} {
            reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/src/CMakeLists.txt
            reinplace "s|\\(target_link_libraries(KF5\[\^ \$\]\*\\)|\\1 PUBLIC Qt5::QspXDG|g" ${worksrcpath}/src/CMakeLists.txt
        }
    }
}

variant examples description {install any examples provided} {
    post-destroot {
        if {[file exists ${build.dir}/examples]} {
            ui_debug "Installing examples"
            xinstall -m 755 -d ${destroot}${kf5.applications_dir}/examples
            foreach app [glob -nocomplain ${build.dir}/examples/*.app ${build.dir}/examples/*/*.app] {
                file copy ${app} ${destroot}${kf5.applications_dir}/examples/
            }
        }
    }
}

### === Tier 1 ===

subport kf5-tier1-frameworks {
    description     Meta-port for the Tier-1 Frameworks
    long_description \
                    ${description}
    depends_build-append \
                    ${kf5.attica_dep} ${kf5.karchive_dep} \
                    ${kf5.kcodecs_dep} ${kf5.kconfig_dep} \
                    ${kf5.kcoreaddons_dep} ${kf5.kdbusaddons_dep} \
                    ${kf5.kdnssd_dep} ${kf5.kguiaddons_dep} \
                    ${kf5.ki18n_dep} ${kf5.kidletime_dep} \
                    ${kf5.kimageformats_dep} ${kf5.kitemmodels_dep} \
                    ${kf5.kitemviews_dep} ${kf5.kplotting_dep} \
                    ${kf5.kwidgetsaddons_dep} ${kf5.kwindowsystem_dep} \
                    ${kf5.solid_dep} ${kf5.sonnet_dep} ${kf5.threadweaver_dep}
    installs_libs   no
    supported_archs noarch
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-packages
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-packages/${subport}"
    }
}

subport kf5-attica {
    description     Open Collaboration Service client library
    long_description \
                    Attica is a Qt library that implements the Open Collaboration Services API version 1.6 .
    set kf5.framework \
                    attica
    checksums       rmd160  31c8e1deedfcf6465a614690e3c14cfa420edc54 \
                    sha256  94c928b84a82c44c1331a1b4d585e894524c4a023f90e1906eaf5441d955ad3d
    conflicts       attica-qt5
}

subport kf5-kapidox {
    description     KDE Doxygen Tools
    long_description \
                    This framework contains scripts and data for building API documentation (dox) in \
                    a standard format and style. \
                    The Doxygen tool is used to do the actual documentation extraction and \
                    formatting, but this framework provides a wrapper script to make generating the \
                    documentation more convenient (including reading settings from the target \
                    framework or other module) and a standard template for the generated \
                    documentation.
    set kf5.framework \
                    kapidox
    checksums       rmd160  e520b51932326f8cb39ea109129392d3963344a0 \
                    sha256  98ed6ce505f4e17264809ab0414d6305b0626280d45aa06df84ee554c891828c
    installs_libs   no
    depends_build-append \
                    ${kf5.pythondep}
    depends_run-append \
                    ${kf5.pythondep} \
                    port:doxygen
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    post-destroot {
        if {${os.platform} eq "darwin"} {
            xinstall -m 755 -d ${destroot}/${kf5.pylibdir}
            file rename ${destroot}${prefix}/lib/python${kf5.pyversion}/site-packages ${destroot}/${kf5.pylibdir}
        }
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-karchive {
    description     Reading, creating, and manipulating file archives
    long_description \
                    KArchive provides classes for easy reading, creation and manipulation of \
                    "archive" formats like ZIP and TAR. \
                    It also provides transparent compression and decompression of data, like the \
                    GZip format, via a subclass of QIODevice.
    set kf5.framework \
                    karchive
    checksums       rmd160  2f7c73a9ea1cedd76db61b34a2723e0844e31819 \
                    sha256  d0b5dfaf6a98ad40e499c67ec6788247c285c97564e2840a4faff90de27bb5e8
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kcodecs {
    description     String encoding library
    long_description \
                    KCodecs provide a collection of methods to manipulate strings using various \
                    encodings. It can automatically determine the charset of a string, translate XML entities, \
                    validate email addresses, and find encodings by name in a more tolerant way than QTextCodec \
                    (useful e.g. for data coming from the Internet).
    set kf5.framework \
                    kcodecs
    checksums       rmd160  77e468e22a3c412d9bf0f322a6f1adf8df23cb41 \
                    sha256  f71c51f064fdfde2b6eeb898aaf1f651c407e91844306359a7c07dbafadae8cf
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kconfig {
    description     Persistent platform-independent application settings.
    long_description \
                    KConfig provides an advanced configuration system. It is made of two parts with the evocative names \
                    KConfigCore and KConfigGui.
    set kf5.framework \
                    kconfig
    checksums       rmd160  2612543f44d795c8705315c6eb06d734a3589acf \
                    sha256  764bc8af55482cf1c88817c85c12a0fdb3fde5726ab0386cbb1b2f5df2256f20
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kconfig-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kconfig-prefix-etc.diff
    post-patch {
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/core/kconfig.cpp
    }
}

subport kf5-kcoreaddons {
    description     Qt addon library with a collection of non-GUI utilities
    long_description \
                    KCoreAddons provides classes built on top of QtCore to perform various tasks \
                    such as manipulating mime types, autosaving files, creating backup files, \
                    generating random sequences, performing text manipulations such as macro \
                    replacement, accessing user information and many more.
    set kf5.framework \
                    kcoreaddons
    checksums       rmd160  f0ab1b42a06fd76f68e2f5cd002cf9adcd425fe0 \
                    sha256  b5dd4db06ed1d7b50047bade34520d433c6f30defd7cbd74929cf5dce95a06ec

    depends_lib-append \
                    port:shared-mime-info
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kcoreaddons-add-qspxdg.diff
    }
    if {${os.platform} eq "darwin"} {
        configure.args-append \
                    -DKDE4_DEFAULT_HOME=Library/Preferences/KDE
    }
}

subport kf5-kdbusaddons {
    description     Convenience classes for DBus
    long_description \
                    KDBusAddons provides convenience classes on top of QtDBus, as well as an API to \
                    create KDED modules.
    set kf5.framework \
                    kdbusaddons
    checksums       rmd160  3118b27ff904931983551dd89f4bfcd97d94ad77 \
                    sha256  dddd802bd03862eac02423fb24abce8017c372c6ae0d29a69862411789ca62f0
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdbusaddons-add-qspxdg.diff
    }
}

subport kf5-kdnssd {
    description     Network service discovery using Zeroconf
    long_description \
                    KDNSSD is a library for handling the DNS-based Service Discovery Protocol \
                    (DNS-SD), the layer of Zeroconf(TM) that allows network \
                    services, such as printers, to be discovered without any user intervention or \
                    centralised infrastructure.
    set kf5.framework \
                    kdnssd
    checksums       rmd160  315b9565cb4f6f697d7b9d6d9b00a5af42d34c30 \
                    sha256  13407b4d76cb5aeee808b9b88e6e76f2ba820a65b38cffc170752756af11adfc
    if {${os.platform} eq "darwin"} {
        # Avahi is required but apparently only at runtime
        depends_run-append \
                    port:avahi
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kguiaddons {
    description     Utilities for graphical user interfaces
    long_description \
                    The KDE GUI addons provide utilities for graphical user interfaces in the areas \
                    of colours, fonts, text, images, keyboard input.
    set kf5.framework \
                    kguiaddons
    checksums       rmd160  574176126098992f49f11cb11b4224dacd9acc46 \
                    sha256  081b18c79c37f9e050c87264563392625a7eb0b527fb27c6840f443382b6cc5d
    if {[variant_isset qspXDG]} {
        # this is a probable case of currently unneeded QSP patch activation
        patchfiles-append \
                    patch-kguiaddons-add-qspxdg.diff
    }
}

subport kf5-ki18n {
    description     KDE Gettext-based UI text internationalisation
    long_description \
        KI18n provides functionality for internationalising user interface text \
        in applications, based on the GNU Gettext translation system. \
        It wraps the standard Gettext functionality, so that the programmers \
        and translators can use the familiar Gettext tools and workflows. \
        KI18n provides additional functionality as well, for both programmers \
        and translators, which can help to achieve a higher overall quality \
        of source and translated text. This includes argument capturing, \
        customisable markup, and translation scripting.
    set kf5.framework \
                    ki18n
    checksums       rmd160  7b112a3842fcdc0d3ba4f2389a9af8a070c60dca \
                    sha256  ade17464f9d794fb732aa77de3060a8fcbf4b6c91a750be5d47e49adc9b6c763
#   The Qt5::QspXDG activator module shouldn't be necessary for plugins
#     if {[variant_isset qspXDG]} {
#         patchfiles-append \
#                     patch-ki18n-add-qspxdg.diff
#     }
}

subport kf5-kidletime {
    description     Reporting of idle time of user and system
    long_description \
                    KIdleTime is a singleton reporting information on idle time. It is useful not \
                    only for finding out about the current idle time of the host, but also for getting \
                    notified upon idle time events, such as custom timeouts, or user activity.
    set kf5.framework \
                    kidletime
    checksums       rmd160  df34292cb3f35ef349d43d0f2889b08ed272ff6e \
                    sha256  228a74c02dbc0787747a45d20f40d986a40063b1dcfeec3c09eb2765767ee63e
    # RJVB: kidletime currently seems to use a Carbon-based poller ; check if I haven't already implemented
    # something more native for KDE4.
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kimageformats {
    description     Plugins to allow QImage to support extra file formats.
    long_description \
                    This framework provides additional image format plugins for QtGui. \
                    As such it is not required for the compilation of any other software, \
                    but may be a runtime requirement for Qt-based software to support \
                    certain image formats.
    set kf5.framework \
                    kimageformats
    checksums       rmd160  71c84b1989cb7787264f99e040a1762f89018a33 \
                    sha256  7bdf0592cbc7fef643d857b58359f116835c79ca65aa6f49579d483843e2c660
    if {${os.platform} eq "darwin"} {
        depends_lib-append \
                    port:openexr
    }
    if {[variant_isset qspXDG]} {
        # adding the QSP activator to the plugins too for now; should be unnecessary.
        patchfiles-append \
                    patch-kimageformats-add-qspxdg.diff
    }
}

subport kf5-kitemmodels {
    description     Set of item models extending the Qt model-view framework
    long_description \
                    Set of item models extending the Qt model-view framework
    set kf5.framework \
                    kitemmodels
    checksums       rmd160  ebeb39118735cac04ddbfe41c86d736ee873292c \
                    sha256  ea7987cecf377e4c456aef706e3e1527ad98a5f8d6ba7e213dfb2fd55b454a84
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
    kf5.add_test_library_path \
                    ${build.dir}/autotests/proxymodeltestsuite
}

subport kf5-kitemviews {
    description     Set of item views extending the Qt model-view framework
    long_description \
                    KItemViews includes a set of views, which can be used with item models. It \
                    includes views for categorising lists and to add search filters to flat and \
                    hierarchical lists.
    set kf5.framework \
                    kitemviews
    checksums       rmd160  37e85025ac6e6a3822080a58d52eee82012ad160 \
                    sha256  d1637a8ccbf1bf349e38682b0615785ab3610807328acc7ed47c73e0e8e92284
}

subport kf5-kplotting {
    description     A lightweight plotting framework
    long_description \
                    KPlotWidget is a QWidget-derived class that provides a virtual base class \
                    for easy data-plotting. The idea behind KPlotWidget is that you only have \
                    to specify information in \"data units\"\; i.e., the natural units of the \
                    data being plotted.  KPlotWidget automatically converts everything \
                    to screen pixel units.
    set kf5.framework \
                    kplotting
    checksums       rmd160  da862c0af459010a40a61f7c611787889d39ee3e \
                    sha256  32cf01e2feca7ec11dd56891652958e57d5e3dd0d9bdd2d22da2390cd4a79873
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kplotting-add-qspxdg.diff
    }
}

subport kf5-kwidgetsaddons {
    description     A large set of desktop widgets
    long_description \
                    This repository contains add-on widgets and classes for applications \
                    that use the Qt Widgets module. If you are porting applications from \
                    KDE Platform 4 "kdeui" library, you will find many of its classes here. \
                    Provided are action classes that can be added to toolbars or menus, \
                    a wide range of widgets for selecting characters, fonts, colours, \
                    actions, dates and times, or MIME types, as well as platform-aware \
                    dialogs for configuration pages, message boxes, and password requests. \
                    Further widgets and classes can be found in other KDE frameworks.
    set kf5.framework \
                    kwidgetsaddons
    checksums       rmd160  05cc16185b9d3d7f9b5c2bb439315823299bf0d4 \
                    sha256  c3e0fed862a3053481a526f923e79cdef890cec93105fe95080e7cd78ad36fd9
}

subport kf5-kwindowsystem {
    description     Access to the windowing system
    long_description \
                    Convenience access to certain properties and features of the windowing system. \
                    KWindowSystem provides information about the windowing system and allows interaction with \
                    the windowing system. It provides a high level API which is windowing system independent and \
                    has platform specific implementations. This API is inspired by X11 and thus not all functionality \
                    is available on all windowing systems. On Mac OS X, X11 support is not included though that \
                    would be possible theoretically.
    set kf5.framework \
                    kwindowsystem
    checksums       rmd160  494db63845f868823346e6ab79ad53ab48c87ea4 \
                    sha256  1db9fcc1a109556cc41896b17427a031bfa7bdaf6bab36b415f348e3d75317f5
    if {${os.platform} eq "darwin"} {
        test.cmd    echo
        test.target no tests for this framework
    }
}

subport kf5-solid {
    description     Desktop hardware abstraction
    long_description \
                    Solid is a device integration framework.  It provides a way of querying and \
                    interacting with hardware independently of the underlying operating system.
    set kf5.framework \
                    solid
    checksums       rmd160  05663588a0004b43197d0409489b89e02d5a9c1c \
                    sha256  ca715a7f23fe6477fce6cfefc3a63655cd7526406b493ac678fb31ecac5f2804
    if {${os.platform} eq "darwin"} {
        depends_build-append \
                    port:flex \
                    port:bison
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-solid-add-qspxdg.diff
    }
    configure.args-append \
                    -DWITH_NEW_SOLID_JOB=ON
}

subport kf5-sonnet {
    description     Multi-language spell checker
    long_description \
                    Sonnet is a plugin-based spell checking library for Qt-based \
                    applications. It supports several different plugins, including \
                    HSpell, Enchant, ASpell and HUNSPELL. \
                    It also supports automated language detection, based on a \
                    combination of different algorithms.
    set kf5.framework \
                    sonnet
    checksums       rmd160  a47b9611f4b8d9c2917c4cd7cfa2e78638b46cac \
                    sha256  a0be638acbed60a513e1aa086bc86a8e6876341e4f981617e55f6edfbe2e1aa3
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-sonnet-add-qspxdg.diff
    }
    if {${os.platform} eq "darwin"} {
        patchfiles-append \
                    patch-sonnet-use-qsettings-iniformat.diff
        # backend variants. Don't attempt to deactivate non-selected backends for now.
        variant aspell description {build the aspell backend} {
            depends_lib-append \
                    port:aspell
        }
        variant hunspell description {build the hunspell backend} {
            depends_lib-append \
                    port:hunspell
        }
        default_variants-append \
                    +aspell
    }
}

subport kf5-threadweaver {
    description     threadweaver
    long_description \
                    threadweaver
    set kf5.framework \
                    threadweaver
    checksums       rmd160  08350c72482d0dd80f6bd47e8c14e4cc9834f3e3 \
                    sha256  f89ec571fe47249956e14d209cb2867d879401554ae60227e12355c94d4e0aa6
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

### === Tier 2 ===

subport kf5-kauth {
    description     Execute actions as privileged user
    long_description \
                    KAuth provides a convenient, system-integrated way to offload actions that need \
                    to be performed as a privileged user (root, for example) to small (hopefully \
                    secure) helper utilities.
    set kf5.framework \
                    kauth
    checksums       rmd160  335bd7b2101131c1778740124b74c4ef7233e6f5 \
                    sha256  e2a91e1a4c40d5547c8963c74a805810b6bc192e3193245f52e855addc7219da
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kauth-add-qspxdg.diff
    }
    depends_lib-append \
                    ${kf5.kcoreaddons_dep}
    # on linux, PolkitQt5-1 or PolkitQt-1 is required
    if {${os.platform} eq "linux"} {
        depends_lib-append \
                    port:polkit-qt5
    }
}

subport kf5-kcompletion {
    description     Powerful completion framework, including completion-enabled lineedit and combobox.
    long_description \
                    When typing filenames, email addresses and other text where the user often wants \
                    to select from existing data (including what they previously typed) rather than \
                    enter anything wholly original, users often find it helpful if they only need to \
                    type the first few characters, and then have the application offer them a set of \
                    choices or attempt to finish off what they were typing. Email clients, shells \
                    and \"open file\" dialogs often provide this functionality. \
                    This framework helps implement this in Qt-based applications. You can use one of \
                    the completion-ready widgets provided by this framework, or integrate it into \
                    your application's other widgets directly.
    set kf5.framework \
                    kcompletion
    checksums       rmd160  dd4b03a74f4c70df11ca9e4f9b35bc681354a155 \
                    sha256  deb2c24d995b8b6aa57309980f45fad49739bef693b1286bebc383f11c0801d7
    depends_lib-append \
                    ${kf5.kconfig_dep} \
                    ${kf5.kwidgetsaddons_dep}
}

subport kf5-kcrash {
    description     Graceful handling of application crashes
    long_description \
                    KCrash provides support for intercepting and handling application crashes.
    set kf5.framework \
                    kcrash
    checksums       rmd160  d2dbbd564a9b2a42bba99e209074102b8c67c579 \
                    sha256  7eac0e5ed260bf60c674a82981aaac81feea9ca5b6bb2a34256b95845ee56198
    depends_lib-append \
                    ${kf5.kcoreaddons_dep} \
                    ${kf5.kwindowsystem_dep}
    if {${os.platform} eq "darwin"} {
        patchfiles-append \
                    patch-kcrash-dont-closeAllFDs.diff
    }
}

subport kf5-kdoctools {
    description     Create documentation from DocBook
    long_description \
                    Provides tools to generate documentation in various format from DocBook files.
    set kf5.framework \
                    kdoctools
    checksums       rmd160  90c407a475c8b72e29e61ef1a98fa8e7793730ca \
                    sha256  6ac31e6349420cd94a5353c8f608700e2c8adb7f29e57f3eeb9118aaf619916d
    depends_build-append \
                    ${kf5.ki18n_dep} \
                    ${kf5.pythondep}
    depends_lib-append \
                    ${kf5.karchive_dep} \
                    port:libxslt \
                    port:docbook-xml \
                    port:docbook-xsl \
                    port:p5-uri \
                    port:gettext
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdoctools-add-qspxdg.diff
    }
# this patch is unnecessary if the kdelibs4 headers are moved out of the ${prefix}/include root
#     if {${os.platform} eq "darwin"} {
#         # workaround what appears to be a bug in the kdoctools buildsystem that
#         # causes it to pick up KDE4 headerfiles when they're present:
#         patchfiles-append \
#                     patch-kdoctools-xslt_kde.cpp.diff
#     }
    configure.args-append \
                        -DDOCBOOKXSL_DIR=${prefix}/share/xsl/docbook-xsl \
                        -DLIBXML2_INCLUDE_DIR=${prefix}/include/libxml2 \
                        -DLIBXML2_LIBRARIES=${prefix}/lib/libxml2.${kf5.libs_ext} \
                        -DLIBXML2_XMLLINT_EXECUTABLE=${prefix}/bin/xmllint \
                        -DLIBXSLT_INCLUDE_DIR=${prefix}/include \
                        -DLIBXSLT_LIBRARIES=${prefix}/lib/libxslt.${kf5.libs_ext}
}

subport kf5-kfilemetadata {
    description     A file metadata and text extraction library
    long_description \
                    KFileMetaData provides a simple library for extracting the text and metadata \
                    from a number of different files. This library is typically used by file \
                    indexers to retreive the metadata.
    set kf5.framework \
                    kfilemetadata
    checksums       rmd160  0f6efac9c3c432434e9678191632ee460226dad1 \
                    sha256  1667e428b35b5f98b711b4ed6f45b3d705a1e90baf721a1d17dcd623ea5720f9
    depends_lib-append \
                    ${kf5.karchive_dep} \
                    ${kf5.ki18n_dep}
    if {${os.platform} eq "darwin"} {
        depends_lib-append \
                    port:poppler-qt5-mac \
                    port:taglib \
                    port:exiv2 \
                    path:lib/libavcodec.dylib:ffmpeg \
                    port:ebook-tools
    }
    variant kde4compat description {allow installation alongside KDE4's port:kfilemetadata} {
        # note: it might be useful to provide a complementary variant to port:kfilemetadata
        post-destroot {
            file delete -force ${destroot}${prefix}/share/locale
        }
    }
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kfilemetadata
    }
}

subport kf5-kjobwidgets {
    description     Widgets for showing progress of asynchronous jobs
    long_description \
                    KJobWIdgets provides widgets for showing progress of asynchronous jobs.
    set kf5.framework \
                    kjobwidgets
    checksums       rmd160  fe8cd93f5b1c01a4b68baf83a8f4e5c691723924 \
                    sha256  aa7db4d1440579d784709ecc1f2dda443ef9b22f8f3cdbc0914cd5cd5790238b
    depends_lib-append \
                    ${kf5.kcoreaddons_dep} \
                    ${kf5.kwidgetsaddons_dep}
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-knotifications {
    description     Desktop notifications
    long_description \
                    KNotification is used to notify the user of an event. It covers feedback and \
                    persistent events.
    set kf5.framework \
                    knotifications
    checksums       rmd160  a870b63ae6c17e706a8a66ba4550767cabd9fd08 \
                    sha256  958d2c98563e3de0bf49490a931e95100efa06f91647eb1d1523c5a252ef0985
    depends_lib-append \
                    ${kf5.kconfig_dep} \
                    ${kf5.kcodecs_dep} \
                    ${kf5.kcoreaddons_dep} \
                    ${kf5.kwindowsystem_dep} \
                    port:phonon-qt5 \
                    port:dbusmenu-qt5
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kunitconversion {
    description     Converting physical units
    long_description \
                    KUnitConversion provides functions to convert values in different physical \
                    units. It supports converting different prefixes (e.g. kilo, mega, giga) as \
                    well as converting between different unit systems (e.g. liters, gallons).
    set kf5.framework \
                    kunitconversion
    checksums       rmd160  447e4a69ae09120548d776748223cb261bc9768c \
                    sha256  aec7a2d9f3d8e5d4a9b73cb36d68aa9ab26f8adffc98844f3a22c6c18fd177e1
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    depends_lib-append \
                    ${kf5.kconfig_dep} \
                    ${kf5.ki18n_dep}
}

### === Tier 3 ===

subport kf5-kconfigwidgets {
    description     Widgets for configuration dialogs
    long_description \
                    KConfigWidgets provides easy-to-use classes to create configuration dialogs, as \
                    well as a set of widgets which uses KConfig to store their settings.
    set kf5.framework \
                    kconfigwidgets
    checksums       rmd160  3053310c30d9342008277e97264932ac917b9ed7 \
                    sha256  43664b4e2b4175401dba9da379c0cd98d86627e68cb87e7d31e838ff5c3c783e
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    depends_lib-append \
                    ${kf5.kwidgetsaddons_dep} \
                    ${kf5.kguiaddons_dep} \
                    ${kf5.kconfig_dep} \
                    ${kf5.kauth_dep} \
                    ${kf5.ki18n_dep} \
                    ${kf5.kcoreaddons_dep} \
                    ${kf5.kdoctools_dep} \
                    ${kf5.kcodecs_dep}
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

subport kf5-kiconthemes {
    description     Icon GUI utilities
    long_description \
                    This library contains classes to improve the handling of icons \
                    in applications using the KDE Frameworks.
    set kf5.framework \
                    kiconthemes
    checksums       rmd160  5f7dee9359c58a76c7a66571db8109d914164052 \
                    sha256  e2fdf07e04e9fd06a4515677a5bcaf31bfc309d0772578e5ff915039e28c6929
    depends_build-append \
                    port:gettext \
                    ${kf5.pythondep}
    depends_lib-append \
                    ${kf5.ki18n_dep} \
                    ${kf5.kconfigwidgets_dep} \
                    ${kf5.kwidgetsaddons_dep} \
                    ${kf5.kitemviews_dep}
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kiconthemes-add-qspxdg.diff
    }
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
}

homepage            http://projects.kde.org/projects/${kf5.virtualPath}/${kf5.framework}
master_sites        http://download.kde.org/stable/${kf5.folder}
distname            ${kf5.framework}-${version}

livecheck.type      regex
livecheck.url       http://download.kde.org/stable/frameworks/${kf5.branch}
livecheck.regex     (5+(\\.\\d+)+)

# kate: backspace-indents true; indent-pasted-text true; indent-width 4; keep-extra-spaces true; remove-trailing-spaces modified; replace-tabs true; replace-tabs-save true; syntax Tcl/Tk; tab-indents true; tab-width 4;
