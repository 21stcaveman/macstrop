# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
set kf5.framework   yes
PortGroup           kf5 1.1

name                KF5-Frameworks
version             ${kf5.version}
description         meta-port for the KDE Frameworks Version 5
long_description    ${description}
maintainers         gmail.com:rjvbertin mk openmaintainer

installs_libs       yes
if {${os.platform} eq "darwin"} {
    test.run        no
} else {
    test.run        yes
}

# read the checksums from a file
if {[file exists ${filespath}/checksums.table]} {
    source ${filespath}/checksums.table
}

proc kf5.set_checksums {} {
    global checksumtable
    global subport
    if {[info exists checksumtable]} {
        checksums   rmd160  [lindex $checksumtable(${subport}) 0] \
                    sha256  [lindex $checksumtable(${subport}) 1]
    }
}

set startup_root ""

variant qspXDG conflicts nativeQSP description "Switch Qt5's QStandardPaths to XDG-compliant mode (e.g. using ${prefix}/share)" {
# The Qt5 QStandardPaths (QSP) patch allows QSP to return XDG/linuxy locations (paths) that are more suitable
# for a shared use of Qt5 in the MacPorts universe than the default values QSP returns that follow Apple's
# sandboxing dogmas. It must however be activated so that individual ports have the choice which "flavour" they
# use. KF5 applications should (probably) by using the XDG/Linuxy flavour unless they are to be built into
# individual, autonomous app bundles that each contain all required dependencies.
# Activation of the QSP patch is done by linking an additional, dedicated Qt component: Qt5::QspXDG .
# The approach philosophy used here is to link that component with all KF5 frameworks and helper applications
# built as part of those frameworks, even if they do not use the QSP class themselves. This redundancy comes
# with an overhead that should be negligible, and serves to lower the maintenance burden (monitoring the
# appearance of QSP usage).
#
# KF5 autotests were conceived to run with XDG-compliant QSP locations, and wreak havock when they are not.
    test.run        yes
}

platform darwin {
    if {[file exists ${qt_cmake_module_dir}/Qt5QspXDG/Qt5QspXDGConfig.cmake]
        || [file exists ${qt_includes_dir}/QtCore/qextstandardpaths.h]} {
        default_variants \
                    +qspXDG
    } else {
        ui_debug "We appear to be building against a Qt5 port that doesn't have the QSP patch from port:qt5-kde. Don't fight it, just warn."
        notes-append "You will be running KF5 applications with the stock/native Qt5::QStandardPaths behaviour.\
                     That is not the recommended configuration for this port."
    }
}
if {(${os.platform} eq "darwin") && ![variant_isset qspXDG]} {
    # NOTE: Many kf5 ports violate MacPorts' ports file systems,
    #       but it is a must due to Qt5's QStandardPaths logic,
    #       so we'll quieten the warning this causes.
    destroot.violate_mtree  yes
}
if {[variant_isset qspXDG]} {
    # 20160214 : switch from QStandardPaths to the experimental QExtStandardPaths
    configure.cppflags-append \
                    -DQT_USE_EXTSTANDARDPATHS
    # configure QExtStandardPaths to use the QSP/XDG mode set by the QSP activator.
    # alternatives are false (use native QSP) and true (use XDG-compliant QS).
    configure.cppflags-append \
                    -DQT_EXTSTANDARDPATHS_XDG_DEFAULT=runtime
}

patch.pre_args      -Np0

pre-patch {
    if {[variant_isset qspXDG] && (${subport} ne "kf5-tier1-frameworks") \
        && (${subport} ne "kf5-tier2-frameworks") && (${subport} ne "kf5-tier3-frameworks")} {
        # patch the find_package(Qt5) command to add the activator of the QSP patch (which selects XDG behaviour).
        # careful with the backslashes: it's a regular expression that must be passed on to sed(1) correctly!
        if {[file exists ${worksrcpath}/CMakeLists.txt]} {
            reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/CMakeLists.txt
        }
        if {[file exists ${worksrcpath}/src/CMakeLists.txt]} {
            reinplace "s|\\(find_package(Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/src/CMakeLists.txt
            reinplace "s|\\(target_link_libraries(KF5\[\^ \$\]\*\\)|\\1 PRIVATE Qt5::QspXDG|g" ${worksrcpath}/src/CMakeLists.txt
        }
    }
}

post-destroot {
    if {[variant_exists examples] && [variant_isset examples] && [file exists ${build.dir}/examples]} {
        ui_debug "Installing examples"
        xinstall -m 755 -d ${destroot}${kf5.applications_dir}/examples
        foreach app [glob -nocomplain ${build.dir}/examples/*.app ${build.dir}/examples/*/*.app] {
            file copy ${app} ${destroot}${kf5.applications_dir}/examples/
        }
    }
}

### === Tier 1 ===

subport kf5-attica {
    description     Open Collaboration Service client library
    long_description \
                    Attica is a Qt library that implements the Open Collaboration Services API version 1.6 .
    set kf5.framework \
                    attica
    kf5.set_checksums
    conflicts-append \
                    attica-qt5
}

subport kf5-kapidox {
    description     KDE Doxygen Tools
    long_description \
                    This framework contains scripts and data for building API documentation (dox) in \
                    a standard format and style. \
                    The Doxygen tool is used to do the actual documentation extraction and \
                    formatting, but this framework provides a wrapper script to make generating the \
                    documentation more convenient (including reading settings from the target \
                    framework or other module) and a standard template for the generated \
                    documentation.
    set kf5.framework \
                    kapidox
    kf5.set_checksums
    installs_libs   no
    supported_archs noarch
    depends_build-append \
                    ${kf5.pythondep}
    depends_run-append \
                    ${kf5.pythondep} \
                    port:py${kf5.pybranch}-yaml \
                    port:py${kf5.pybranch}-jinja2
    platform darwin {
        # doxygen has a *lot* of dependencies all the way to Xorg, which are
        # complete overkill for a *runtime* dependency on Linux. Get it from
        # the host there.
        # doxyqml supports only Python 2.7
        depends_run-append \
                    port:doxygen \
                    port:py27-doxyqml
    }
    patchfiles-append \
                    patch-kapidox-include-objc++.diff
    configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python${kf5.pyversion}
    post-destroot {
        if {${os.platform} eq "darwin"} {
            xinstall -m 755 -d ${destroot}/${kf5.pylibdir}
            file rename ${destroot}${prefix}/lib/python${kf5.pyversion}/site-packages ${destroot}/${kf5.pylibdir}
        } elseif {${os.platform} eq "linux"} {
            foreach b [glob -nocomplain ${destroot}${prefix}/bin/*] {
                reinplace "s|/usr/bin/python|${prefix}/bin/python|g" ${b}
                reinplace "s|'/usr/share/doc/qt'|'${prefix}/libexec/qt5/doc'|g" ${b}
                reinplace "s|/usr/share|${prefix}/share|g" ${b}
            }
        }
    }
    test.cmd        echo
    test.target     no tests for this framework
    notes-append    "It is recommended to install the Roboto fonts for optimal displaying of documentation generated \
                    through kf5-kapidox and doxygen. See http://www.google.com/fonts/specimen/Roboto ."
}

subport kf5-karchive {
    description     Reading, creating, and manipulating file archives
    long_description \
                    KArchive provides classes for easy reading, creation and manipulation of \
                    "archive" formats like ZIP and TAR. \
                    It also provides transparent compression and decompression of data, like the \
                    GZip format, via a subclass of QIODevice.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    karchive
    kf5.set_checksums
    depends_lib-append \
                    port:zlib
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kcodecs {
    description     String encoding library
    long_description \
                    KCodecs provide a collection of methods to manipulate strings using various \
                    encodings. It can automatically determine the charset of a string, translate XML entities, \
                    validate email addresses, and find encodings by name in a more tolerant way than QTextCodec \
                    (useful e.g. for data coming from the Internet).
    set kf5.framework \
                    kcodecs
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
}

subport kf5-kconfig {
    description     Persistent platform-independent application settings.
    long_description \
                    KConfig provides an advanced configuration system. It is made of two parts with the evocative names \
                    KConfigCore and KConfigGui.
    set kf5.framework \
                    kconfig
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kconfig-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kconfig-prefix-etc.diff \
                    patch-kconfig-restore-wingeo.diff
    post-patch {
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/core/kconfig.cpp
    }
}

subport kf5-kcoreaddons {
    description     Qt addon library with a collection of non-GUI utilities
    long_description \
                    KCoreAddons provides classes built on top of QtCore to perform various tasks \
                    such as manipulating mime types, autosaving files, creating backup files, \
                    generating random sequences, performing text manipulations such as macro \
                    replacement, accessing user information and many more.
    set kf5.framework \
                    kcoreaddons
    kf5.set_checksums
    depends_lib-append \
                    port:shared-mime-info
    if {[variant_isset qspXDG]} {
        # desktoptojson doesn't currently use QSP so doesn't require the activator
        patchfiles-append \
                    patch-kcoreaddons-add-qspxdg.diff
    }
    platform darwin {
        configure.args-append \
                    -DKDE4_DEFAULT_HOME=Library/Preferences/KDE
    }
}

subport kf5-kdbusaddons {
    description     Convenience classes for DBus
    long_description \
                    KDBusAddons provides convenience classes on top of QtDBus, as well as an API to \
                    create KDED modules.
    set kf5.framework \
                    kdbusaddons
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdbusaddons-add-qspxdg.diff
    }
}

subport kf5-kdnssd {
    description     Network service discovery using Zeroconf
    long_description \
                    KDNSSD is a library for handling the DNS-based Service Discovery Protocol \
                    (DNS-SD), the layer of Zeroconf(TM) that allows network \
                    services, such as printers, to be discovered without any user intervention or \
                    centralised infrastructure.
    set kf5.framework \
                    kdnssd
    kf5.set_checksums
    platform darwin {
        # Avahi is required but apparently only at runtime
        depends_run-append \
                    port:avahi
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kguiaddons {
    description     Utilities for graphical user interfaces
    long_description \
                    The KDE GUI addons provide utilities for graphical user interfaces in the areas \
                    of colours, fonts, text, images, keyboard input.
    set kf5.framework \
                    kguiaddons
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        # this is a probable case of currently unneeded QSP patch activation
        patchfiles-append \
                    patch-kguiaddons-add-qspxdg.diff
    }
}

subport kf5-ki18n {
    description     KDE Gettext-based UI text internationalisation
    long_description \
        KI18n provides functionality for internationalising user interface text \
        in applications, based on the GNU Gettext translation system. \
        It wraps the standard Gettext functionality, so that the programmers \
        and translators can use the familiar Gettext tools and workflows. \
        KI18n provides additional functionality as well, for both programmers \
        and translators, which can help to achieve a higher overall quality \
        of source and translated text. This includes argument capturing, \
        customisable markup, and translation scripting.
    set kf5.framework \
                    ki18n
    kf5.set_checksums
    kf5.has_translations
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-ki18n-add-qspxdg.diff
    }
}

subport kf5-kidletime {
    description     Reporting of idle time of user and system
    long_description \
                    KIdleTime is a singleton reporting information on idle time. It is useful not \
                    only for finding out about the current idle time of the host, but also for getting \
                    notified upon idle time events, such as custom timeouts, or user activity.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kidletime
    kf5.set_checksums
    patchfiles-append \
                    patch-kidletime-use-iokit.diff \
                    patch-kidletime-xsync.diff
    if {[variant_isset docs]} {
        patchfiles-append \
                    patch-kidletime-documentation.diff
    }
    # RJVB: kidletime currently seems to use a Carbon-based poller ; check if I haven't already implemented
    # something more native for KDE4.
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kimageformats {
    description     Plugins to allow QImage to support extra file formats.
    long_description \
                    This framework provides additional image format plugins for QtGui. \
                    As such it is not required for the compilation of any other software, \
                    but may be a runtime requirement for Qt-based software to support \
                    certain image formats.
    set kf5.framework \
                    kimageformats
    kf5.set_checksums
    platform darwin {
        depends_lib-append \
                    port:openexr
    }
    if {[variant_isset qspXDG]} {
        # adding the QSP activator to the plugins too for now; should be unnecessary.
        patchfiles-append \
                    patch-kimageformats-add-qspxdg.diff
    }
}

subport kf5-kitemmodels {
    description     Set of item models extending the Qt model-view framework
    long_description \
                    Set of item models extending the Qt model-view framework
    set kf5.framework \
                    kitemmodels
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
    kf5.add_test_library_path \
                    ${build.dir}/autotests/proxymodeltestsuite
}

subport kf5-kitemviews {
    description     Set of item views extending the Qt model-view framework
    long_description \
                    KItemViews includes a set of views, which can be used with item models. It \
                    includes views for categorising lists and to add search filters to flat and \
                    hierarchical lists.
    set kf5.framework \
                    kitemviews
    kf5.set_checksums
}

subport kf5-kplotting {
    description     A lightweight plotting framework
    long_description \
                    KPlotWidget is a QWidget-derived class that provides a virtual base class \
                    for easy data-plotting. The idea behind KPlotWidget is that you only have \
                    to specify information in \"data units\"\; i.e., the natural units of the \
                    data being plotted.  KPlotWidget automatically converts everything \
                    to screen pixel units.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kplotting
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kplotting-add-qspxdg.diff
    }
}

subport kf5-kwidgetsaddons {
    description     A large set of desktop widgets
    long_description \
                    This repository contains add-on widgets and classes for applications \
                    that use the Qt Widgets module. If you are porting applications from \
                    KDE Platform 4 "kdeui" library, you will find many of its classes here. \
                    Provided are action classes that can be added to toolbars or menus, \
                    a wide range of widgets for selecting characters, fonts, colours, \
                    actions, dates and times, or MIME types, as well as platform-aware \
                    dialogs for configuration pages, message boxes, and password requests. \
                    Further widgets and classes can be found in other KDE frameworks.
    set kf5.framework \
                    kwidgetsaddons
    kf5.set_checksums
    platform darwin {
        # submit upstream
        patchfiles-append \
                    patch-kwidgaddons-restrict-WId-usage.diff
    }
    patchfiles-append \
                    patch-kwidgaddons-preserve-window-icon.diff
    # slimmed-down version committed in 0ea74ebc5ce3e4adcad37b9bb9096988d438848f:
    # patch-kwidgaddons-kselaction-dtor.diff appeared in 5.19.0 .
}

subport kf5-kwindowsystem {
    description     Access to the windowing system
    long_description \
                    Convenience access to certain properties and features of the windowing system. \
                    KWindowSystem provides information about the windowing system and allows interaction with \
                    the windowing system. It provides a high level API which is windowing system independent and \
                    has platform specific implementations. This API is inspired by X11 and thus not all functionality \
                    is available on all windowing systems. On Mac OS X, X11 support is not included though that \
                    would be possible theoretically.
    conflicts-append \
                    kf5-kwindowsystem-devel
    set kf5.framework \
                    kwindowsystem
    kf5.set_checksums
    platform darwin {
        test.cmd    echo
        test.target no tests for this framework
    }
    platform darwin {
        # submit upstream after porting all KWindowSystem adaptations for OS X from KDE4
        pre-patch {
            file delete \
                    ${worksrcpath}/src/platforms/osx/kwindowinfo.cpp \
                    ${worksrcpath}/src/platforms/osx/kwindowinfo_mac_p.h
        }
        patchfiles-append \
                    kwindowsystem/patch-kwinsys-osx-plugin.diff
    }
}

subport kf5-kwindowsystem-devel {
    description     Access to the windowing system
    long_description \
                    Convenience access to certain properties and features of the windowing system. \
                    KWindowSystem provides information about the windowing system and allows interaction with \
                    the windowing system. It provides a high level API which is windowing system independent and \
                    has platform specific implementations. This API is inspired by X11 and thus not all functionality \
                    is available on all windowing systems. On Mac OS X, X11 support is not included though that \
                    would be possible theoretically.
    conflicts-append \
                    kf5-kwindowsystem
    set kf5.framework \
                    kwindowsystem
    fetch.type      git
#     git.branch      cb4d98484abd13989d1d95b9df1fb06c8580503f
    git.branch      ec805f2775a5ff0049272bd4f6bbbad7aa86e3b1
    version         ${version}.4.100.0.142
    platform darwin {
        test.cmd    echo
        test.target no tests for this framework
    }
    platform darwin {
        # submit upstream after porting all KWindowSystem adaptations for OS X from KDE4
        pre-patch {
            file delete \
                    ${worksrcpath}/src/platforms/osx/kwindowinfo.cpp \
                    ${worksrcpath}/src/platforms/osx/kwindowinfo_mac_p.h
        }
        patchfiles-append \
                    kwindowsystem/patch-kwinsys-osx-plugin.diff
    }
}

subport kf5-solid {
    description     Desktop hardware abstraction
    long_description \
                    Solid is a device integration framework.  It provides a way of querying and \
                    interacting with hardware independently of the underlying operating system.
    set kf5.framework \
                    solid
    kf5.set_checksums
    if {${os.platform} eq "darwin"} {
        depends_build-append \
                    port:flex \
                    port:bison
    } else {
        # apparently not needed after all:
        #            patch-solid-findudev.diff
        patchfiles-append \
                    patch-solid-xdgdatadirs.diff
        post-patch {
            reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/cmake/FindMediaPlayerInfo.cmake
        }
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-solid-add-qspxdg.diff
    }
    configure.args-append \
                    -DWITH_NEW_SOLID_JOB=ON
}

subport kf5-sonnet {
    description     Multi-language spell checker
    long_description \
                    Sonnet is a plugin-based spell checking library for Qt-based \
                    applications. It supports several different plugins, including \
                    HSpell, Enchant, ASpell and HUNSPELL. \
                    It also supports automated language detection, based on a \
                    combination of different algorithms.
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    sonnet
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-sonnet-add-qspxdg.diff
    }
    platform darwin {
        # this patch should be submitted upstream
        patchfiles-append \
                    patch-sonnet-use-qsettings-iniformat.diff
        # backend variants. Don't attempt to deactivate non-selected backends for now.
        variant aspell description {build the aspell backend} {
            depends_lib-append \
                    port:aspell
        }
        variant hunspell description {build the hunspell backend} {
            depends_lib-append \
                    port:hunspell
        }
        default_variants-append \
                    +aspell
    }
}

subport kf5-threadweaver {
    description     threadweaver
    long_description \
                    threadweaver
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    threadweaver
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-CMakeLists-add-qt5qspxdg-nomodule.diff
    }
    post-patch {
        reinplace "s|/usr/|${prefix}/|g" ${worksrcpath}/examples/ThumbNailer/Benchmark.cpp
    }
}

### === Tier 2 ===

subport kf5-kauth {
    description     Execute actions as privileged user
    long_description \
                    KAuth provides a convenient, system-integrated way to offload actions that need \
                    to be performed as a privileged user (root, for example) to small (hopefully \
                    secure) helper utilities.
    set kf5.framework \
                    kauth
    kf5.set_checksums
    if {[variant_isset qspXDG]} {
        # there is no need to add the activator to desktoptojson, at the moment
        patchfiles-append \
                    patch-kauth-add-qspxdg.diff
    }
    patchfiles-append \
                    patch-kauth-nongui-policy-gen.diff
    kf5.depends_frameworks \
                    kcoreaddons
    # on linux, PolkitQt5-1 or PolkitQt-1 is required
    platform linux {
        depends_lib-append \
                    port:polkit-qt5
    }
}

subport kf5-kcompletion {
    description     Powerful completion framework, including completion-enabled lineedit and combobox.
    long_description \
                    When typing filenames, email addresses and other text where the user often wants \
                    to select from existing data (including what they previously typed) rather than \
                    enter anything wholly original, users often find it helpful if they only need to \
                    type the first few characters, and then have the application offer them a set of \
                    choices or attempt to finish off what they were typing. Email clients, shells \
                    and \"open file\" dialogs often provide this functionality. \
                    This framework helps implement this in Qt-based applications. You can use one of \
                    the completion-ready widgets provided by this framework, or integrate it into \
                    your application's other widgets directly.
    set kf5.framework \
                    kcompletion
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kwidgetsaddons
}

subport kf5-kcrash {
    description     Graceful handling of application crashes
    long_description \
                    KCrash provides support for intercepting and handling application crashes.
    set kf5.framework \
                    kcrash
    kf5.set_checksums
    kf5.depends_frameworks \
                    kcoreaddons kwindowsystem
    platform darwin {
        # submit upstream
        patchfiles-append \
                    patch-kcrash-dont-closeAllFDs.diff \
                    patch-kcrash-no-display.diff
    }
}

subport kf5-kdoctools {
    PortGroup       perl5 1.0
    description     Create documentation from DocBook
    long_description \
                    Provides tools to generate documentation in various format from DocBook files.
    set kf5.framework \
                    kdoctools
    kf5.set_checksums
    kf5.depends_build_frameworks \
                    ki18n
    depends_lib-append \
                    port:libxslt \
                    port:docbook-xml \
                    port:docbook-xsl \
                    port:p${perl5.default_branch}-uri
    kf5.depends_frameworks \
                    karchive
    # not really sure about this one:
    depends_run-append \
                    port:gettext
    if {[variant_isset qspXDG]} {
        # kdoctools builds a *static* library, which may mean we'll have to include the activator
        # as source if it turns out that that library is used as the only KF5 framework.
        patchfiles-append \
                    patch-kdoctools-add-qspxdg.diff
    }
# this patch is unnecessary if the kdelibs4 headers are moved out of the ${prefix}/include root
#     if {${os.platform} eq "darwin"} {
#         # workaround what appears to be a bug in the kdoctools buildsystem that
#         # causes it to pick up KDE4 headerfiles when they're present:
#         patchfiles-append \
#                     patch-kdoctools-xslt_kde.cpp.diff
#     }
    configure.args-append \
                        -DDOCBOOKXSL_DIR=${prefix}/share/xsl/docbook-xsl \
                        -DLIBXML2_INCLUDE_DIR=${prefix}/include/libxml2 \
                        -DLIBXML2_LIBRARIES=${prefix}/lib/libxml2.${kf5.libs_ext} \
                        -DLIBXML2_XMLLINT_EXECUTABLE=${prefix}/bin/xmllint \
                        -DLIBXSLT_INCLUDE_DIR=${prefix}/include \
                        -DLIBXSLT_LIBRARIES=${prefix}/lib/libxslt.${kf5.libs_ext}
}

subport kf5-kfilemetadata {
    description     A file metadata and text extraction library
    long_description \
                    KFileMetaData provides a simple library for extracting the text and metadata \
                    from a number of different files. This library is typically used by file \
                    indexers to retreive the metadata.
    set kf5.framework \
                    kfilemetadata
    kf5.set_checksums
    depends_lib-append \
                    port:exiv2
    kf5.depends_frameworks \
                    karchive ki18n
    platform darwin {
        depends_lib-append \
                    port:poppler-qt5-mac \
                    port:taglib \
                    path:lib/libavcodec.dylib:ffmpeg \
                    port:ebook-tools
    }
    # report upstream?
    patchfiles-append \
                    patch-kfilemdata-compversion5.diff
    variant kde4compat description {allow installation alongside KDE4's port:kfilemetadata} {
        # note: it might be useful to provide a complementary variant to port:kfilemetadata
        post-destroot {
            file delete -force ${destroot}${prefix}/share/locale
        }
    }
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kfilemetadata
    }
    post-destroot {
        # kfilemetadata "stock" has the weird idea to set the compatibility/so version to 3 ...
        if {${os.platform} eq "darwin"} {
            ln -s libKF5FileMetaData.5.dylib ${destroot}${prefix}/lib/libKF5FileMetaData.3.dylib
        } else {
            ln -s libKF5FileMetaData.so.5 ${destroot}${prefix}/lib/${os.arch}-linux-gnu/libKF5FileMetaData.so.3
        }
    }
}

subport kf5-kjobwidgets {
    description     Widgets for showing progress of asynchronous jobs
    long_description \
                    KJobWIdgets provides widgets for showing progress of asynchronous jobs.
    set kf5.framework \
                    kjobwidgets
    kf5.set_checksums
    kf5.depends_frameworks \
                    kcoreaddons kwidgetsaddons
    patchfiles-append \
                    patch-kjobwidgets-preserve-window-icon.diff
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-knotifications {
    description     Desktop notifications
    long_description \
                    KNotification is used to notify the user of an event. It covers feedback and \
                    persistent events.
    set kf5.framework \
                    knotifications
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcodecs \
                    kcoreaddons kwindowsystem
    depends_lib-append \
                    port:phonon-qt5 \
                    port:dbusmenu-qt5
    platform darwin {
        # ignore KDE_FULL_SESSION if it's set
        patchfiles-append \
                    knotifications/patch-knotifications-ignore-full_session-envvar.diff
    }
    # provide names for the sound file and notifyrc warnings (and make a simple beep):
    patchfiles-append \
                    knotifications/patch-knotifications-better-sound-warning.diff
    # https://git.reviewboard.kde.org/r/126369/
    patchfiles-append \
                    knotifications/patch-knotifications-OSX-adaptations.diff
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kpackage {
    description     Installation and loading of additional content \(ex: scripts, images...\) as packages
    long_description \
                    The Package framework lets the user install and load packages of non binary content \
                    such as scripted extensions or graphic assets, as if they were traditional plugins.
    set kf5.framework \
                    kpackage
    kf5.set_checksums
    kf5.depends_frameworks \
                    karchive kconfig kcoreaddons ki18n
    platform darwin {
        patchfiles-append \
                    patch-kpackage-add-qspxdg.diff
    }
    # this one ought to be reported upstream:
    patchfiles-append \
                    patch-kpackage-autotests+tool-nogui.diff \
                    patch-kpackage-doctools-accept-older-version.diff
}

subport kf5-kpty {
    description     Interfacing with pseudo terminal devices
    long_description \
                    This library provides primitives to interface with pseudo terminal devices \
                    as well as a KProcess derived class for running child processes and \
                    communicating with them using a pty.
    set kf5.framework \
                    kpty
    kf5.set_checksums
    kf5.depends_frameworks \
                    kcoreaddons ki18n
}

subport kf5-kunitconversion {
    description     Converting physical units
    long_description \
                    KUnitConversion provides functions to convert values in different physical \
                    units. It supports converting different prefixes (e.g. kilo, mega, giga) as \
                    well as converting between different unit systems (e.g. liters, gallons).
    set kf5.framework \
                    kunitconversion
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig ki18n
}

### === Tier 3 ===

subport kf5-baloo {
    description     File searching and indexing
    long_description \
                    Baloo provides file searching and indexing. It does so by maintaining an index \
                    of the contents of your files. It isn't functional on Mac OS X and present only \
                    to be able to satisfy dependencies.
    set kf5.framework \
                    baloo
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons \
                    kfilemetadata ki18n kidletime kio \
                    solid
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-baloo-add-qspxdb.diff
    }
    platform darwin {
        depends_lib-append \
                    port:lmdb
        patchfiles-append \
                    patch-baloo-nongui-execs.diff
        post-destroot {
            # delete a file that isn't supposed to be used, and conflicts with KDE4's baloo:
            if {[file exists ${destroot}${prefix}/share/dbus-1/interfaces/org.kde.baloo.file.indexer.xml]} {
                file delete ${destroot}${prefix}/share/dbus-1/interfaces/org.kde.baloo.file.indexer.xml
            }
            foreach ld [glob -nocomplain ${destroot}${prefix}/share/locale/*/LC_MESSAGES] {
                foreach mo {baloo_file.mo baloo_file_extractor.mo baloosearch.mo balooshow.mo \
                        kio_baloosearch.mo kio_tags.mo kio_timeline.mo} {
                    if {[file exists ${ld}/${mo}]} {
                        file delete ${ld}/${mo}
                    }
                }
            }
            # rename a conflicting icon file (since baloo/Mac is supposed to be non-functional anyway)
            file rename ${destroot}${prefix}/share/icons/hicolor/128x128/apps/baloo.png \
                        ${destroot}${prefix}/share/icons/hicolor/128x128/apps/baloo5.png
        }
        test.cmd        echo
        test.target     no tests on OS X for this framework
    }
}

subport kf5-kactivities {
    description     Core components for the KDE Activity concept
    long_description \
                    When a user is interacting with a computer, there are three main areas of \
                    contextual information that may affect the behaviour of the system: who the user \
                    is, where s/he is, and what s/he is doing. \
                    *Activities* deal with the last one. An activity might be \"developing a KDE \
                    application\", \"studying 19th century art\", \"composing music\" or \"watching funny \
                    videos\". Each of these activites may involve multiple applications, and a single \
                    application may be used in multiple activities (for example, most activities are \
                    likely to involve using a web browser, but different activities will probably \
                    involve different websites). \
                    KActivities provides the infrastructure needed to manage users' activites, \
                    allowing them to switch between tasks, and for applications to update their \
                    state to match the user's current activity. This includes a daemon, a library \
                    for interacting with that daemon, and plugins for integration with other \
                    frameworks.
    set kf5.framework \
                    kactivities
    kf5.set_checksums
    platform darwin {
        depends_lib-append \
                    port:boost
    }
    kf5.depends_frameworks \
                    kbookmarks kcmutils kconfig kconfigwidgets \
                    kcoreaddons kdbusaddons kdeclarative \
                    kglobalaccel ki18n kio kpackage kservice \
                    kwidgetsaddons kwindowsystem kxmlgui
    variant kde4compat description {allow installation alongside KDE4's port:kactivities} {
        # note: it might be useful to provide a complementary variant to port:kactivities
        post-destroot {
            # we'll presume that KDE ports use the CMake files, not pkgconfig
            file delete -force ${destroot}${prefix}/lib/pkgconfig/libKActivities.pc
        }
    }
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kactivities
    }
    if {[variant_isset qspXDG]} {
        pre-patch {
            reinplace "s|\\(find_package (Qt5 \[\^\)\]\*\\))|\\1 QspXDG)|g" ${worksrcpath}/CMakeLists.txt
        }
        patchfiles-append \
                    patch-kactivities-add-qspxdg.diff
        # submit this one upstream (and monitor if the procedure used suffices to stay
        # out of the Dock and AppSwitcher!)
        patchfiles-append \
                    patch-kactivities-nongui-kactivd.diff
    }
    test.cmd        echo
    test.target     no tests on OS X for this framework
}

subport kf5-kbookmarks {
    description     Bookmarks management library
    long_description \
                    KBookmarks lets you access and manipulate bookmarks stored using the \
                    XBEL format (http://pyxml.sourceforge.net/topics/xbel)
    set kf5.framework \
                    kbookmarks
    kf5.set_checksums
    kf5.depends_frameworks \
                    kcodecs kconfigwidgets kcoreaddons \
                    kiconthemes kwidgetsaddons kxmlgui
}

subport kf5-kcmutils {
    description     Utilities for KDE System Settings modules
    long_description \
                    KCMUtils provides various classes to work with KCModules. KCModules can be \
                    created with the KConfigWidgets framework.
    set kf5.framework \
                    kcmutils
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfigwidgets kcoreaddons kdeclarative ki18n \
                    kiconthemes kitemviews kservice kxmlgui kpackage
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kconfigwidgets {
    description     Widgets for configuration dialogs
    long_description \
                    KConfigWidgets provides easy-to-use classes to create configuration dialogs, as \
                    well as a set of widgets which uses KConfig to store their settings.
    set kf5.framework \
                    kconfigwidgets
    kf5.set_checksums
    kf5.depends_frameworks \
                    kauth kconfig kcodecs kcoreaddons \
                    kdoctools kguiaddons ki18n kwidgetsaddons
    # test and submit upstream
    patchfiles-append \
                    patch-kconfigwidgets-kstdactions-menurole.diff
}

subport kf5-kdeclarative {
    description     Integration of QML and KDE work spaces
    long_description \
                    KDeclarative provides integration of QML and KDE work spaces. \
                    It's comprises two parts: a library used by the C++ part of your application \
                    to intergrate QML with KDE Frameworks specific features, and a series of \
                    QML imports that offer bindings to some of the KDE Frameworks.
    set kf5.framework \
                    kdeclarative
    kf5.set_checksums
    kf5.depends_frameworks \
                    kpackage kconfig kio \
                    kiconthemes ki18n
    platform darwin {
        depends_lib-append \
                    port:libepoxy
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdeclarative-add-qspxdb.diff
    }
    patchfiles-append \
                    patch-kdeclarative-nongui.diff
}

subport kf5-kded {
    description     Central daemon of KDE work spaces
    long_description \
                    KDED is the KDE Daemon which runs in the background and performs \
                    a number of small tasks. \
                    Some of these tasks are built in, others are started on demand.
    set kf5.framework \
                    kded
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash \
                    kdbusaddons kdoctools kinit kservice
    # test and propose upstream:
    # https://git.reviewboard.kde.org/r/126170/
    patchfiles-append \
                    patch-kded-nongui-kded.diff
    platform darwin {
        # ignore KDE_FULL_SESSION if it's set
        patchfiles-append \
                        patch-kded-ignore-full_session-envvar.diff
        post-destroot {
            xinstall -d -m 755 ${destroot}${prefix}/Library/LaunchAgents
            xinstall -m 644 ${filespath}/org.macports.kded5.plist \
                ${destroot}${prefix}/Library/LaunchAgents
            reinplace "s|%PREFIX%|${prefix}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kded5.plist
            if { ${startupitem.install} != "no" } {
                xinstall -d -m 755 ${destroot}${startup_root}/Library/LaunchAgents
                ln -s ${prefix}/Library/LaunchAgents/org.macports.kded5.plist ${destroot}${startup_root}/Library/LaunchAgents
            }
        }
        notes-append    "You can opt to let the KDE daemon, kded5, be started automatically at login. \
        To do this, use the following command (once): \
         launchctl load -w ${startup_root}/Library/LaunchAgents/org.macports.kded5.plist"
    }
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kdesignerplugin {
    description     Integrating KDE frameworks widgets with Qt Designer
    long_description \
                    This framework provides plugins for Qt Designer that allow it to display \
                    the widgets provided by various KDE frameworks, as well as a utility \
                    (kgendesignerplugin) that can be used to generate other such plugins \
                    from ini-style description files.
    set kf5.framework \
                    kdesignerplugin
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcoreaddons kdewebkit kdoctools ki18n
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdesignerplugin-add-qspxdb.diff
    }
#     test.cmd        echo
#     test.target     no tests for this framework
}

subport kf5-kdesu {
    description     User interface for running shell commands with root privileges
    long_description \
                    kf5-kdesu provides functionality for building GUI front ends for \
                    (password asking) console mode programs. For example, kdesu and \
                    kdessh use it to interface with su and ssh respectively.
    set kf5.framework \
                    kdesu
    kf5.set_checksums
    kf5.depends_frameworks \
                    kcoreaddons ki18n kpty kservice
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kdesu-add-qspxdg.diff
    }
}

subport kf5-kdewebkit {
    description     Integration of the HTML rendering engine WebKit
    long_description \
                    This library provides KDE integration of the QtWebKit library.
    set kf5.framework \
                    kdewebkit
    kf5.set_checksums
    # KDEWebKit doesn't declare an explicit dependency on KI18n but lets cmake pull it in through
    # automatically. We add it here so we don't have to add explicit depends_build on gettext and python.
    kf5.depends_frameworks \
                    kconfig kcoreaddons ki18n kio \
                    kjobwidgets kparts kservice kwallet
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kemoticons {
    description     Convert text emoticons to graphical emoticons
    long_description \
                    KEmoticons converts emoticons from text to a graphical representation with \
                    images in HTML. It supports setting different themes for emoticons coming \
                    from different providers.
    set kf5.framework \
                    kemoticons
    kf5.set_checksums
    kf5.depends_frameworks \
                    karchive kconfig kservice kcoreaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kemoticons-add-qspxdg.diff
    }
}

subport kf5-kglobalaccel {
    description     Global desktop keyboard shortcuts
    long_description \
                    KGlobalAccel allows you to have global accelerators that are independent of \
                    the focused window.  Unlike regular shortcuts, the application's window does not \
                    need focus for them to be activated. \
                    This framework is present only for dependency purposes: it is currently not operational on OS X.
    set kf5.framework \
                    kglobalaccel
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons ki18n
    patchfiles-append \
                    patch-kglobalaccel-agent-and-nogui.diff
}

subport kf5-kiconthemes {
    description     Icon GUI utilities
    long_description \
                    This library contains classes to improve the handling of icons \
                    in applications using the KDE Frameworks.
    set kf5.framework \
                    kiconthemes
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfigwidgets ki18n kitemviews kwidgetsaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kiconthemes-add-qspxdg.diff
    }
}

subport kf5-kinit {
    description     Helper library to speed up start of applications on KDE workspaces
    long_description \
                    kdeinit is a process launcher somewhat similar to the famous init used for \
                    booting UNIX. It launches processes by forking and then loading a dynamic \
                    library which should contain a 'kdemain(...)' function. Using kdeinit to \
                    launch KDE applications makes starting a typical KDE applications about 2.5 \
                    times faster. It also reduces memory consumption per application.
    set kf5.framework \
                    kinit
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcrash kdoctools ki18n \
                    kio kservice kwindowsystem
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kinit-add-qspxdg.diff
    }
    post-patch {
        reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/klauncher/klauncher_main.cpp
    }
    # test and propose upstream:
    # https://git.reviewboard.kde.org/r/126161/
    patchfiles-append \
                    patch-kinit-nonguis-andavoid-kdeinit-crash.diff
    # submit upstream too
    patchfiles-append \
                    patch-kinit-klauncher-foreground.diff
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kio {
    description     Network transparent access to files and data
    long_description \
                    This framework implements almost all the file management functions you \
                    will ever need. It supports accessing files locally as well as via HTTP \
                    and FTP out of the box and can be extended by plugins to support other \
                    protocols as well.
    set kf5.framework \
                    kio
    kf5.set_checksums
    depends_lib-append \
                    port:libxslt \
                    port:libxml2 \
                    port:zlib
    platform darwin {
        depends_lib-append \
                    port:kerberos5
#         # this should probably be a regular patch ... and do we actually
#         # want to replace xdg-open?
#         post-patch {
#             reinplace "s|xdg-open|open|g" ${worksrcpath}/src/widgets/krun.cpp
#         }
#
#         # We may want to change the smb.conf location list in src/core/ksambashare.cpp
    }
    post-patch {
        # get the fallback smbd from MacPorts:
        reinplace "s|/usr/local/sbin/smbd|${prefix}/sbin/smbd|g" ${worksrcpath}/src/core/ksambashare.cpp
    }
    kf5.depends_frameworks \
                    karchive kbookmarks kcompletion kconfigwidgets \
                    kcoreaddons kcrash kdbusaddons kdoctools \
                    kguiaddons ki18n kiconthemes kitemviews \
                    kjobwidgets knotifications kservice ktextwidgets \
                    kwallet kwidgetsaddons kwindowsystem kxmlgui solid
    if {[variant_isset qspXDG]} {
        patchfiles-append \
            patch-kio-add-qspxdg.diff
    }
    # submit upstream:
    patchfiles-append \
                    patch-kio-nongui-kiod-and-agent.diff \
                    patch-kio-nongui-httpcachecl.diff \
                    patch-kio-silence-kioslave.diff
    # https://git.reviewboard.kde.org/r/126125/ :
    # committed in #73d50f44
    patchfiles-append \
                    patch-kio-use-osxtrash.diff
    patchfiles-append \
                    patch-kio-preserve-window-icon.diff
}

subport kf5-knewstuff {
    description     Framework for downloading and sharing additional application data
    long_description \
                    The KNewStuff library implements collaborative data sharing for \
                    applications. It uses kf5-attica to support the Open Collaboration Services \
                    specification.
    set kf5.framework \
                    knewstuff
    kf5.set_checksums
    kf5.depends_frameworks \
                    attica karchive kcompletion kconfig \
                    kcoreaddons ki18n kiconthemes kio \
                    kitemviews kservice ktextwidgets \
                    kwidgetsaddons kxmlgui
    # this one should probably be submitted upstream
    patchfiles-append \
                    patch-knewstuff-autotests.diff
}

subport kf5-knotifyconfig {
    description     Configuration dialog for desktop notifications
    long_description \
                    KNotifyConfig provides a configuration dialog for desktop notifications which \
                    can be embedded in your application.
    set kf5.framework \
                    knotifyconfig
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfigwidgets ki18n kio \
                    knotifications kwidgetsaddons kxmlgui
    test.cmd        echo
    test.target     no tests for this framework
}

subport kf5-kparts {
    description     Plugin framework for user interface components
    long_description \
                    KParts implements the framework for KDE parts, which are \
                    elaborate widgets with a user-interface defined in terms of actions \
                    (menu items, toolbar icons).
    set kf5.framework \
                    kparts
    kf5.set_checksums
    # KParts depends on ki18n despite not declaring it explicitly
    kf5.depends_frameworks \
                    ki18n kio knotifications \
                    ktextwidgets kxmlgui
}

subport kf5-kpeople {
    description     kpeople
    long_description \
                    kpeople
    variant examples description {install any examples provided} {}
    set kf5.framework \
                    kpeople
    kf5.set_checksums
    # NB: kpeople can use Akonadi but it is unclear if the CMake files actually search for it.
    kf5.depends_frameworks \
                    kcoreaddons ki18n kitemviews \
                    kservice kwidgetsaddons
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kpeople-add-qspxdg.diff
    }
}

# the plasma framework can depend on akonadi and kdepimlibs!
# on OS X versions lacking OpenGL ES it can also use the emulator from
# http://malideveloper.arm.com/downloads/OpenGL_ES_Emulator_1.3.2.0699222_MacOSX.tgz
subport kf5-plasma-framework {
    description     Foundational libraries, components, and tools of the Plasma workspaces
    long_description \
                    ${description}. The plasma framework provides \
                    QML components\; \
                    A C++ library: libplasma \
                    and Script engines.
    variant examples description {install any examples provided} {
        configure.args-append \
                    -DBUILD_EXAMPLES=ON
    }
    set kf5.framework \
                    plasma-framework
    kf5.set_checksums
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kactivities karchive kconfig kconfigwidgets \
                    kcoreaddons kdbusaddons kdeclarative kdoctools \
                    kglobalaccel kguiaddons ki18n kiconthemes kio kservice \
                    kwindowsystem kxmlgui knotifications kpackage \

    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-plasmafw-add-qspxdg.diff
    }
    # submit this one upstream
    patchfiles-append \
                    patch-plasmafw-autotests.diff
    # https://bugs.kde.org/show_bug.cgi?id=359026
    patchfiles-append \
                    patch-plasmafw-corona-null.diff
    post-patch {
        reinplace "s|/usr/share/inkscape|${prefix}/share/inkscape|g" "${worksrcpath}/src/tools/inkscape extensions/plasmarename.py"
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${worksrcpath}/src/tools/currentColorFillFix.sh
    }
}

subport kf5-kservice {
    description     Plugin framework for desktop services
    long_description \
                    KService provides a plugin framework for handling desktop services. Services can \
                    be applications or libraries. They can be bound to MIME types or handled by \
                    application specific code.
    set kf5.framework \
                    kservice
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcoreaddons kcrash kdbusaddons kdoctools ki18n
    patchfiles-append \
                    patch-kservice-xdg-menu-prefix.diff \
                    patch-kservice-fix-invokeBrowser.diff
    post-patch {
        reinplace "s|@APPMENUPREFIX@|kf5-|g" ${worksrcpath}/src/sycoca/vfolder_menu.cpp
    }
    configure.args-append \
                    -DAPPLICATIONS_MENU_NAME=kf5-applications.menu
    platform darwin {
        post-destroot {
            xinstall -d -m 755 ${destroot}${prefix}/Library/LaunchAgents
            xinstall -m 644 ${filespath}/org.macports.kdecache5.plist \
                ${destroot}${prefix}/Library/LaunchAgents
            reinplace "s|%PREFIX%|${prefix}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kdecache5.plist
            reinplace "s|%APPLICATIONS_DIR%|${applications_dir}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kdecache5.plist
            if { ${startupitem.install} != "no" } {
                xinstall -d -m 755 ${destroot}${startup_root}/Library/LaunchAgents
                ln -s ${prefix}/Library/LaunchAgents/org.macports.kdecache5.plist ${destroot}${startup_root}/Library/LaunchAgents
            }
        }
        notes-append    "An agent can be started to maintain KDE's desktop file system configuration cache, \
        to avoid having to run 'kbuildsycoca5' manually. \
        To start it run the following command: \
         launchctl load -w ${startup_root}/Library/LaunchAgents/org.macports.kdecache5.plist"
    }
    # the autotests from this port  cleaned out a number of directories under /Applications for me.
    # Shouldn't happen anymore with Qt's QSP switched to XDG mode (+qspXDG variant), but since that's
    # not a compulsory mode we disallow running the tests.
    test.run        no
}

subport kf5-ktexteditor {
    description     Full text editor component
    long_description \
                    KTextEditor provides a powerful text editor component that you can embed in your \
                    application, either as a KPart or using the KF5::TextEditor library (if you need \
                    more control). \
                    The text editor component contains many useful features, from syntax \
                    highlighting and automatic indentation to advanced scripting support, making it \
                    suitable for everything from a simple embedded text-file editor to an advanced \
                    IDE.
    set kf5.framework \
                    ktexteditor
    kf5.set_checksums
    depends_build-append \
                    path:bin/perl5:perl5
    depends_lib-append \
                    port:libgit2
    kf5.depends_frameworks \
                    karchive kconfig kguiaddons \
                    ki18n kiconthemes kio kparts \
                    sonnet
    platform darwin {
        variant full description {activate features that are not currently supported fully on OS X} {}
        # this patch should be submitted upstream; cf. the corresponding sonnet patch
        patchfiles-append \
                    patch-ktexteditor-use-qsettings-iniformat.diff
        if {![variant_isset full]} {
            # *not* the +full version; disable certain features
            patchfiles-append \
                    patch-ktexteditor-disable-offending-menus.diff
        }
        # the alternative to disabling the 2 offending menus from the so-called patch
        # is to prune them from the context menu, so they only appear in the main menubar.
        # Except that apparently this doesn't work.
        patchfiles-append \
                    patch-ktexteditor-prune-katepart-context-menu.diff
    }
}

subport kf5-ktextwidgets {
    description     Text editing widgets
    long_description \
                    KTextWidgets provides widgets for displaying and editing text. It supports \
                    rich text as well as plain text.
    set kf5.framework \
                    ktextwidgets
    kf5.set_checksums
    kf5.depends_frameworks \
                    kcompletion kconfig kconfigwidgets ki18n \
                    kiconthemes kservice sonnet kwidgetsaddons \
                    kwindowsystem
    patchfiles-append \
                    patch-ktextwidgets-preserve-window-icon.diff
}

subport kf5-kwallet {
    description     Safe desktop-wide storage for passwords
    long_description \
                    This framework contains two main components: \
                    1: Interface to KWallet, the safe desktop-wide storage for passwords on KDE work \
                    spaces. \
                    2: The kwalletd used to safely store the passwords on KDE work spaces (when not using the OS X Keychain)
# not functional yet!
#     if {${os.platform} eq "darwin"} {
#         variant osxkeychain description {kwallet uses the OSX KeyChain} {
#             configure.args-append \
#                     -DMAC_USE_OSXKEYCHAIN:BOOL=ON
#         }
#     }
    set kf5.framework \
                    kwallet
    kf5.set_checksums
    kf5.depends_frameworks \
                    gpgmepp kconfig kcoreaddons kdbusaddons ki18n \
                    kiconthemes knotifications kservice kwidgetsaddons \
                    kwindowsystem
    platform darwin {
        depends_lib-append \
                port:gpgme \
                port:libgcrypt
        depends_run-append \
                port:gpg-agent
        if {${os.major} >= 12} {
            depends_run-append \
                port:pinentry-mac
            notes-append "port:pinentry-mac has been installed so that kwalletd5 can request GPG passphrases. \
            You may need to verify your ~/.gnupg/gpg-agent.conf settings."
        } else {
            notes-append "If you do not already have a pinentry application, you will need to install one so that \
            kwalletd5 can request GPG passphrases. Use either a suitable variant from port:pinentry, or install \
            the MacGPG2 tools (https://gpgtools.org/)."
        }
    }
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    kwallet/patch-kwallet-add-qspxdg.diff
    }
    patchfiles-append \
                    kwallet/patch-kwallet-nongui-runtimes.diff \
                    kwallet/patch-kwallet-kwalletd-is-agent.diff \
                    kwallet/patch-kwallet-cmake-keychain-or-kwalletd.diff
    if {![variant_exists osxkeychain] || ![variant_isset osxkeychain]} {
        patchfiles-append \
                    kwallet/patch-kwallet-kwalletd-makeforeground.diff
        post-destroot {
            xinstall -d -m 755 ${destroot}${prefix}/Library/LaunchAgents
            xinstall -m 644 ${filespath}/kwallet/org.macports.kwalletd5.plist \
                ${destroot}${prefix}/Library/LaunchAgents
            reinplace "s|%PREFIX%|${prefix}|g" \
                ${destroot}${prefix}/Library/LaunchAgents/org.macports.kwalletd5.plist
            if {[file exists ${destroot}${kf5.applications_dir}/kwalletd5.app]} {
                xinstall -m 755 -d ${destroot}${kf5.libexec_dir}/kf5
                file rename ${destroot}${kf5.applications_dir}/kwalletd5.app ${destroot}${kf5.libexec_dir}/kf5/kwalletd5.app
                xinstall -m 755 ${filespath}/kwallet/kwalletd5.sh ${destroot}${prefix}/bin/kwalletd5
                reinplace "s|@LIBEXECDIR@|${kf5.libexec_dir}/kf5|g" ${destroot}${prefix}/bin/kwalletd5
            }
            if { ${startupitem.install} != "no" } {
                xinstall -d -m 755 ${destroot}${startup_root}/Library/LaunchAgents
                ln -s ${prefix}/Library/LaunchAgents/org.macports.kwalletd5.plist ${destroot}${startup_root}/Library/LaunchAgents
            }
        }
        platform darwin {
            notes-append    "The KDE Wallet daemon, kwalletd5, has to be started, and not on-demand by KDE itself. \
            This works best when done manually from a terminal (or a .cshrc/.profile/.bashrc script). \
            To do it automatically at login, use the following command (once): \
             launchctl load -w ${startup_root}/Library/LaunchAgents/org.macports.kwalletd5.plist"
        }
     }
}

subport kf5-kxmlgui {
    description     Framework for managing menu and toolbar actions
    long_description \
                    KXMLGUI provides a framework for managing menu and toolbar actions in an \
                    abstract way. The actions are configured through a XML description and hooks \
                    in the application code. The framework supports merging of multiple \
                    description for example for integrating actions from plugins.
    set kf5.framework \
                    kxmlgui
    kf5.set_checksums
    kf5.depends_frameworks \
                    attica kconfig kconfigwidgets kglobalaccel \
                    ki18n kiconthemes kitemviews ktextwidgets \
                    kwidgetsaddons kwindowsystem
    # this patch should be reported upstream
    patchfiles-append \
                    patch-kxmlgui-kmainwindow-event.diff
}

subport kf5-kxmlrpcclient {
    description     XML-RPC client
    long_description \
                    This library contains simple XML-RPC Client support. It is a complete \
                    client and is quite easy to use.
    set kf5.framework \
                    kxmlrpcclient
    kf5.set_checksums
    kf5.depends_frameworks \
                    ki18n kio
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                patch-kxmlrpcclnt-add-qspxdg.diff
    }
}

### === Tier 4 ===

subport kf5-frameworkintegration {
    description     Integration of Qt application with KDE workspaces
    long_description \
                    Framework Integration is a set of plugins responsible for better integration of \
                    Qt applications, among others by improving theming capabilities
    conflicts-append \
                    kf5-frameworkintegration-devel
    set kf5.framework \
                    frameworkintegration
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kconfigwidgets ki18n kiconthemes \
                    kio knotifications kwidgetsaddons
    patchfiles-append \
                    patch-fwintegration-platform-adaptation4.diff
#     post-patch {
#         reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/platformtheme/khintssettings.cpp
#     }
    test.env-append \
                    KDE_SESSION_VERSION=5
    platform darwin {
        notes-append    "frameworkintegration uses Noto Sans (https://www.google.com/get/noto/) and \
                        Oxygen Mono (http://download.kde.org/stable/plasma/5.4.0/oxygen-fonts-5.4.0.tar.xz) \
                        fonts, ensure these are installed for use at runtime. Also, in order to use your selected \
                        KDE theme automatically, you need to use port:qt5-kde and set KDE_SESSION_VERSION to a \
                        value >=4 (launchctl setenv KDE_SESSION_VERSION 5 and equivalent in your login script)."
    }
}

subport kf5-frameworkintegration-devel {
    description     Integration of Qt application with KDE workspaces
    long_description \
                    Framework Integration is a set of plugins responsible for better integration of \
                    Qt applications, among others by improving theming capabilities
    conflicts-append \
                    kf5-frameworkintegration
    set kf5.framework \
                    frameworkintegration
    fetch.type      git
    git.branch      4037bdc0
    version         ${version}.5.0.0.173
    kf5.depends_frameworks \
                    kconfig kconfigwidgets ki18n kiconthemes \
                    kio knotifications kwidgetsaddons
    # autotests need more patching than just being built as nongui (non-app-bundle) executables!
    patchfiles-append \
                    patch-fwintegration-platform-adaptation4.diff
    test.env-append \
                    KDE_SESSION_VERSION=5
    platform darwin {
        notes-append    "frameworkintegration uses Noto Sans (https://www.google.com/get/noto/) and \
                        Oxygen Mono (http://download.kde.org/stable/plasma/5.4.0/oxygen-fonts-5.4.0.tar.xz) \
                        fonts, ensure these are installed for use at runtime. Also, in order to use your selected \
                        KDE theme automatically, you need to use port:qt5-kde and set KDE_SESSION_VERSION to a \
                        value >=4 (launchctl setenv KDE_SESSION_VERSION 5 and equivalent in your login script)."
    }
}

homepage            http://projects.kde.org/projects/${kf5.virtualPath}/${kf5.framework} \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/${kf5.framework}/html/index.html
if {${fetch.type} eq "git"} {
    if {[file exists ${filespath}/${kf5.framework}-git/.git]} {
        git.url     ${filespath}/${kf5.framework}-git
    } else {
        git.url     git://anongit.kde.org/${kf5.framework}
    }
    distname        ${kf5.framework}-5.git
} else {
    master_sites    http://download.kde.org/stable/${kf5.folder}
    distname        ${kf5.framework}-${version}
}

### === Porting Aids ===
### this would probably be better in a separate portdir because despite being frameworks
### they are distributed from a different URL

subport kf5-kdelibs4support {
    description     Legacy support for kdelibs 4 compatibility
    long_description \
                    This framework provides code and utilities to ease the transition from \
                    kdelibs 4 to KDE Frameworks 5. This includes CMake macros and C++ \
                    classes whose functionality has been replaced by code in CMake, Qt and \
                    other frameworks.
    conflicts       kf5-kdelibs4support-devel
    variant kde4compat description {allow installation alongside KDE4's port:kde4-runtime} {}
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kde4-runtime
    }
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    kdelibs4support
    kf5.set_checksums
    depends_build-append \
                    ${kf5.oxygen-icons_dep}
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kbookmarks kcompletion kconfig kconfigwidgets \
                    kcrash kdbusaddons kded ki18n kdesignerplugin \
                    kdoctools kglobalaccel kguiaddons ki18n \
                    kiconthemes kio kitemviews knotifications kparts \
                    kservice ktextwidgets kunitconversion \
                    kwidgetsaddons kwindowsystem kxmlgui
    platform darwin {
        # pretend KDE_FULL_SESSION is set in order to get full support for theming settings
        patchfiles-append \
                    patch-kdelibs4supp-simulate-full_session.diff \
                    patch-kdelibs4supp-add-icon.diff
        post-patch {
            # create the destination directory that will host icon file links:
            xinstall -m 755 -d ${build.dir}/src/kdebugdialog/icons
            # call kf5.link_icons to populate that directory with icon links with appropriate names:
            # ${prefix}/share/icons/oxygen/128x128/actions/tools-report-bug.png will become 128-tools-report-bug.png etc.
            kf5.link_icons ${prefix}/share/icons/oxygen actions tools-report-bug.png ${build.dir}/src/kdebugdialog/icons
        }
    }
    # submit upstream
    patchfiles-append \
                    patch-kdelibs4supp-qosmac=osx.diff \
                    patch-kdelibs4supp-correct-menuroles-kaction.diff \
                    patch-kdelibs4supp-correct-fileshareset-install.diff
    # https://git.reviewboard.kde.org/r/126308
#     patchfiles-append \
#                     patch-kdelibs4supp-kpbutton-noshowicon.diff
    # https://git.reviewboard.kde.org/r/126309/
    patchfiles-append \
                    patch-kdelibs4supp-backtrace-demangle.diff
    patchfiles-append \
                    patch-kdelibs4supp-add-bundle-path.diff \
                    patch-kdelibs4supp-preserve-app-icon.diff
    post-patch {
        reinplace "s|/usr/local/|${prefix}/|g" ${worksrcpath}/src/kssl/kopenssl.cpp
        reinplace "s|/usr/sbin|${prefix}/sbin|g" ${worksrcpath}/src/kio/kfileshare.cpp
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/kdecore/kmimetyperepository.cpp
        reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/kdecore/kstandarddirs.cpp
    }
    post-destroot {
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${destroot}${kf5.libexec_dir}/kf5/fileshareset
        if {[variant_isset kde4compat] && [file exists ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl]} {
            file rename ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl \
                ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl5
        }
    }
}

subport kf5-kdelibs4support-devel {
    description     Legacy support for kdelibs 4 compatibility
    long_description \
                    This framework provides code and utilities to ease the transition from \
                    kdelibs 4 to KDE Frameworks 5. This includes CMake macros and C++ \
                    classes whose functionality has been replaced by code in CMake, Qt and \
                    other frameworks.
    conflicts       kf5-kdelibs4support
    variant kde4compat description {allow installation alongside KDE4's port:kde4-runtime} {}
    if {![variant_isset kde4compat]} {
        conflicts-append \
                    port:kde4-runtime
    }
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    fetch.type      git
    git.branch      eefd3e5ab9e82220e5e66d7655a6e0d11129ac42
    version         ${version}.5.2.0.145
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    kdelibs4support
    depends_build-append \
                    ${kf5.oxygen-icons_dep}
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kbookmarks kcompletion kconfig kconfigwidgets \
                    kcrash kdbusaddons kded ki18n kdesignerplugin \
                    kdoctools kglobalaccel kguiaddons ki18n \
                    kiconthemes kio kitemviews knotifications kparts \
                    kservice ktextwidgets kunitconversion \
                    kwidgetsaddons kwindowsystem kxmlgui
    platform darwin {
        # pretend KDE_FULL_SESSION is set in order to get full support for theming settings
        patchfiles-append \
                    patch-kdelibs4supp-simulate-full_session.diff \
                    patch-kdelibs4supp-add-icon.diff
        post-patch {
            xinstall -m 755 -d ${build.dir}/src/kdebugdialog/icons
            kf5.link_icons ${prefix}/share/icons/oxygen actions tools-report-bug.png ${build.dir}/src/kdebugdialog/icons
        }
    }
    # submit upstream
    patchfiles-append \
                    patch-kdelibs4supp-qosmac=osx.diff \
                    patch-kdelibs4supp-correct-menuroles-kaction.diff \
                    patch-kdelibs4supp-correct-fileshareset-install.diff
#     # https://git.reviewboard.kde.org/r/126308
#     patchfiles-append \
#                     patch-kdelibs4supp-kpbutton-noshowicon.diff
    # https://git.reviewboard.kde.org/r/126309/
    patchfiles-append \
                    patch-kdelibs4supp-backtrace-demangle.diff
    patchfiles-append \
                    patch-kdelibs4supp-add-bundle-path.diff \
                    patch-kdelibs4supp-preserve-app-icon.diff
    post-patch {
        reinplace "s|/usr/local/|${prefix}/|g" ${worksrcpath}/src/kssl/kopenssl.cpp
        reinplace "s|/usr/sbin|${prefix}/sbin|g" ${worksrcpath}/src/kio/kfileshare.cpp
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/src/kdecore/kmimetyperepository.cpp
        reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/src/kdecore/kstandarddirs.cpp
    }
    post-destroot {
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${destroot}${kf5.libexec_dir}/kf5/fileshareset
        if {[variant_isset kde4compat] && [file exists ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl]} {
            file rename ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl \
                ${destroot}${prefix}/share/doc/HTML/en/kcontrol/kcm_ssl5
        }
    }
}

subport kf5-khtml {
    description     HTML rendering engine
    long_description \
                    KHTML is a web rendering engine, based on the KParts technology \
                    and using KJS for JavaScript support.
    conflicts       kf5-khtml-devel
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    khtml
    kf5.set_checksums
    depends_run-append \
                    path:bin/perl5:perl5
    platform darwin {
        depends_lib-append \
                    port:jpeg port:giflib port:libpng
    }
    depends_lib-append \
                    port:phonon-qt5 \
                    lib:libssl:openssl
    kf5.depends_frameworks \
                    karchive kcodecs kglobalaccel ki18n \
                    kiconthemes kio kjs knotifications \
                    kparts sonnet ktextwidgets kwallet \
                    kwidgetsaddons kwindowsystem kxmlgui
    post-patch {
        reinplace "s|/usr/local/|${prefix}/|g" ${worksrcpath}/src/html/kopenssl.cpp
        reinplace -W ${worksrcpath} "s|/usr/bin/python|${prefix}/bin/python${kf5.pyversion}|g" \
                    src/misc/gennames.py \
                    src/svg/generateSVGNames.py
        reinplace -W ${worksrcpath} "s|/usr/bin/perl|${prefix}/bin/perl5|g" \
                    src/scripts/validate \
                    src/scripts/list-updated-tests \
                    src/scripts/doctype \
                    src/css/maketokenizer \
                    src/bindings/scripts/generate-bindings.pl
    }
}

subport kf5-kjs {
    description     Javascript engine
    long_description \
                    This library provides an ECMAScript compatible interpreter. The ECMA standard \
                    is based on well known scripting languages such as Netscape's JavaScript and \
                    Microsoft's JScript.
    conflicts       kf5-kjs-devel
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    kjs
    kf5.set_checksums
    depends_lib-append \
                    port:pcre
    depends_run-append \
                    path:bin/perl5:perl5
    kf5.depends_frameworks \
                    kdoctools
    if {[variant_isset qspXDG]} {
        patchfiles-append \
                    patch-kjs-add-qspxdg.diff
    }
    post-patch {
        reinplace -W ${worksrcpath} "s|/usr/bin/perl|${prefix}/bin/perl5|g" \
                    src/kjs/create_hash_table
    }
}

subport kf5-krunner {
    description     Framework for Plasma runners
    long_description \
                    The Plasma workspace provides an application called KRunner which, among other \
                    things, allows one to type into a text area which causes various actions and \
                    information that match the text to happen and appear as the text is being typed.
    conflicts       kf5-krunner-devel
    # change the type of framework to "portingAid"
    kf5.is_portingAid
    # call the function that will take care of resetting the rest
    kf5.set_project \
                    krunner
    kf5.set_checksums
    kf5.depends_frameworks \
                    kconfig kcoreaddons ki18n kio \
                    plasma-framework kservice solid \
                    threadweaver
}

post-destroot {
    if {[variant_isset qspXDG]} {
        ui_msg "--->  Checking ${subport} for the QspXDG activator ..."
        if {[info exists kf5.framework]} {
            upvar #0 kf5.${kf5.framework}_lib lib
        } elseif {[info exists kf5.portingAid]} {
            upvar #0 kf5.${kf5.portingAid}_lib lib
        } else {
            upvar #0 kf5.${kf5.project}_lib lib
        }
        if {[info exists lib]} {
            set libopt "-qsplib ${lib}"
        } else {
            set libopt ""
        }
        if {[catch {system "${filespath}/../check-qspxdg.sh ${libopt} ${subport} 2>&1"} result context]} {
            ui_msg "QspXDG activator check failed: ${result}, ${context}"
        } else {
            ui_debug "QspXDG activator check: ${result}"
        }
    }
}

### === Meta Ports ===

if {${subport} eq ${name}} {
    long_description \
                    This meta-port pulls in all KF5 Frameworks, plus the kdelibs4support porting aid.
    homepage        http://projects.kde.org/projects/
    depends_build-append \
                    port:kf5-tier1-frameworks \
                    port:kf5-tier2-frameworks \
                    port:kf5-tier3-frameworks \
                    port:kf5-kdelibs4support
    installs_libs   no
    supported_archs noarch
    distfiles
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-tier1-frameworks {
    description     Meta-port for the Tier-1 Frameworks
    long_description \
                    ${description}, the frameworks that do not depend on other KF5 frameworks.
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier1
    depends_build-append \
                    ${kf5.kapidox_dep}
    kf5.depends_build_frameworks \
                    attica karchive kcodecs kconfig \
                    kcoreaddons kdbusaddons kdnssd kguiaddons \
                    ki18n kidletime kimageformats kitemmodels \
                    kitemviews kplotting kwidgetsaddons kwindowsystem \
                    solid sonnet threadweaver
    # kf5-kapidox  kf5-attica kf5-karchive kf5-kcodecs kf5-kconfig kf5-kcoreaddons kf5-kdbusaddons kf5-kdnssd kf5-kguiaddons kf5-ki18n kf5-kidletime kf5-kimageformats kf5-kitemmodels kf5-kitemviews kf5-kplotting kf5-kwidgetsaddons kf5-kwindowsystem kf5-solid kf5-sonnet kf5-threadweaver
    # kf5-kapidox  kf5-attica kf5-karchive kf5-kcodecs kf5-kconfig kf5-kcoreaddons kf5-kdbusaddons kf5-kdnssd kf5-kguiaddons kf5-ki18n kf5-kidletime kf5-kimageformats kf5-kitemmodels kf5-kitemviews kf5-kplotting kf5-kwidgetsaddons kf5-kwindowsystem-devel kf5-solid kf5-sonnet kf5-threadweaver
    installs_libs   no
    supported_archs noarch
    distfiles
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-tier2-frameworks {
    description     Meta-port for the Tier-2 Frameworks
    long_description \
                    ${description}, the frameworks that depend only on Tier-1 frameworks
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier2
    kf5.depends_build_frameworks \
                    kauth kcompletion kcrash kdoctools \
                    kfilemetadata kjobwidgets knotifications \
                    kpackage kpty kunitconversion
    # kf5-kauth kf5-kcompletion kf5-kcrash kf5-kdoctools kf5-kfilemetadata kf5-kjobwidgets kf5-knotifications kf5-kpackage kf5-kpty kf5-kunitconversion
    installs_libs   no
    supported_archs noarch
    distfiles
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-tier3-frameworks {
    description     Meta-port for the Tier-3 Frameworks
    long_description \
                    ${description}, the frameworks that depend on Tier-1 and/or Tier-2 and/or Tier-3 frameworks
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/\#fw-tier3
    kf5.depends_build_frameworks \
                    baloo kactivities kbookmarks kcmutils kconfigwidgets \
                    kdeclarative kded kdesignerplugin kdesu kdewebkit \
                    kemoticons kglobalaccel kiconthemes kinit kio \
                    knewstuff knotifyconfig kparts kpeople plasma-framework \
                    kservice ktexteditor ktextwidgets kwallet kxmlgui kxmlrpcclient
    installs_libs   no
    supported_archs noarch
    distfiles
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

subport kf5-portingaid-frameworks {
    description     Meta-port for the Porting Aids Frameworks
    long_description \
                    ${description}, the frameworks aiming to ease the porting of applications \
                    from KDE4 to KF5 (KDE5).
    homepage        http://projects.kde.org/projects/ \
                    http://api.kde.org/frameworks-api/frameworks5-apidocs/#porting-aids
    kf5.depends_build_frameworks \
                    kdelibs4support kjs khtml krunner
    # to be done: kjsembed, kmediaplayer, kross
    installs_libs   no
    supported_archs noarch
    distfiles
    fetch {}
    checksum {}
    extract {}
    use_configure   no
    build {}
    unset kf5.allow_docs_generation
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/kf5-installed-meta-ports
        system "touch ${destroot}${prefix}/share/doc/kf5-installed-meta-ports/${subport}"
    }
}

livecheck.type      regex
livecheck.version   ${kf5.branch}
livecheck.url       http://download.kde.org/stable/frameworks/
livecheck.regex     (5+(\\.\\d+)+)

# kate: backspace-indents true; indent-pasted-text true; indent-width 4; keep-extra-spaces true; remove-trailing-spaces modified; replace-tabs true; replace-tabs-save true; syntax Tcl/Tk; tab-indents true; tab-width 4;
