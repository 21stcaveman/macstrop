diff --git src/ioslaves/file/CMakeLists.txt src/ioslaves/file/CMakeLists.txt
index 78b88f24c1e0843dd5c061f78cf1d27f36beaa1b..fbc4268589de90fc0389a0a0c0da52d08fcfecd7 100644
--- src/ioslaves/file/CMakeLists.txt
+++ src/ioslaves/file/CMakeLists.txt
@@ -7,6 +7,8 @@ include(ConfigureChecks.cmake)
 
 if(WIN32)
   set(kio_file_PART_SRCS file.cpp file_win.cpp )
+elseif(APPLE)
+  set(kio_file_PART_SRCS file.cpp file_unix.cpp fdreceiver.cpp )
 else()
   set(kio_file_PART_SRCS file.cpp file_unix.cpp fdreceiver.cpp legacycodec.cpp )
 endif()
diff --git src/ioslaves/file/file.cpp src/ioslaves/file/file.cpp
index a25fd8cefdf5e689d25a5a06e356ecbcc4dd97ca..789fa8c7a7e896a5fff714d739d0203014fbd8f7 100644
--- src/ioslaves/file/file.cpp
+++ src/ioslaves/file/file.cpp
@@ -33,7 +33,7 @@
 
 #include "kioglobal_p.h"
 
-#ifdef Q_OS_UNIX
+#if defined(Q_OS_UNIX) && !defined(Q_OS_MACOS)
 #include "legacycodec.h"
 #endif
 
@@ -110,7 +110,7 @@ extern "C" Q_DECL_EXPORT int kdemain(int argc, char **argv)
         exit(-1);
     }
 
-#ifdef Q_OS_UNIX
+#if defined(Q_OS_UNIX) && !defined(Q_OS_MACOS)
     LegacyCodec codec;
 #endif
 
