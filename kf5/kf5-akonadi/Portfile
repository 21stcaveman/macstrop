# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

set kf5.project     akonadi
set kf5.virtualPath applications
PortGroup           kf5 1.1
set kf5.category    utilities
kf5.use_latest      applications

maintainers         gmail.com:rjvbertin mk openmaintainer

installs_libs       yes

description         A personal information management storage service for KF5.
long_description    Akonadi is an extensible cross-desktop storage service \
                    for KF5 PIM data and metadata providing concurrent read, write, and query access.
checksums           rmd160  9a3372c8de4a87e3aa4e37ba03925e72b887a3d1 \
                    sha256  54098782c6de7db9f3e3a30e26f56d71d8ffd8e8f9b42b9b393b1db30a035607

variant mariadb55 \
        conflicts sqlite mysql51 mysql55 mysql56 percona55 \
        description {build with mariadb port} {

    platform darwin {
        depends_run-append \
                    port:mariadb-server
        configure.args-append \
                    -DMYSQLD_EXECUTABLE=${prefix}/lib/mariadb/bin/mysqld
    }
    configure.args-append \
                    -DDATABASE_BACKEND=MYSQL
}
default_variants    +mariadb55

depends_lib-append  port:boost \
                    port:shared-mime-info \
                    port:libxslt

kf5.depends_frameworks \
                    kcompletion kconfig kconfigwidgets kcoreaddons \
                    kcrash kdbusaddons kdesignerplugin ki18n \
                    kiconthemes kio kitemmodels kitemviews \
                    knotifications kwidgetsaddons kwindowsystem kxmlgui

kf5.allow_apidocs_generation no

variant kde4compat description {build for installation on a system that uses KDE4's Akonadi} {}
# this is currently the default!!
default_variants    +kde4compat
kf5.kde4compat {
    post-destroot {
        file delete -force ${destroot}${prefix}/bin \
                    ${destroot}${prefix}/share/akonadi \
                    ${destroot}${prefix}/share/config.kcfg \
                    ${destroot}${prefix}/share/dbus-1 \
                    ${destroot}${prefix}/share/icons
    }
}

post-destroot {
#     kf5.add_app_wrapper kruler5 kruler
}
