# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

set kf5.project     kde-dev-scripts
set kf5.virtualPath applications
set kf5.category    graphics
PortGroup           kf5 1.1

kf5.use_latest      kf5.release

# set the name; kf5-kde-dev-scripts would be silly
name                kf5-dev-scripts
maintainers         gmail.com:rjvbertin mk openmaintainer

description         KDE Developer convenience scripts
long_description    ${description}

use_xz              yes
checksums           rmd160  a20eefdd82f40704f20ed23a48ad7bc053fbeb6e \
                    sha256  f367fe6bcd1fe4ced15b4fd5f6c074f2f23f81e0ad4f5543c48c0db4f5a14976

unset kf5.allow_docs_generation

conflicts-append    port:kde-dev-scripts

depends_run-append  port:perl5 \
                    port:python27 \
                    port:gsed

set py3ok           no
foreach p {33 34 35} {
    variant python${p} description "uses port:python${p}" {
        depends_run-append \
                    port:python${p}
    }
    if {[variant_isset python${p}]} {
        set py3ok   yes
    }
}
pre-fetch {
    if {!${py3ok}} {
        ui_error "You need to select a python3 variant"
        return -code error "Please select a python3 variant"
    }
}

post-patch {
    foreach f [glob -nocomplain ${worksrcpath}/*] {
        if {[file tail ${f}] ne "kde-devel-vim.vim"} {
            reinplace "s|/usr/bin/perl|${prefix}/bin/perl5|g" ${f}
            reinplace "s|/usr/bin/sed|${prefix}/bin/gsed|g" ${f}
            reinplace "s|/usr/bin/python|${prefix}/bin/python|g" ${f}
            reinplace "s|/usr/bin/ruby|/usr/bin/env ruby|g" ${f}
        }
    }
}
