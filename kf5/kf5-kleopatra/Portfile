# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
# Copyright (c) 2015, 2016 R.J.V. Bertin

PortSystem          1.0
PortGroup           compiler_blacklist_versions 1.0

set kf5.project     [string map [list "kf5-" ""] ${subport}]
set kf5.virtualPath applications
set kf5.category    office
PortGroup           kf5 1.1
kf5.use_latest      applications

maintainers         gmail.com:rjvbertin mk openmaintainer
homepage            https://www.kde.org/applications/utilities/kleopatra/

kf5.allow_apidocs_generation no

subport kf5-libkleo {
    description         KF5 Kleopatra library
    long_description    ${description}.
    checksums           rmd160  dbd7b6423abd143c8ca1b4c4177b1047b9e7c0f3 \
                        sha256  12b283ade8975f8323c4062154c6d0141afb9dfbf32029fc0beb72e78b5f5934

    depends_lib-append  port:boost \
                        port:gpgme \
                        port:qgpgme
    kf5.depends_frameworks \
                        kcodecs kcompletion kconfig kcoreaddons \
                        ki18n kitemmodels kwidgetsaddons kwindowsystem
#     depends_lib-append  port:kf5-pimtextedit
    platform darwin {
        kf5.kde4compat {
            post-destroot {
            }
        }
    }
}

subport kf5-kleopatra {
    description         KF5 Certificate Manager and Unified Crypto GUI
    long_description    KF5 Kleopatra is a certificate manager and a universal crypto GUI. \
                        It supports managing X.509 and OpenPGP certificates in the GpgSM \
                        keybox and retrieving certificates from LDAP servers.
    checksums           rmd160  559f192fd3fe4d7881323f3fcd8f45664f6a99a2 \
                        sha256  9cf3127e120d2ea6c749cb1489faf6d5149f83e6ed5984f5c71f52ad29ef62fc

    depends_lib-append  port:libassuan \
                        port:boost \
                        port:gpgme \
                        port:qgpgme
    kf5.depends_frameworks \
                        kcmutils kcodecs kconfig kconfigwidgets \
                        kcoreaddons kdbusaddons kdoctools ki18n \
                        kiconthemes kitemmodels knotifications \
                        ktextwidgets kwidgetsaddons kwindowsystem kxmlgui
    depends_lib-append  port:kf5-libkleo \
                        port:kf5-libkmime

    patchfiles-append   patch-featuresummary.diff \
                        patch-appnames.diff

    platform darwin {
        compiler.blacklist *gcc* {clang < 602} macports-clang-3.3 macports-clang-3.4 macports-clang-3.5
        foreach clv {3.6 3.7 3.8 3.9 4.0} {
            if {[file exists ${prefix}/bin/clang-mp-${clv}]} {
                compiler.whitelist-prepend macports-clang-${clv}
            }
            compiler.fallback-prepend macports-clang-${clv}
        }
    }

    post-destroot {
        kf5.add_app_wrapper kleopatra5 kleopatra
    }
}

livecheck.type      regex
livecheck.url       http://download.kde.org/stable/applications/
livecheck.regex     (\\d+(\\.\\d+)+)
