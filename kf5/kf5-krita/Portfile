# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
# Copyright (c) 2015, 2016 R.J.V. Bertin

PortSystem          1.0

set kf5.project     krita
set kf5.virtualPath applications
set kf5.dont_use_xz yes
PortGroup           kf5 1.1
set kf5.category    graphics
kf5.use_latest      applications

maintainers         gmail.com:rjvbertin mk openmaintainer

description         a professional free and open source painting program.
long_description    Krita is a professional free and open source painting program. \
                    It is made by artists who want to see affordable art tools for everyone. \

version             3.0.1.1
checksums           rmd160  40400f24a2eaeaafd3ebc407897e0927e6ec95c2 \
                    sha256  b36ce546fd5a469485496171add94c0deda3c26bdb7a688b7d593f5155baa86c
master_sites        http://download.kde.org/stable/krita/${version}
distname            ${kf5.project}-${version}

if {${os.platform} eq "darwin"} {
    if {[info exist ::env(MACPORTS_COMPRESS_WORKDIR)] && $::env(MACPORTS_COMPRESS_WORKDIR)} {
        # krita is huge. Enable HFS compression if bsdtar is already installed
        # This doesn't change the built/installed files, so should be acceptable runtime behaviour
        if {[file exists ${prefix}/bin/bsdtar]} {
            extract.post_args       "| ${prefix}/bin/bsdtar -x -k --hfsCompression"
        }
    }
}

depends_lib-append  port:libpng \
                    port:boost

# optional dependencies that we make default:
depends_lib-append  port:gsl \
                    port:zlib \
                    port:openexr \
                    port:tiff \
                    path:lib/libjpeg.${kf5::libs_ext}:jpeg \
                    port:libraw \
                    port:fftw-3 \
                    port:eigen3 \
                    port:exiv2 \
                    port:lcms2 \
                    port:Vc \
                    path:lib/libpoppler-qt5.${kf5::libs_ext}:poppler-qt5 \
                    port:curl

kf5.depends_qt5_components \
                    qtsvg

kf5.depends_frameworks \
                    karchive kconfig kcompletion kcoreaddons \
                    kguiaddons ki18n kitemmodels kitemviews \
                    kwidgetsaddons kwindowsystem

# check INSTALL_RPATH property set in krita/CMakeLists.txt
# check _APPLE token in source

kf5.allow_docs_generation no

platform darwin {
    conflicts calligra
}

patchfiles-append   patch-linuxy-build.diff \
                    patch-omit-custom-rpath.diff

post-destroot {
    kf5.add_app_wrapper krita5 krita
}
