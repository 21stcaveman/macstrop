# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
# Copyright (c) 2015, 2016 R.J.V. Bertin

PortSystem          1.0

set kf5.project     ksysguard
set kf5.virtualPath plasma
PortGroup           kf5 1.1

subport kf5-libksysguard {
    set kf5.project libksysguard
    set kf5.virtualPath \
                    plasma
    # yes, we need to include the PortGroup here and at the toplevel!
    PortGroup       kf5 1.1
}

kf5.use_latest      plasma

maintainers         gmail.com:rjvbertin mk openmaintainer

patch.pre_args      -Np1

if {${subport} eq "kf5-libksysguard"} {
    description     KF5 sysguard library
    long_description \
                    KF5 sysguard library, used by port:kf5-ksysguard and by KDevelop's process picker.
    checksums       rmd160  b01c08be128d8f882137d47512b79ef866954723 \
                    sha256  d42456a89bcbd6e5198489fd2105688d436e212a4c43d8d5e0ebe9bb38181695
    kf5.depends_qt5_components \
                    qtscript qtwebkit
    kf5.depends_frameworks \
                    kauth kconfig kconfigwidgets kcompletion \
                    kcoreaddons ki18n kiconthemes kservice \
                    kwidgetsaddons kwindowsystem plasma-framework
    depends_lib-append \
                    port:zlib
    patchfiles-append \
                    patch-support-darwin.diff
    platform darwin {
        variant kde4compat description {allow installation alongside KDE4's port:kde-l10n-*} {
            post-destroot {
                file delete -force ${destroot}${prefix}/share/locale
            }
        }
        notes-append "
            Some of ${subport}'s features require a system dbus.
            To start it run the following command:
             sudo launchctl load -w /Library/LaunchDaemons/org.freedesktop.dbus-system.plist
            "
    }
} else {
    description     KF5 KSysGuard daemon
    long_description \
                    KF5 KSysGuard is a program to monitor various elements of your system, or any \
                    other remote system with the KSysGuard daemon (ksysguardd) installed. \
                    Currently the daemon has been ported to Linux, FreeBSD, Irix, NetBSD, \
                    OpenBSD, Solaris and Tru64 with varying degrees of completion.
    checksums       rmd160  900a55b09523fa29b3e029f030b278d02f9a6268 \
                    sha256  d6ee1f2b83471c6e5cd3774c7a4b1e86c9a42d779f37c551d8721dbb8011cfd7
    depends_lib-append \
                    port:kf5-libksysguard
    kf5.depends_frameworks \
                    kconfig kcoreaddons kdbusaddons ki18n \
                    kiconthemes kinit kio kitemviews knewstuff \
                    knotifications kwindowsystem

    kf5.allow_docs_generation \
                    no
    post-destroot {
        kf5.add_app_wrapper ksysguard5 ksysguard
        kf5.add_app_wrapper ksysguardd5 ksysguardd
    }
    platform darwin {
        long_description-append \
                    This port currently doesn't do provide anything of interest above and beyond the system Activity Monitor.
        notes-append \
                    "This port currently doesn't do provide anything of interest above and beyond the system Activity Monitor"
        variant kde4compat description {allow installation alongside KDE4's port:kde-l10n-* and port:kde4-workspace} {
            post-destroot {
                if {[file exists ${destroot}${prefix}/share/doc/HTML]} {
                    file delete -force ${destroot}${prefix}/share/doc/HTML
                }
                file delete -force ${destroot}${prefix}/share/locale
            }
        }
    }
}


livecheck.type      regex
livecheck.url       http://download.kde.org/stable/plasma/
livecheck.regex     (5+(\\.\\d+)+)
