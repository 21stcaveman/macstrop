# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
# Copyright (c) 2015, 2016 R.J.V. Bertin

PortSystem          1.0

set kf5.project     ksysguard
set kf5.virtualPath plasma
PortGroup           kf5 1.1

subport kf5-libksysguard {
    set kf5.project libksysguard
    set kf5.virtualPath \
                    plasma
    # yes, we need to include the PortGroup here and at the toplevel!
    PortGroup       kf5 1.1
}

# kf5.use_latest      plasma

maintainers         gmail.com:rjvbertin mk openmaintainer

patch.pre_args      -Np1

if {${subport} eq "kf5-libksysguard"} {
    revision        1
    description     KF5 sysguard library
    long_description \
                    KF5 sysguard library, used by port:kf5-ksysguard
    checksums       rmd160  ec4637b0cba89163ab69c20fd3fa020b4bdf72cb \
                    sha256  53a5300fc982ec4c0b71987b28a86e03e219b2cad20382d42275399814236162
    qt5.depends_component \
                    qtwebkit
    kf5.depends_frameworks \
                    kauth kconfig kconfigwidgets kcompletion \
                    kcoreaddons ki18n kiconthemes kservice \
                    kwidgetsaddons kwindowsystem plasma-framework
    depends_lib-append \
                    port:zlib
    patchfiles-append \
                    patch-support-darwin.diff
    platform darwin {
        variant kde4compat description {allow installation alongside KDE4's port:kde-l10n-*} {
            post-destroot {
                file delete -force ${destroot}${prefix}/share/locale
            }
        }
        notes-append "
            Some of ${subport}'s features require a system dbus.
            To start it run the following command:
             sudo launchctl load -w /Library/LaunchDaemons/org.freedesktop.dbus-system.plist
            "
    }
} else {
    description     KF5 KSysGuard daemon
    long_description \
                    KF5 KSysGuard is a program to monitor various elements of your system, or any \
                    other remote system with the KSysGuard daemon (ksysguardd) installed. \
                    Currently the daemon has been ported to Linux, FreeBSD, Irix, NetBSD, \
                    OpenBSD, Solaris and Tru64 with varying degrees of completion.
    checksums       rmd160  ffd56f1f0e59c267b8c682e1c23a2d23120a240d \
                    sha256  e6ae4db5111f8d7752946d1c4976377d885de198509499dd832860fd9bdec923
    depends_lib-append \
                    port:kf5-libksysguard
    kf5.depends_frameworks \
                    kconfig kcoreaddons kdbusaddons ki18n \
                    kiconthemes kinit kio kitemviews knewstuff \
                    knotifications kwindowsystem

    kf5.allow_docs_generation \
                    no
    post-destroot {
        kf5.add_app_wrapper ksysguard5 ksysguard
        kf5.add_app_wrapper ksysguardd5 ksysguardd
    }
    platform darwin {
        long_description-append \
                    It runs on OS X but without providing any information of interest.
        notes-append \
                    "This port currently doesn't do anything"
        variant kde4compat description {allow installation alongside KDE4's port:kde-l10n-* and port:kde4-workspace} {
            post-destroot {
                if {[file exists ${destroot}${prefix}/share/doc/HTML]} {
                    file delete -force ${destroot}${prefix}/share/doc/HTML
                }
                file delete -force ${destroot}${prefix}/share/locale
            }
        }
    }
}


livecheck.type      regex
livecheck.url       http://download.kde.org/stable/plasma/
livecheck.regex     (5+(\\.\\d+)+)
