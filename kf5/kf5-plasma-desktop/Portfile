# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
# Copyright (c) 2015, 2016 R.J.V. Bertin

PortSystem          1.0

set kf5.project     plasma-desktop
set kf5.virtualPath plasma
description         KDE desktop components for X11
long_description    KDE desktop components for X11, providing notably \
                    the KDE control modules allowing to configure various \
                    settings like fonts, colour palettes, preferred theme etc.
checksums           rmd160  60c0e29f0d7063b70bd3ac99c1de2565258b0cbb \
                    sha256  2715035fbdd04899925ea12f03d8648ca35185266398d0fe6d580cbb03247c4e
PortGroup           kf5 1.1
kf5.use_latest      plasma

kf5.allow_docs_generation no

kf5.depends_frameworks \
                    attica baloo kactivities kauth kcmutils kdbusaddons \
                    kdeclarative kded kdelibs4support kemoticons \
                    kglobalaccel kitemmodels \
                    knewstuff knotifications knotifyconfig \
                    ki18n kpeople krunner kwallet \
                    kwindowsystem plasma-framework

depends_lib-append  port:phonon-qt5

# Dependencies expected through the host on Linux:
# libevdev-dev (optional), X11, Xft, XCB (shm, image, xkb, xinput), udev, synaptics (optional), OpenGL or OpenGLES
# xserver-xorg-input-{synaptis,evdev}-dev
# plus all listed below in depends_lib


maintainers         gmail.com:rjvbertin mk openmaintainer

patch.pre_args      -Np1
patchfiles-append   patch-disable-unwanted.diff
# correct the path: /etc -> @PREFIX@/etc, /usr -> @PREFIX@
# see the post-patch block below
patchfiles-append   patch-prefix-etc.diff \
                    patch-prefix-usr.diff

platform darwin {
    variant kde4compat description {allow installation alongside KDE4's port:kde4-workspace} {
        post-destroot {
            if {[file exists ${destroot}${prefix}/share/doc/HTML]} {
                file delete -force ${destroot}${prefix}/share/doc/HTML
            }
            if {[file exists ${destroot}${prefix}/share/locale]} {
                file delete -force ${destroot}${prefix}/share/locale
            }
        }
    }
    depends_lib-append \
                    port:freetype \
                    port:fontconfig \
                    port:pulseaudio \
                    path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    port:libcanberra \
                    port:iso-codes
    # there are additional components to exclude on OS X, plus
    # a few other modifications to make.
    patchfiles-append \
                    patch-disable-unwanted-and-adapt-to-OSX.diff
}

post-patch {
    reinplace "s|@PREFIX@|${prefix}|g" \
                    ${worksrcpath}/kcms/krdb/krdb.cpp \
                    ${worksrcpath}/kcms/keyboard/iso_codes.h \
                    ${worksrcpath}/kcms/lookandfeel/kcm.cpp
}

configure.args-append \
                    -DPLASMA_DESKTOP_BUILD_ALL=OFF

livecheck.type      regex
livecheck.url       http://download.kde.org/stable/plasma/
livecheck.regex     (5+(\\.\\d+)+)
