# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                libmmbd
version             1.10.6
categories          multimedia

# libmmbd itself is LGPL but the MakeMKV GuinpinSoft license includes a cause disallowing
# the redistribution of modified sources (and binaries including them). The license
# setting below will prevent the buildbots from creating binary packages.
# Code added by MacPorts adopts the LGPL 2.1 license, all other sources are grabbed from
# the makemkv download site and patched on the user's computer.
license             LGPL-2.1 GuinpinSoft

platforms           darwin linux
maintainers         gmail.com:rjvbertin
description         MakeMKV's replacement for libaacs + libbdplus

long_description    MakeMKV's replacement for libaacs + libbdplus. Requires having MakeMKV installed!

# conflict with libbdplus too?
conflicts           port:libaacs

homepage            http://www.makemkv.com/forum2/viewtopic.php?f=4&t=7010
master_sites        http://www.makemkv.com/download
distname            makemkv-oss-${version}

depends_build       port:pkgconfig

depends_lib         port:openssl

checksums           rmd160  b7481877e6a5ec1e07d02cfaeca5d85f40c78592 \
                    sha256  ab028ba05364f2d899b76e6a7392c9ef555379de2ef4732e1de27c23fd78d235

patchfiles-append   patch-buildsystem.diff

configure.args-append \
                    --enable-debug

platform darwin {
    build.args-append \
                    SHLIBEXT=.dylib \
                    "LIBMMBD_LDFLAGS=\"-fPIC -dynamiclib\""
}

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall ${worksrcpath}/License.txt ${destroot}${prefix}/share/doc/${name}/License.txt
}

livecheck.type      regex
livecheck.url       http://www.makemkv.com/forum2/viewtopic.php?f=3&t=224
livecheck.regex     makemkv-oss-(\\d+(\\.\\d+)+)${extract.suffix}
