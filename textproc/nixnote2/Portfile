# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           qmake5 1.0

github.setup        baumgarr nixnote2 0c0c4abedb8fd4236e29d5894116dde51e77c341
name                NixNote2
version             2.0.2.3
fetch.type          git
distname            ${name}-git
checksums           rmd160  0 \
                    sha256  0


categories          textproc
description         A Qt-based Evernote clone
long_description    An unofficial client of Evernote built with Qt

maintainers         gmail.com:rjvbertin openmaintainer
platforms           darwin linux
license             GPL-2+

homepage            https://www.nixnote.org

depends_lib-append  port:poppler-qt5 \
                    port:curl \
                    port:hunspell
qt5.depends_component \
                    mysql-plugin qtdeclarative qtwebkit

patch.pre_args      -Np1

patchfiles-append   patch-qmake.diff \
                    patch-fix-paths.diff \
                    patch-preserve-icons.diff \
                    patch-fix-trayicon-crash.diff \
                    patch-tweaks.diff

post-patch {
    reinplace -W ${worksrcpath} "s|@PREFIX@|${prefix}|g" \
                    NixNote2.pro \
                    gui/nbrowserwindow.cpp \
                    nixnote.cpp \
                    settings/filemanager.cpp
}

default configure.dir \
                    {${workpath}/build}
configure.pre_args-append  \
                    ../${worksrcdir}/${name}.pro
default build.dir   {${workpath}/build}

post-extract {
    # the mainstream qmake5 PG assumes qt5.top_level exists but doesn't check.
    # it'll fail for ports like us intending to do an out-of-tree build.
    # Create the directory now (it's needed in the pre-configure).
    xinstall -m 755 -d ${qt5.top_level}
}

# the mainstream qmake5 PG also doesn't respect configure.ldflags
default qt5.ldflags {${configure.ldflags}}

platform darwin {
    post-destroot {
        xinstall -m 755 -d ${destroot}${qt_apps_dir}
        file copy ${build.dir}/nixnote2.app ${destroot}${qt_apps_dir}
        if {[info proc qt5.add_app_wrapper] ne ""} {
            qt5.add_app_wrapper nixnote2
        }
    }
}

platform linux {
    post-destroot {
        xinstall -m 755 ${build.dir}/nixnote2 ${destroot}${prefix}/bin
    }
}

if {[info exists qt5::currentportgroupdir] && [file exists ${qt5::currentportgroupdir}/compress_workdir-1.0.tcl]} {
    PortGroup       compress_workdir 1.0
}
